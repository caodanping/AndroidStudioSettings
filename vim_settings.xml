<application>
  <component name="VimSettings">
    <state version="4" enabled="true" />
    <globalmarks />
    <filemarks>
      <file name="D:/IdeaProjects/lems/src/main/frontend/app/view/warehouse/List.js" timestamp="1471418038574">
        <mark key="[" line="76" column="16" />
        <mark key="]" line="76" column="16" />
        <mark key="." line="76" column="16" />
      </file>
      <file name="D:/IdeaProjects/lems/src/main/frontend/scripts/LocalSearchControl.js" timestamp="1471418563775">
        <mark key="'" line="1860" column="17" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="0" column="0" />
        <mark key="." line="0" column="0" />
      </file>
      <file name="D:/IdeaProjects/lems/src/main/frontend/app/store/WarehouseManagers.js" timestamp="1471317491328">
        <mark key="[" line="7" column="16" />
        <mark key="]" line="8" column="18" />
        <mark key="." line="8" column="18" />
        <mark key="^" line="8" column="18" />
      </file>
      <file name="D:/IdeaProjects/lems/src/main/frontend/ext/src/window/MessageBox.js" timestamp="1471333619770">
        <mark key="'" line="977" column="51" />
      </file>
      <file name="D:/IdeaProjects/lems/src/main/frontend/app/view/NavTree.js" timestamp="1471418403334" />
      <file name="D:/IdeaProjects/lems/src/main/frontend/ext/src/ux/ajax/Simlet.js" timestamp="1471246271335">
        <mark key="'" line="190" column="32" />
      </file>
      <file name="D:/IdeaProjects/lems/src/main/frontend/app/view/warehouse/Edit.js" timestamp="1471331863377">
        <mark key="'" line="104" column="12" />
        <mark key="[" line="49" column="39" />
        <mark key="]" line="33" column="5" />
        <mark key="." line="33" column="5" />
        <mark key="^" line="33" column="5" />
      </file>
      <file name="D:/IdeaProjects/lems/src/main/java/com/aucdi/csfy/domain/Location.java" timestamp="1471230198560">
        <mark key="[" line="36" column="43" />
        <mark key="]" line="57" column="1" />
        <mark key="^" line="57" column="1" />
        <mark key="." line="57" column="1" />
      </file>
      <file name="D:/IdeaProjects/lems/src/main/frontend/scripts/SearchControl.js" timestamp="1471416557036">
        <mark key="'" line="1752" column="17" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="2062" column="4" />
      </file>
      <file name="D:/IdeaProjects/lems/src/main/frontend/app/view/BMapPanel.js" timestamp="1471061441002">
        <mark key="[" line="68" column="31" />
        <mark key="]" line="68" column="3" />
        <mark key="^" line="68" column="3" />
        <mark key="." line="68" column="3" />
      </file>
      <file name="D:/IdeaProjects/lems/src/main/frontend/app/view/warehouse/Manager.js" timestamp="1471417985638">
        <mark key="'" line="110" column="20" />
        <mark key="[" line="99" column="0" />
        <mark key="]" line="99" column="32" />
        <mark key="^" line="99" column="32" />
        <mark key="." line="99" column="32" />
      </file>
      <file name="D:/IdeaProjects/lems/src/main/java/com/aucdi/csfy/web/WarehouseController.java" timestamp="1471402214763">
        <mark key="[" line="6" column="34" />
      </file>
      <file name="D:/IdeaProjects/lems/src/main/frontend/app/view/warehouse/BMap.js" timestamp="1471400993506">
        <mark key="'" line="76" column="21" />
        <mark key="[" line="173" column="12" />
        <mark key="]" line="173" column="12" />
        <mark key="." line="173" column="12" />
        <mark key="^" line="176" column="31" />
      </file>
      <file name="D:/IdeaProjects/lems/src/main/frontend/app/SimData.js" timestamp="1471399908409">
        <mark key="[" line="104" column="45" />
        <mark key="]" line="105" column="45" />
        <mark key="." line="105" column="45" />
        <mark key="^" line="105" column="45" />
      </file>
      <file name="D:/IdeaProjects/lems/src/main/java/com/aucdi/csfy/domain/Site.java" timestamp="1471243110652">
        <mark key="[" line="21" column="7" />
        <mark key="]" line="34" column="11" />
        <mark key="." line="34" column="11" />
        <mark key="^" line="34" column="11" />
      </file>
      <file name="D:/IdeaProjects/lems/src/main/frontend/app/view/bmap/DemoController.js" timestamp="1470198797831">
        <mark key="[" line="3" column="33" />
        <mark key="]" line="6" column="11" />
        <mark key="^" line="6" column="11" />
        <mark key="." line="6" column="11" />
      </file>
      <file name="D:/IdeaProjects/lems/src/main/frontend/app/view/bmap/Demo.js" timestamp="1470988096977">
        <mark key="[" line="176" column="0" />
        <mark key="]" line="176" column="0" />
        <mark key="^" line="15" column="3" />
        <mark key="." line="176" column="0" />
      </file>
      <file name="D:/IdeaProjects/lems/src/main/java/com/aucdi/csfy/common/CollectionUtils.java" timestamp="1467794992879">
        <mark key="[" line="15" column="1" />
        <mark key="]" line="15" column="0" />
        <mark key="^" line="15" column="0" />
        <mark key="." line="15" column="3" />
      </file>
      <file name="D:/IdeaProjects/lems/src/main/frontend/app/view/warehouse/EditController.js" timestamp="1471318507246">
        <mark key="[" line="6" column="6" />
        <mark key="]" line="10" column="18" />
        <mark key="." line="10" column="18" />
        <mark key="^" line="10" column="18" />
      </file>
      <file name="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" timestamp="1471265379528">
        <mark key="'" line="1637" column="24" />
      </file>
      <file name="D:/IdeaProjects/lems/src/main/frontend/app.json" timestamp="1470204087407">
        <mark key="[" line="110" column="21" />
        <mark key="]" line="110" column="38" />
        <mark key="." line="110" column="38" />
        <mark key="^" line="110" column="38" />
      </file>
      <file name="D:/IdeaProjects/lems/src/main/frontend/app/view/warehouse/ManagerController.js" timestamp="1471337057183">
        <mark key="[" line="26" column="25" />
        <mark key="]" line="26" column="27" />
        <mark key="." line="26" column="27" />
        <mark key="^" line="26" column="27" />
      </file>
      <file name="D:/IdeaProjects/lems/src/main/frontend/app/model/Warehouse.js" timestamp="1471317109741">
        <mark key="[" line="10" column="39" />
        <mark key="]" line="11" column="44" />
        <mark key="." line="11" column="44" />
        <mark key="^" line="11" column="44" />
      </file>
      <file name="D:/IdeaProjects/lems/src/main/frontend/app/store/Warehouses" timestamp="1470987963636">
        <mark key="[" line="6" column="33" />
        <mark key="]" line="6" column="33" />
        <mark key="." line="6" column="33" />
        <mark key="^" line="6" column="33" />
      </file>
      <file name="D:/IdeaProjects/lems/src/main/frontend/app/view/bmap/LocalSearchField.js" timestamp="1471418373502">
        <mark key="[" line="42" column="16" />
        <mark key="]" line="52" column="22" />
        <mark key="^" line="52" column="22" />
        <mark key="." line="52" column="22" />
      </file>
      <file name="D:/IdeaProjects/lems/src/main/java/com/aucdi/csfy/web/DepartmentController.java" timestamp="1471402189162">
        <mark key="[" line="18" column="0" />
        <mark key="]" line="19" column="39" />
      </file>
    </filemarks>
    <jumps>
      <jump line="21" column="8" filename="D:/IdeaProjects/lems/src/main/frontend/app/view/warehouse/Manager.js" />
      <jump line="30" column="0" filename="D:/IdeaProjects/lems/src/main/frontend/app/view/warehouse/Manager.js" />
      <jump line="32" column="33" filename="D:/IdeaProjects/lems/src/main/frontend/app/view/warehouse/Edit.js" />
      <jump line="39" column="33" filename="D:/IdeaProjects/lems/src/main/frontend/app/view/warehouse/Edit.js" />
      <jump line="59" column="31" filename="D:/IdeaProjects/lems/src/main/frontend/app/view/warehouse/Edit.js" />
      <jump line="125" column="8" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/ux/ajax/Simlet.js" />
      <jump line="190" column="32" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/ux/ajax/Simlet.js" />
      <jump line="97" column="0" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="325" column="63" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="326" column="56" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="386" column="12" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="392" column="21" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="395" column="8" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="398" column="12" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="399" column="12" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="422" column="89" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="427" column="17" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="429" column="15" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="538" column="42" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="576" column="25" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="580" column="32" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1039" column="28" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1043" column="12" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1044" column="31" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1052" column="31" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1053" column="23" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1066" column="15" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1068" column="16" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1070" column="16" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1076" column="16" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1079" column="15" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1080" column="17" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1081" column="29" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1086" column="19" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1087" column="36" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1090" column="20" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1137" column="26" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1240" column="133" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1266" column="15" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1271" column="6" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1348" column="8" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1353" column="28" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1478" column="24" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1482" column="68" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1485" column="12" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1486" column="88" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1487" column="23" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1489" column="31" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1490" column="75" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1491" column="19" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1495" column="31" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1499" column="19" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1503" column="46" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1522" column="23" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1525" column="12" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1526" column="15" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1528" column="19" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1533" column="27" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1536" column="21" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1552" column="94" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1555" column="47" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1557" column="24" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1558" column="25" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1562" column="73" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1568" column="84" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1571" column="26" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1573" column="26" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1577" column="26" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1578" column="50" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1579" column="22" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1580" column="12" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1589" column="46" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1594" column="35" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1602" column="78" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1604" column="58" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1606" column="29" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1614" column="40" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="147" column="29" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="53" column="28" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="52" column="30" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="33" column="26" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1662" column="30" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="1637" column="24" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/panel/Table.js" />
      <jump line="49" column="20" filename="D:/IdeaProjects/lems/src/main/frontend/app/SimData.js" />
      <jump line="177" column="0" filename="D:/IdeaProjects/lems/src/main/frontend/app/SimData.js" />
      <jump line="0" column="0" filename="D:/IdeaProjects/lems/src/main/frontend/app/SimData.js" />
      <jump line="2" column="4" filename="D:/IdeaProjects/lems/src/main/frontend/app/SimData.js" />
      <jump line="94" column="9" filename="D:/IdeaProjects/lems/src/main/frontend/app/view/warehouse/Edit.js" />
      <jump line="95" column="9" filename="D:/IdeaProjects/lems/src/main/frontend/app/view/warehouse/Edit.js" />
      <jump line="96" column="12" filename="D:/IdeaProjects/lems/src/main/frontend/app/view/warehouse/Edit.js" />
      <jump line="84" column="16" filename="D:/IdeaProjects/lems/src/main/frontend/app/view/warehouse/ManagerController.js" />
      <jump line="977" column="51" filename="D:/IdeaProjects/lems/src/main/frontend/ext/src/window/MessageBox.js" />
      <jump line="174" column="12" filename="D:/IdeaProjects/lems/src/main/frontend/app/view/warehouse/BMap.js" />
      <jump line="76" column="21" filename="D:/IdeaProjects/lems/src/main/frontend/app/view/warehouse/BMap.js" />
      <jump line="1552" column="0" filename="D:/IdeaProjects/lems/src/main/frontend/scripts/SearchControl.js" />
      <jump line="1813" column="21" filename="D:/IdeaProjects/lems/src/main/frontend/scripts/SearchControl.js" />
      <jump line="1752" column="17" filename="D:/IdeaProjects/lems/src/main/frontend/scripts/SearchControl.js" />
      <jump line="103" column="20" filename="D:/IdeaProjects/lems/src/main/frontend/app/view/warehouse/Manager.js" />
      <jump line="1815" column="38" filename="D:/IdeaProjects/lems/src/main/frontend/scripts/LocalSearchControl.js" />
      <jump line="1860" column="17" filename="D:/IdeaProjects/lems/src/main/frontend/scripts/LocalSearchControl.js" />
    </jumps>
    <registers>
      <register name="&quot;" type="4">
        <text>tbar</text>
      </register>
      <register name="-" type="4">
        <text>tbar</text>
      </register>
      <register name="/" type="4">
        <text>localSearch</text>
      </register>
      <register name="0" type="2">
        <text encoding="base64">LyoqCiAqIEBmaWxlb3ZlcnZpZXcgsNm2yLXYzby1xLzsy/e/2Lz+o6y21M3iv6q3xaGjCiAqIL/Y1sbL0cv3v/K/2Lz+us21vLq9v9i8/qGjCiAqILv509pCYWlkdSBNYXAgQVBJIDEuNKGjCiAqCiAqIEBhdXRob3IgYmFpZHUKICogQHZlcnNpb24gMS40CiAqLwovKioKICogQG5hbWVzcGFjZSBCTWFwtcTL+dPQbGlicmFyecDgvvm3xdTaQk1hcExpYsP8w/u/1bzkz8IKICovCnZhciBCTWFwTGliID0gd2luZG93LkJNYXBMaWIgPSBCTWFwTGliIHx8IHt9OwoKKGZ1bmN0aW9uICgpIHsKICAgIC8vyfnD92JhaWR1sPwKICAgIHZhciBULCBiYWlkdSA9IFQgPSBiYWlkdSB8fCB7CiAgICAgICAgdmVyc2lvbjogIjEuMy45IgogICAgfTsKICAgIC8vzOGz9md1aWSjrLfA1rnU2tPrwM+w5rG+VGFuZ3Jhbbvs08PKsQogICAgLy/U2s/C0rvQ0LTtzvO1xNDeuMR3aW5kb3dbdW5kZWZpbmVkXQogICAgYmFpZHUuZ3VpZCA9ICIkQkFJRFUkIjsKICAgIC8vsdWw/KOswO+x38rHy/nTw7W9tcR0YW5ncmFttcS3vbeoCiAgICAoZnVuY3Rpb24gKCkgewogICAgICAgIC8qKiBAaWdub3JlCiAgICAgICAgICogQG5hbWVzcGFjZSBiYWlkdS5kb20gstnX92RvbbXEt723qKGjCiAgICAgICAgICovCiAgICAgICAgYmFpZHUuZG9tID0gYmFpZHUuZG9tIHx8IHt9OwoKICAgICAgICAvKiBAaWdub3JlCiAgICAgICAgICogQG5hbWVzcGFjZSBiYWlkdS5ldmVudCDGwbHO5K/AwMb3su7S7NDUtcTKwrz+t+LXsKGjCiAgICAgICAgICogQHByb3BlcnR5IHRhcmdldCAJysK8/rXEtKW3otSqy9gKICAgICAgICAgKiBAcHJvcGVydHkgcGFnZVggCQnK87HqysK8/rXEyvOx6njX+LHqCiAgICAgICAgICogQHByb3BlcnR5IHBhZ2VZIAkJyvOx6srCvP61xMrzsep51/ix6gogICAgICAgICAqIEBwcm9wZXJ0eSBrZXlDb2RlIAm8/MXMysK8/rXEvPzWtQogICAgICAgICAqLwogICAgICAgIGJhaWR1LmV2ZW50ID0gYmFpZHUuZXZlbnQgfHwge307CgogICAgICAgIC8qIEBpZ25vcmUKICAgICAgICAgKiBAbmFtZXNwYWNlIGJhaWR1LmxhbmcgttTT79HUsuPD5rXEt+LXsKOssPzAqMDg0M3F0LbPoaLEo7/pwKnVuaGivMyz0Lv5wODS1LywttTP89fUtqjS5crCvP61xNans9ahowogICAgICAgICAqLwogICAgICAgIGJhaWR1LmxhbmcgPSBiYWlkdS5sYW5nIHx8IHt9OwoKICAgICAgICAvKiBAaWdub3JlCiAgICAgICAgICogQG5hbWVzcGFjZSBiYWlkdS5icm93c2VyIMXQts/kr8DAxvfA4NDNus3M2NDUtcTK9NDUoaMKICAgICAgICAgKi8KICAgICAgICBiYWlkdS5icm93c2VyID0gYmFpZHUuYnJvd3NlciB8fCB7fTsKICAgICAgICAvKioKICAgICAgICAgKiDOqsS/serUqsvYzO2802NsYXNzTmFtZQogICAgICAgICAqIEBuYW1lIGJhaWR1LmRvbS5hZGRDbGFzcwogICAgICAgICAqIEBmdW5jdGlvbgogICAgICAgICAqIEBncmFtbWFyIGJhaWR1LmRvbS5hZGRDbGFzcyhlbGVtZW50LCBjbGFzc05hbWUpCiAgICAgICAgICogQHBhcmFtIHtIVE1MRWxlbWVudHxzdHJpbmd9IGVsZW1lbnQgxL+x6tSqy9i78sS/serUqsvYtcRpZAogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBjbGFzc05hbWUg0qrM7bzTtcRjbGFzc05hbWWjrNTK0O3NrMqxzO2807bguPZjbGFzc6Os1tC85Mq508O/1bDXt/u31rj0CiAgICAgICAgICogQHJlbWFyawogICAgICAgICAqIMq508PV39OmsaPWpMzhuam1xGNsYXNzTmFtZbrPt6jQ1KOssrvTprD8uqyyu7rPt6jX1rf7o6xjbGFzc05hbWW6z7eo19a3+7LOv7yjumh0dHA6Ly93d3cudzMub3JnL1RSL0NTUzIvc3luZGF0YS5odG1soaMKICAgICAgICAgKiBAc2hvcnRjdXQgYWRkQ2xhc3MKICAgICAgICAgKiBAbWV0YSBzdGFuZGFyZAogICAgICAgICAqIEBzZWUgYmFpZHUuZG9tLnJlbW92ZUNsYXNzCiAgICAgICAgICoKICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm5zIHtIVE1MRWxlbWVudH0gxL+x6tSqy9gKICAgICAgICAgKi8KICAgICAgICBiYWlkdS5kb20uYWRkQ2xhc3MgPSBmdW5jdGlvbiAoZWxlbWVudCwgY2xhc3NOYW1lKSB7CiAgICAgICAgICAgIGVsZW1lbnQgPSBiYWlkdS5kb20uZyhlbGVtZW50KTsKICAgICAgICAgICAgdmFyIGNsYXNzQXJyYXkgPSBjbGFzc05hbWUuc3BsaXQoL1xzKy8pLAogICAgICAgICAgICAgICAgcmVzdWx0ID0gZWxlbWVudC5jbGFzc05hbWUsCiAgICAgICAgICAgICAgICBjbGFzc01hdGNoID0gIiAiICsgcmVzdWx0ICsgIiAiLAogICAgICAgICAgICAgICAgaSA9IDAsCiAgICAgICAgICAgICAgICBsID0gY2xhc3NBcnJheS5sZW5ndGg7CgogICAgICAgICAgICBmb3IgKDsgaSA8IGw7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGNsYXNzTWF0Y2guaW5kZXhPZigiICIgKyBjbGFzc0FycmF5W2ldICsgIiAiKSA8IDApIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gKHJlc3VsdCA/ICcgJyA6ICcnKSArIGNsYXNzQXJyYXlbaV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NOYW1lID0gcmVzdWx0OwogICAgICAgICAgICByZXR1cm4gZWxlbWVudDsKICAgICAgICB9OwoKICAgICAgICAvLyDJ+cP3v+y93be9t6gKICAgICAgICBiYWlkdS5hZGRDbGFzcyA9IGJhaWR1LmRvbS5hZGRDbGFzczsKICAgICAgICAvKioKICAgICAgICAgKiDSxrP9xL+x6tSqy9i1xGNsYXNzTmFtZQogICAgICAgICAqIEBuYW1lIGJhaWR1LmRvbS5yZW1vdmVDbGFzcwogICAgICAgICAqIEBmdW5jdGlvbgogICAgICAgICAqIEBncmFtbWFyIGJhaWR1LmRvbS5yZW1vdmVDbGFzcyhlbGVtZW50LCBjbGFzc05hbWUpCiAgICAgICAgICogQHBhcmFtIHtIVE1MRWxlbWVudHxzdHJpbmd9IGVsZW1lbnQgxL+x6tSqy9i78sS/serUqsvYtcRpZAogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBjbGFzc05hbWUg0qrSxrP9tcRjbGFzc05hbWWjrNTK0O3NrMqx0saz/bbguPZjbGFzc6Os1tC85Mq508O/1bDXt/u31rj0CiAgICAgICAgICogQHJlbWFyawogICAgICAgICAqIMq508PV39OmsaPWpMzhuam1xGNsYXNzTmFtZbrPt6jQ1KOssrvTprD8uqyyu7rPt6jX1rf7o6xjbGFzc05hbWW6z7eo19a3+7LOv7yjumh0dHA6Ly93d3cudzMub3JnL1RSL0NTUzIvc3luZGF0YS5odG1soaMKICAgICAgICAgKiBAc2hvcnRjdXQgcmVtb3ZlQ2xhc3MKICAgICAgICAgKiBAbWV0YSBzdGFuZGFyZAogICAgICAgICAqIEBzZWUgYmFpZHUuZG9tLmFkZENsYXNzCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJucyB7SFRNTEVsZW1lbnR9IMS/serUqsvYCiAgICAgICAgICovCiAgICAgICAgYmFpZHUuZG9tLnJlbW92ZUNsYXNzID0gZnVuY3Rpb24gKGVsZW1lbnQsIGNsYXNzTmFtZSkgewogICAgICAgICAgICBlbGVtZW50ID0gYmFpZHUuZG9tLmcoZWxlbWVudCk7CgogICAgICAgICAgICB2YXIgb2xkQ2xhc3NlcyA9IGVsZW1lbnQuY2xhc3NOYW1lLnNwbGl0KC9ccysvKSwKICAgICAgICAgICAgICAgIG5ld0NsYXNzZXMgPSBjbGFzc05hbWUuc3BsaXQoL1xzKy8pLAogICAgICAgICAgICAgICAgbGVuT2xkLCBsZW5EZWwgPSBuZXdDbGFzc2VzLmxlbmd0aCwKICAgICAgICAgICAgICAgIGosIGkgPSAwOwogICAgICAgICAgICAvL7+8wse1vc2syrHJvrP9tuC49mNsYXNzTmFtZbXE06bTw7OhvrC4xcLKvc+1zSy5yrfFxvq9+NK7sr3Q1MTc08W7rwogICAgICAgICAgICAvLyBieSByb2N5IEAxLjMuNAogICAgICAgICAgICBmb3IgKDsgaSA8IGxlbkRlbDsgKytpKSB7CiAgICAgICAgICAgICAgICBmb3IgKGogPSAwLCBsZW5PbGQgPSBvbGRDbGFzc2VzLmxlbmd0aDsgaiA8IGxlbk9sZDsgKytqKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG9sZENsYXNzZXNbal0gPT0gbmV3Q2xhc3Nlc1tpXSkgewogICAgICAgICAgICAgICAgICAgICAgICBvbGRDbGFzc2VzLnNwbGljZShqLCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NOYW1lID0gb2xkQ2xhc3Nlcy5qb2luKCcgJyk7CiAgICAgICAgICAgIHJldHVybiBlbGVtZW50OwogICAgICAgIH07CgogICAgICAgIC8vIMn5w/e/7L3dt723qAogICAgICAgIGJhaWR1LnJlbW92ZUNsYXNzID0gYmFpZHUuZG9tLnJlbW92ZUNsYXNzOwoKICAgICAgICAvKioKICAgICAgICAgKiC78cihxL+x6tSqy9i1xGNvbXB1dGVkIHN0eWxl1rWho8jnufvUqsvYtcTR+cq91rWyu8Tcsbvkr8DAxve8xsvjo6zU8rvht7W72L/V19a3+7Suo6hJRaOpCiAgICAgICAgICoKICAgICAgICAgKiBAYXV0aG9yIGJlcmcKICAgICAgICAgKiBAbmFtZSBiYWlkdS5kb20uZ2V0Q29tcHV0ZWRTdHlsZQogICAgICAgICAqIEBmdW5jdGlvbgogICAgICAgICAqIEBncmFtbWFyIGJhaWR1LmRvbS5nZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQsIGtleSkKICAgICAgICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fHN0cmluZ30gZWxlbWVudCDEv7Hq1KrL2LvyxL+x6tSqy9i1xGlkCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGtleSDSqrvxyKG1xNH5yr3D+wogICAgICAgICAqCiAgICAgICAgICogQHNlZSBiYWlkdS5kb20uZ2V0U3R5bGUKICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IMS/serUqsvYtcRjb21wdXRlZCBzdHlsZda1CiAgICAgICAgICovCgogICAgICAgIGJhaWR1LmRvbS5nZXRDb21wdXRlZFN0eWxlID0gZnVuY3Rpb24gKGVsZW1lbnQsIGtleSkgewogICAgICAgICAgICBlbGVtZW50ID0gYmFpZHUuZG9tLl9nKGVsZW1lbnQpOwogICAgICAgICAgICB2YXIgZG9jID0gYmFpZHUuZG9tLmdldERvY3VtZW50KGVsZW1lbnQpLAogICAgICAgICAgICAgICAgc3R5bGVzOwogICAgICAgICAgICBpZiAoZG9jLmRlZmF1bHRWaWV3ICYmIGRvYy5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKSB7CiAgICAgICAgICAgICAgICBzdHlsZXMgPSBkb2MuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50LCBudWxsKTsKICAgICAgICAgICAgICAgIGlmIChzdHlsZXMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3R5bGVzW2tleV0gfHwgc3R5bGVzLmdldFByb3BlcnR5VmFsdWUoa2V5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgfTsKICAgICAgICAvKioKICAgICAgICAgKiC78cihxL+x6tSqy9i1xNH5yr3WtQogICAgICAgICAqIEBuYW1lIGJhaWR1LmRvbS5nZXRTdHlsZQogICAgICAgICAqIEBmdW5jdGlvbgogICAgICAgICAqIEBncmFtbWFyIGJhaWR1LmRvbS5nZXRTdHlsZShlbGVtZW50LCBrZXkpCiAgICAgICAgICogQHBhcmFtIHtIVE1MRWxlbWVudHxzdHJpbmd9IGVsZW1lbnQgxL+x6tSqy9i78sS/serUqsvYtcRpZAogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkg0qq78cihtcTR+cq9w/sKICAgICAgICAgKiBAcmVtYXJrCiAgICAgICAgICoKICAgICAgICAgKiDOqsHLvqu88rT6wuujrLG+xKO/6cSsyM+yu7bUyM66zuSvwMDG97e1u9jWtb340NC56dK7u6+0psDto6jI58q508NnZXRTdHlsZcqxo6yyu82s5K/AwMb3z8K/ycTct7W72HJnYtHVyau78mhleNHVyaujqaOs0rKyu7vh0N64tOSvwMDG97XEYnVnus2y7tLs0NSjqMjnyejWw0lFtcRmbG9hdMr00NS90HN0eWxlRmxvYXSjrGZpcmVmb3jU8srHY3NzRmxvYXSjqaGjPGJyIC8+CiAgICAgICAgICogYmFpZHUuZG9tLl9zdHlsZUZpeGVyus1iYWlkdS5kb20uX3N0eWxlRmlsdGVyv8nS1M6qsb7Eo7/pzOG5qdans9ahozxiciAvPgogICAgICAgICAqIMbk1tBfc3R5bGVGaWx0ZXLE3LbU0dXJq7rNcHi9+NDQuenSu7uvtKbA7aOsX3N0eWxlRml4ZXLE3LbUZGlzcGxheaOsZmxvYXSjrG9wYWNpdHmjrHRleHRPdmVyZmxvd7XE5K/AwMb3vObI3dDUYnVnvfjQ0LSmwO2howogICAgICAgICAqIEBzaG9ydGN1dCBnZXRTdHlsZQogICAgICAgICAqIEBtZXRhIHN0YW5kYXJkCiAgICAgICAgICogQHNlZSBiYWlkdS5kb20uc2V0U3R5bGUsYmFpZHUuZG9tLnNldFN0eWxlcywgYmFpZHUuZG9tLmdldENvbXB1dGVkU3R5bGUKICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IMS/serUqsvYtcTR+cq91rUKICAgICAgICAgKi8KCiAgICAgICAgYmFpZHUuZG9tLmdldFN0eWxlID0gZnVuY3Rpb24gKGVsZW1lbnQsIGtleSkgewogICAgICAgICAgICB2YXIgZG9tID0gYmFpZHUuZG9tOwoKICAgICAgICAgICAgZWxlbWVudCA9IGRvbS5nKGVsZW1lbnQpOwogICAgICAgICAgICB2YXIgdmFsdWUgPSBlbGVtZW50LnN0eWxlW2tleV0gfHwgKGVsZW1lbnQuY3VycmVudFN0eWxlID8gZWxlbWVudC5jdXJyZW50U3R5bGVba2V5XSA6ICIiKSB8fCBkb20uZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50LCBrZXkpOwoKICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgIH07CgogICAgICAgIC8vIMn5w/e/7L3dt723qAogICAgICAgIGJhaWR1LmdldFN0eWxlID0gYmFpZHUuZG9tLmdldFN0eWxlOwoKICAgICAgICAvKioKICAgICAgICAgKiC78cihxL+x6tSqy9jL+cr0tcRkb2N1bWVudLbUz/MKICAgICAgICAgKiBAbmFtZSBiYWlkdS5kb20uZ2V0RG9jdW1lbnQKICAgICAgICAgKiBAZnVuY3Rpb24KICAgICAgICAgKiBAZ3JhbW1hciBiYWlkdS5kb20uZ2V0RG9jdW1lbnQoZWxlbWVudCkKICAgICAgICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fHN0cmluZ30gZWxlbWVudCDEv7Hq1KrL2LvyxL+x6tSqy9i1xGlkCiAgICAgICAgICogQG1ldGEgc3RhbmRhcmQKICAgICAgICAgKiBAc2VlIGJhaWR1LmRvbS5nZXRXaW5kb3cKICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm5zIHtIVE1MRG9jdW1lbnR9IMS/serUqsvYy/nK9LXEZG9jdW1lbnS21M/zCiAgICAgICAgICovCiAgICAgICAgYmFpZHUuZG9tLmdldERvY3VtZW50ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHsKICAgICAgICAgICAgZWxlbWVudCA9IGJhaWR1LmRvbS5nKGVsZW1lbnQpOwogICAgICAgICAgICByZXR1cm4gZWxlbWVudC5ub2RlVHlwZSA9PSA5ID8gZWxlbWVudCA6IGVsZW1lbnQub3duZXJEb2N1bWVudCB8fCBlbGVtZW50LmRvY3VtZW50OwogICAgICAgIH07CgoKICAgICAgICAvKioKICAgICAgICAgKiC0087EtbXW0LvxyKHWuLaotcRET03UqsvYCiAgICAgICAgICogQG5hbWUgYmFpZHUuZG9tLmcKICAgICAgICAgKiBAZnVuY3Rpb24KICAgICAgICAgKiBAZ3JhbW1hciBiYWlkdS5kb20uZyhpZCkKICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ3xIVE1MRWxlbWVudH0gaWQg1KrL2LXEaWS78kRPTdSqy9gKICAgICAgICAgKiBAc2hvcnRjdXQgZyxULkcKICAgICAgICAgKiBAbWV0YSBzdGFuZGFyZAogICAgICAgICAqIEBzZWUgYmFpZHUuZG9tLnEKICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm5zIHtIVE1MRWxlbWVudHxudWxsfSC78cihtcTUqsvYo6yy6dXSsru1vcqxt7W72G51bGwsyOe5+7LOyv2yu7rPt6ijrNaxvdO3tbvYss7K/QogICAgICAgICAqLwogICAgICAgIGJhaWR1LmRvbS5nID0gZnVuY3Rpb24gKGlkKSB7CiAgICAgICAgICAgIGlmICgnc3RyaW5nJyA9PSB0eXBlb2YgaWQgfHwgaWQgaW5zdGFuY2VvZiBTdHJpbmcpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaWQgJiYgaWQubm9kZU5hbWUgJiYgKGlkLm5vZGVUeXBlID09IDEgfHwgaWQubm9kZVR5cGUgPT0gOSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBpZDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9OwogICAgICAgIC8vIMn5w/e/7L3dt723qAogICAgICAgIGJhaWR1LmcgPSBiYWlkdS5HID0gYmFpZHUuZG9tLmc7CiAgICAgICAgLyoqCiAgICAgICAgICogtNPOxLW11tC78cih1ri2qLXERE9N1KrL2AogICAgICAgICAqICoqxNqyv7e9t6gqKgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd8SFRNTEVsZW1lbnR9IGlkINSqy9i1xGlku/JET03UqsvYCiAgICAgICAgICogQG1ldGEgc3RhbmRhcmQKICAgICAgICAgKiBAcmV0dXJuIHtIVE1MRWxlbWVudH0gRE9N1KrL2KOsyOe5+7K7tObU2qOst7W72G51bGyjrMjnufuyzsr9sru6z7eoo6zWsb3Tt7W72LLOyv0KICAgICAgICAgKi8KICAgICAgICBiYWlkdS5kb20uX2cgPSBmdW5jdGlvbiAoaWQpIHsKICAgICAgICAgICAgaWYgKGJhaWR1LmxhbmcuaXNTdHJpbmcoaWQpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBpZDsKICAgICAgICB9OwoKICAgICAgICAvLyDJ+cP3v+y93be9t6gKICAgICAgICBiYWlkdS5fZyA9IGJhaWR1LmRvbS5fZzsKCgogICAgICAgIC8qKgogICAgICAgICAqIMXQts/Ev7Hqss7K/crHt/FzdHJpbmfA4NDNu/JTdHJpbme21M/zCiAgICAgICAgICogQG5hbWUgYmFpZHUubGFuZy5pc1N0cmluZwogICAgICAgICAqIEBmdW5jdGlvbgogICAgICAgICAqIEBncmFtbWFyIGJhaWR1LmxhbmcuaXNTdHJpbmcoc291cmNlKQogICAgICAgICAqIEBwYXJhbSB7QW55fSBzb3VyY2UgxL+x6rLOyv0KICAgICAgICAgKiBAc2hvcnRjdXQgaXNTdHJpbmcKICAgICAgICAgKiBAbWV0YSBzdGFuZGFyZAogICAgICAgICAqIEBzZWUgYmFpZHUubGFuZy5pc09iamVjdCxiYWlkdS5sYW5nLmlzTnVtYmVyLGJhaWR1LmxhbmcuaXNBcnJheSxiYWlkdS5sYW5nLmlzRWxlbWVudCxiYWlkdS5sYW5nLmlzQm9vbGVhbixiYWlkdS5sYW5nLmlzRGF0ZQogICAgICAgICAqCiAgICAgICAgICogQHJldHVybnMge2Jvb2xlYW59IMDg0M3F0LbPveG5+wogICAgICAgICAqLwogICAgICAgIGJhaWR1LmxhbmcuaXNTdHJpbmcgPSBmdW5jdGlvbiAoc291cmNlKSB7CiAgICAgICAgICAgIHJldHVybiAnW29iamVjdCBTdHJpbmddJyA9PSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoc291cmNlKTsKICAgICAgICB9OwoKICAgICAgICAvLyDJ+cP3v+y93be9t6gKICAgICAgICBiYWlkdS5pc1N0cmluZyA9IGJhaWR1LmxhbmcuaXNTdHJpbmc7CgogICAgICAgIC8qKgogICAgICAgICAqIMrCvP684Mz9xve1xLTmtKKx7QogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICogQG1ldGEgc3RhbmRhcmQKICAgICAgICAgKi8KICAgICAgICBiYWlkdS5ldmVudC5fbGlzdGVuZXJzID0gYmFpZHUuZXZlbnQuX2xpc3RlbmVycyB8fCBbXTsKICAgICAgICAvKioKICAgICAgICAgKiDOqsS/serUqsvYzO2808rCvP684Mz9xvcKICAgICAgICAgKiBAbmFtZSBiYWlkdS5ldmVudC5vbgogICAgICAgICAqIEBmdW5jdGlvbgogICAgICAgICAqIEBncmFtbWFyIGJhaWR1LmV2ZW50Lm9uKGVsZW1lbnQsIHR5cGUsIGxpc3RlbmVyKQogICAgICAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR8c3RyaW5nfHdpbmRvd30gZWxlbWVudCDEv7Hq1KrL2LvyxL+x6tSqy9hpZAogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlIMrCvP7A4NDNCiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gbGlzdGVuZXIg0OjSqsztvNO1xLzgzP3G9wogICAgICAgICAqIEByZW1hcmsKICAgICAgICAgKgogICAgICAgIDEuILK71qez1r/n5K/AwMb3tcTK87HqufbC1srCvP684Mz9xvfM7bzTPGJyPgogICAgICAgIDIuILjEt723qLK7zqq84Mz9xve54MjrysK8/rbUz/OjrNLUt8DWub/naWZyYW1lysK8/rnS1Ni1xMrCvP621M/zu/HIocqnsNwKCiAgICAgICAgICogQHNob3J0Y3V0IG9uCiAgICAgICAgICogQG1ldGEgc3RhbmRhcmQKICAgICAgICAgKiBAc2VlIGJhaWR1LmV2ZW50LnVuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJucyB7SFRNTEVsZW1lbnR8d2luZG93fSDEv7Hq1KrL2AogICAgICAgICAqLwogICAgICAgIGJhaWR1LmV2ZW50Lm9uID0gZnVuY3Rpb24gKGVsZW1lbnQsIHR5cGUsIGxpc3RlbmVyKSB7CiAgICAgICAgICAgIHR5cGUgPSB0eXBlLnJlcGxhY2UoL15vbi9pLCAnJyk7CiAgICAgICAgICAgIGVsZW1lbnQgPSBiYWlkdS5kb20uX2coZWxlbWVudCk7CgogICAgICAgICAgICB2YXIgcmVhbExpc3RlbmVyID0gZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICAgICAgLy8gMS4g1eLA77K71qez1kV2ZW50QXJndW1lbnQsICDUrdLyyse/52ZyYW1ltcTKwrz+udLU2AogICAgICAgICAgICAgICAgICAgIC8vIDIuIGVsZW1lbnTKx86qwcvQ3tX9dGhpcwogICAgICAgICAgICAgICAgICAgIGxpc3RlbmVyLmNhbGwoZWxlbWVudCwgZXYpOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxpcyA9IGJhaWR1LmV2ZW50Ll9saXN0ZW5lcnMsCiAgICAgICAgICAgICAgICBmaWx0ZXIgPSBiYWlkdS5ldmVudC5fZXZlbnRGaWx0ZXIsCiAgICAgICAgICAgICAgICBhZnRlckZpbHRlciwgcmVhbFR5cGUgPSB0eXBlOwogICAgICAgICAgICB0eXBlID0gdHlwZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAvLyBmaWx0ZXK5/cLLCiAgICAgICAgICAgIGlmIChmaWx0ZXIgJiYgZmlsdGVyW3R5cGVdKSB7CiAgICAgICAgICAgICAgICBhZnRlckZpbHRlciA9IGZpbHRlclt0eXBlXShlbGVtZW50LCB0eXBlLCByZWFsTGlzdGVuZXIpOwogICAgICAgICAgICAgICAgcmVhbFR5cGUgPSBhZnRlckZpbHRlci50eXBlOwogICAgICAgICAgICAgICAgcmVhbExpc3RlbmVyID0gYWZ0ZXJGaWx0ZXIubGlzdGVuZXI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIMrCvP684Mz9xve50tTYCiAgICAgICAgICAgIGlmIChlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihyZWFsVHlwZSwgcmVhbExpc3RlbmVyLCBmYWxzZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudC5hdHRhY2hFdmVudCkgewogICAgICAgICAgICAgICAgZWxlbWVudC5hdHRhY2hFdmVudCgnb24nICsgcmVhbFR5cGUsIHJlYWxMaXN0ZW5lcik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIL2rvODM/cb3tOa0orW9yv3X6dbQCiAgICAgICAgICAgIGxpc1tsaXMubGVuZ3RoXSA9IFtlbGVtZW50LCB0eXBlLCBsaXN0ZW5lciwgcmVhbExpc3RlbmVyLCByZWFsVHlwZV07CiAgICAgICAgICAgIHJldHVybiBlbGVtZW50OwogICAgICAgIH07CgogICAgICAgIC8vIMn5w/e/7L3dt723qAogICAgICAgIGJhaWR1Lm9uID0gYmFpZHUuZXZlbnQub247CgogICAgICAgIC8qKgogICAgICAgICAqIM6qxL+x6tSqy9jSxrP9ysK8/rzgzP3G9wogICAgICAgICAqIEBuYW1lIGJhaWR1LmV2ZW50LnVuCiAgICAgICAgICogQGZ1bmN0aW9uCiAgICAgICAgICogQGdyYW1tYXIgYmFpZHUuZXZlbnQudW4oZWxlbWVudCwgdHlwZSwgbGlzdGVuZXIpCiAgICAgICAgICogQHBhcmFtIHtIVE1MRWxlbWVudHxzdHJpbmd8d2luZG93fSBlbGVtZW50IMS/serUqsvYu/LEv7Hq1KrL2GlkCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgysK8/sDg0M0KICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBsaXN0ZW5lciDQ6NKq0saz/bXEvODM/cb3CiAgICAgICAgICogQHNob3J0Y3V0IHVuCiAgICAgICAgICogQG1ldGEgc3RhbmRhcmQKICAgICAgICAgKiBAc2VlIGJhaWR1LmV2ZW50Lm9uCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJucyB7SFRNTEVsZW1lbnR8d2luZG93fSDEv7Hq1KrL2AogICAgICAgICAqLwogICAgICAgIGJhaWR1LmV2ZW50LnVuID0gZnVuY3Rpb24gKGVsZW1lbnQsIHR5cGUsIGxpc3RlbmVyKSB7CiAgICAgICAgICAgIGVsZW1lbnQgPSBiYWlkdS5kb20uX2coZWxlbWVudCk7CiAgICAgICAgICAgIHR5cGUgPSB0eXBlLnJlcGxhY2UoL15vbi9pLCAnJykudG9Mb3dlckNhc2UoKTsKCiAgICAgICAgICAgIHZhciBsaXMgPSBiYWlkdS5ldmVudC5fbGlzdGVuZXJzLAogICAgICAgICAgICAgICAgbGVuID0gbGlzLmxlbmd0aCwKICAgICAgICAgICAgICAgIGlzUmVtb3ZlQWxsID0gIWxpc3RlbmVyLAogICAgICAgICAgICAgICAgaXRlbSwgcmVhbFR5cGUsIHJlYWxMaXN0ZW5lcjsKCiAgICAgICAgICAgIC8vyOe5+72rbGlzdGVuZXK1xL3hubm4xLPJanNvbgogICAgICAgICAgICAvL7/J0tS92sqhtfTV4rj20a27t6Os08W7r9DUxNwKICAgICAgICAgICAgLy+1q8rH08nT2nVutcTKudPDxrXCyrKisru436OszazKsdTabGlzdGVuZXKyu7bgtcTKsbryCiAgICAgICAgICAgIC8vsenA+sr91+m1xNDUxNzP+7rEsru74bbUtPrC67L6yfrTsM/sCiAgICAgICAgICAgIC8v1N2yu7+8wse0y9PFu68KICAgICAgICAgICAgd2hpbGUgKGxlbi0tKSB7CiAgICAgICAgICAgICAgICBpdGVtID0gbGlzW2xlbl07CgogICAgICAgICAgICAgICAgLy8gbGlzdGVuZXK05tTayrGjrNLGs/1lbGVtZW50tcTL+dPQ0tRsaXN0ZW5lcrzgzP21xHR5cGXA4NDNysK8/gogICAgICAgICAgICAgICAgLy8gbGlzdGVuZXKyu7Tm1NrKsaOs0saz/WVsZW1lbnS1xMv509B0eXBlwODQzcrCvP4KICAgICAgICAgICAgICAgIGlmIChpdGVtWzFdID09PSB0eXBlICYmIGl0ZW1bMF0gPT09IGVsZW1lbnQgJiYgKGlzUmVtb3ZlQWxsIHx8IGl0ZW1bMl0gPT09IGxpc3RlbmVyKSkgewogICAgICAgICAgICAgICAgICAgIHJlYWxUeXBlID0gaXRlbVs0XTsKICAgICAgICAgICAgICAgICAgICByZWFsTGlzdGVuZXIgPSBpdGVtWzNdOwogICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKHJlYWxUeXBlLCByZWFsTGlzdGVuZXIsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVsZW1lbnQuZGV0YWNoRXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5kZXRhY2hFdmVudCgnb24nICsgcmVhbFR5cGUsIHJlYWxMaXN0ZW5lcik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxpcy5zcGxpY2UobGVuLCAxKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7CiAgICAgICAgfTsKCiAgICAgICAgLy8gyfnD97/svd23vbeoCiAgICAgICAgYmFpZHUudW4gPSBiYWlkdS5ldmVudC51bjsKCiAgICAgICAgLy8vaW1wb3J0IGJhaWR1LmJyb3dzZXI7CiAgICAgICAgaWYgKC9tc2llIChcZCtcLlxkKS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHsKICAgICAgICAgICAgLy9JRSA4z8KjrNLUZG9jdW1lbnRNb2RlzqrXvAogICAgICAgICAgICAvL9TasNm2yMSjsOXW0KOsv8nE3Lvh09Ako6y3wNa5s+XNu6OsvaskMSDQtLPJIFx4MjQxCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiDF0LbPyse38c6qaWXkr8DAxvcKICAgICAgICAgICAgICogQHByb3BlcnR5IGllIGllsOaxvrrFCiAgICAgICAgICAgICAqIEBncmFtbWFyIGJhaWR1LmJyb3dzZXIuaWUKICAgICAgICAgICAgICogQG1ldGEgc3RhbmRhcmQKICAgICAgICAgICAgICogQHNob3J0Y3V0IGllCiAgICAgICAgICAgICAqIEBzZWUgYmFpZHUuYnJvd3Nlci5maXJlZm94LGJhaWR1LmJyb3dzZXIuc2FmYXJpLGJhaWR1LmJyb3dzZXIub3BlcmEsYmFpZHUuYnJvd3Nlci5jaHJvbWUsYmFpZHUuYnJvd3Nlci5tYXh0aG9uCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBiYWlkdS5icm93c2VyLmllID0gYmFpZHUuaWUgPSBkb2N1bWVudC5kb2N1bWVudE1vZGUgfHwgK1JlZ0V4cFsnXHgyNDEnXTsKICAgICAgICB9CgogICAgICAgIAogICAgICAgIC8qKgogICAgICAgICAqIEBuYW1lc3BhY2UgYmFpZHUucGxhdGZvcm0gxdC2z8a9zKjA4NDNus3M2NDUtcTK9NDUoaMKICAgICAgICAgKi8KICAgICAgICBiYWlkdS5wbGF0Zm9ybSA9IGJhaWR1LnBsYXRmb3JtIHx8IHt9OwoKICAgICAgICAvKioKICAgICAgICAgKiDF0LbPyse38c6qaXBob25lxr3MqAogICAgICAgICAqIEBwcm9wZXJ0eSBpcGhvbmUgyse38c6qaXBob25lxr3MqAogICAgICAgICAqIEBncmFtbWFyIGJhaWR1LnBsYXRmb3JtLmlwaG9uZQogICAgICAgICAqIEBtZXRhIHN0YW5kYXJkCiAgICAgICAgICogQHNlZSBiYWlkdS5wbGF0Zm9ybS54MTEsYmFpZHUucGxhdGZvcm0ud2luZG93cyxiYWlkdS5wbGF0Zm9ybS5tYWNpbnRvc2gsYmFpZHUucGxhdGZvcm0uaXBhZCxiYWlkdS5wbGF0Zm9ybS5hbmRyb2lkCiAgICAgICAgICovCiAgICAgICAgYmFpZHUucGxhdGZvcm0uaXNJcGhvbmUgPSAvaXBob25lL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KTsKCiAgICAgICAgLyoqCiAgICAgICAgICogxdC2z8rHt/HOqmFuZHJvaWTGvcyoCiAgICAgICAgICogQHByb3BlcnR5IGFuZHJvaWQgyse38c6qYW5kcm9pZMa9zKgKICAgICAgICAgKiBAZ3JhbW1hciBiYWlkdS5wbGF0Zm9ybS5hbmRyb2lkCiAgICAgICAgICogQG1ldGEgc3RhbmRhcmQKICAgICAgICAgKiBAc2VlIGJhaWR1LnBsYXRmb3JtLngxMSxiYWlkdS5wbGF0Zm9ybS53aW5kb3dzLGJhaWR1LnBsYXRmb3JtLm1hY2ludG9zaCxiYWlkdS5wbGF0Zm9ybS5pcGhvbmUsYmFpZHUucGxhdGZvcm0uaXBhZAogICAgICAgICAqIEBhdXRob3IganoKICAgICAgICAgKi8KICAgICAgICBiYWlkdS5wbGF0Zm9ybS5pc0FuZHJvaWQgPSAvYW5kcm9pZC9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCk7CiAgICAgICAgLyoKICAgICAgICAgKiBUYW5ncmFtCiAgICAgICAgICogQ29weXJpZ2h0IDIwMDkgQmFpZHUgSW5jLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogICAgICAgICAqLwoKICAgICAgICAvLy9pbXBvcnQgYmFpZHUucGxhdGZvcm07CgogICAgICAgIC8qKgogICAgICAgICAqIMXQts/Kx7fxzqppcGFkxr3MqAogICAgICAgICAqIEBwcm9wZXJ0eSBpcGFkIMrHt/HOqmlwYWTGvcyoCiAgICAgICAgICogQGdyYW1tYXIgYmFpZHUucGxhdGZvcm0uaXBhZAogICAgICAgICAqIEBtZXRhIHN0YW5kYXJkCiAgICAgICAgICogQHNlZSBiYWlkdS5wbGF0Zm9ybS54MTEsYmFpZHUucGxhdGZvcm0ud2luZG93cyxiYWlkdS5wbGF0Zm9ybS5tYWNpbnRvc2gsYmFpZHUucGxhdGZvcm0uaXBob25lLGJhaWR1LnBsYXRmb3JtLmFuZHJvaWQgICAKICAgICAgICAgKiBAYXV0aG9yIGp6CiAgICAgICAgICovCiAgICAgICAgYmFpZHUucGxhdGZvcm0uaXNJcGFkID0gL2lwYWQvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpOwoKICAgICAgICAvKioKICAgICAgICAgKiDKx7fxzqrSxravxr3MqAogICAgICAgICAqIEByZXR1cm5zIHtCb29sZWFufQogICAgICAgICAqLwogICAgICAgIGJhaWR1LmlzTW9iaWxlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiAhIShiYWlkdS5wbGF0Zm9ybS5pc0lwaG9uZSB8fCBiYWlkdS5wbGF0Zm9ybS5pc0lwYWQgfHwgYmFpZHUucGxhdGZvcm0uaXNBbmRyb2lkKTsKICAgICAgICB9CgogICAgfSkoKTsKCiAgICAvKiEKICAgICAqIGlTY3JvbGwgdjQuMi41IH4gQ29weXJpZ2h0IChjKSAyMDEyIE1hdHRlbyBTcGluZWxsaSwgaHR0cDovL2N1YmlxLm9yZwogICAgICogUmVsZWFzZWQgdW5kZXIgTUlUIGxpY2Vuc2UsIGh0dHA6Ly9jdWJpcS5vcmcvbGljZW5zZQogICAgICovCiAgICAoZnVuY3Rpb24od2luZG93LCBkb2MpewogICAgdmFyIG0gPSBNYXRoLAogICAgICAgIGR1bW15U3R5bGUgPSBkb2MuY3JlYXRlRWxlbWVudCgnZGl2Jykuc3R5bGUsCiAgICAgICAgdmVuZG9yID0gKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHZlbmRvcnMgPSAndCx3ZWJraXRULE1velQsbXNULE9UJy5zcGxpdCgnLCcpLAogICAgICAgICAgICAgICAgdCwKICAgICAgICAgICAgICAgIGkgPSAwLAogICAgICAgICAgICAgICAgbCA9IHZlbmRvcnMubGVuZ3RoOwoKICAgICAgICAgICAgZm9yICggOyBpIDwgbDsgaSsrICkgewogICAgICAgICAgICAgICAgdCA9IHZlbmRvcnNbaV0gKyAncmFuc2Zvcm0nOwogICAgICAgICAgICAgICAgaWYgKCB0IGluIGR1bW15U3R5bGUgKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZlbmRvcnNbaV0uc3Vic3RyKDAsIHZlbmRvcnNbaV0ubGVuZ3RoIC0gMSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9KSgpLAogICAgICAgIGNzc1ZlbmRvciA9IHZlbmRvciA/ICctJyArIHZlbmRvci50b0xvd2VyQ2FzZSgpICsgJy0nIDogJycsCgogICAgICAgIC8vIFN0eWxlIHByb3BlcnRpZXMKICAgICAgICB0cmFuc2Zvcm0gPSBwcmVmaXhTdHlsZSgndHJhbnNmb3JtJyksCiAgICAgICAgdHJhbnNpdGlvblByb3BlcnR5ID0gcHJlZml4U3R5bGUoJ3RyYW5zaXRpb25Qcm9wZXJ0eScpLAogICAgICAgIHRyYW5zaXRpb25EdXJhdGlvbiA9IHByZWZpeFN0eWxlKCd0cmFuc2l0aW9uRHVyYXRpb24nKSwKICAgICAgICB0cmFuc2Zvcm1PcmlnaW4gPSBwcmVmaXhTdHlsZSgndHJhbnNmb3JtT3JpZ2luJyksCiAgICAgICAgdHJhbnNpdGlvblRpbWluZ0Z1bmN0aW9uID0gcHJlZml4U3R5bGUoJ3RyYW5zaXRpb25UaW1pbmdGdW5jdGlvbicpLAogICAgICAgIHRyYW5zaXRpb25EZWxheSA9IHByZWZpeFN0eWxlKCd0cmFuc2l0aW9uRGVsYXknKSwKCiAgICAgICAgLy8gQnJvd3NlciBjYXBhYmlsaXRpZXMKICAgICAgICBpc0FuZHJvaWQgPSAoL2FuZHJvaWQvZ2kpLnRlc3QobmF2aWdhdG9yLmFwcFZlcnNpb24pLAogICAgICAgIGlzSURldmljZSA9ICgvaXBob25lfGlwYWQvZ2kpLnRlc3QobmF2aWdhdG9yLmFwcFZlcnNpb24pLAogICAgICAgIGlzVG91Y2hQYWQgPSAoL2hwLXRhYmxldC9naSkudGVzdChuYXZpZ2F0b3IuYXBwVmVyc2lvbiksCgogICAgICAgIGhhczNkID0gcHJlZml4U3R5bGUoJ3BlcnNwZWN0aXZlJykgaW4gZHVtbXlTdHlsZSwKICAgICAgICBoYXNUb3VjaCA9ICdvbnRvdWNoc3RhcnQnIGluIHdpbmRvdyAmJiAhaXNUb3VjaFBhZCwKICAgICAgICBoYXNUcmFuc2Zvcm0gPSB2ZW5kb3IgIT09IGZhbHNlLAogICAgICAgIGhhc1RyYW5zaXRpb25FbmQgPSBwcmVmaXhTdHlsZSgndHJhbnNpdGlvbicpIGluIGR1bW15U3R5bGUsCgogICAgICAgIFJFU0laRV9FViA9ICdvbm9yaWVudGF0aW9uY2hhbmdlJyBpbiB3aW5kb3cgPyAnb3JpZW50YXRpb25jaGFuZ2UnIDogJ3Jlc2l6ZScsCiAgICAgICAgU1RBUlRfRVYgPSBoYXNUb3VjaCA/ICd0b3VjaHN0YXJ0JyA6ICdtb3VzZWRvd24nLAogICAgICAgIE1PVkVfRVYgPSBoYXNUb3VjaCA/ICd0b3VjaG1vdmUnIDogJ21vdXNlbW92ZScsCiAgICAgICAgRU5EX0VWID0gaGFzVG91Y2ggPyAndG91Y2hlbmQnIDogJ21vdXNldXAnLAogICAgICAgIENBTkNFTF9FViA9IGhhc1RvdWNoID8gJ3RvdWNoY2FuY2VsJyA6ICdtb3VzZXVwJywKICAgICAgICBUUk5FTkRfRVYgPSAoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAoIHZlbmRvciA9PT0gZmFsc2UgKSByZXR1cm4gZmFsc2U7CgogICAgICAgICAgICB2YXIgdHJhbnNpdGlvbkVuZCA9IHsKICAgICAgICAgICAgICAgICAgICAnJwkJCTogJ3RyYW5zaXRpb25lbmQnLAogICAgICAgICAgICAgICAgICAgICd3ZWJraXQnCTogJ3dlYmtpdFRyYW5zaXRpb25FbmQnLAogICAgICAgICAgICAgICAgICAgICdNb3onCQk6ICd0cmFuc2l0aW9uZW5kJywKICAgICAgICAgICAgICAgICAgICAnTycJCQk6ICdvdHJhbnNpdGlvbmVuZCcsCiAgICAgICAgICAgICAgICAgICAgJ21zJwkJOiAnTVNUcmFuc2l0aW9uRW5kJwogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHJldHVybiB0cmFuc2l0aW9uRW5kW3ZlbmRvcl07CiAgICAgICAgfSkoKSwKCiAgICAgICAgbmV4dEZyYW1lID0gKGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSB8fAogICAgICAgICAgICAgICAgd2luZG93LndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSB8fAogICAgICAgICAgICAgICAgd2luZG93Lm1velJlcXVlc3RBbmltYXRpb25GcmFtZSB8fAogICAgICAgICAgICAgICAgd2luZG93Lm9SZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwKICAgICAgICAgICAgICAgIHdpbmRvdy5tc1JlcXVlc3RBbmltYXRpb25GcmFtZSB8fAogICAgICAgICAgICAgICAgZnVuY3Rpb24oY2FsbGJhY2spIHsgcmV0dXJuIHNldFRpbWVvdXQoY2FsbGJhY2ssIDEpOyB9OwogICAgICAgIH0pKCksCiAgICAgICAgY2FuY2VsRnJhbWUgPSAoZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gd2luZG93LmNhbmNlbFJlcXVlc3RBbmltYXRpb25GcmFtZSB8fAogICAgICAgICAgICAgICAgd2luZG93LndlYmtpdENhbmNlbEFuaW1hdGlvbkZyYW1lIHx8CiAgICAgICAgICAgICAgICB3aW5kb3cud2Via2l0Q2FuY2VsUmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8CiAgICAgICAgICAgICAgICB3aW5kb3cubW96Q2FuY2VsUmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8CiAgICAgICAgICAgICAgICB3aW5kb3cub0NhbmNlbFJlcXVlc3RBbmltYXRpb25GcmFtZSB8fAogICAgICAgICAgICAgICAgd2luZG93Lm1zQ2FuY2VsUmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8CiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQ7CiAgICAgICAgfSkoKSwKCiAgICAgICAgLy8gSGVscGVycwogICAgICAgIHRyYW5zbGF0ZVogPSBoYXMzZCA/ICcgdHJhbnNsYXRlWigwKScgOiAnJywKCiAgICAgICAgLy8gQ29uc3RydWN0b3IKICAgICAgICBpU2Nyb2xsID0gZnVuY3Rpb24gKGVsLCBvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywKICAgICAgICAgICAgICAgIGk7CgogICAgICAgICAgICB0aGF0LndyYXBwZXIgPSB0eXBlb2YgZWwgPT0gJ29iamVjdCcgPyBlbCA6IGRvYy5nZXRFbGVtZW50QnlJZChlbCk7CiAgICAgICAgICAgIHRoYXQud3JhcHBlci5zdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nOwogICAgICAgICAgICB0aGF0LnNjcm9sbGVyID0gdGhhdC53cmFwcGVyLmNoaWxkcmVuWzBdOwoKICAgICAgICAgICAgLy8gRGVmYXVsdCBvcHRpb25zCiAgICAgICAgICAgIHRoYXQub3B0aW9ucyA9IHsKICAgICAgICAgICAgICAgIGhTY3JvbGw6IHRydWUsCiAgICAgICAgICAgICAgICB2U2Nyb2xsOiB0cnVlLAogICAgICAgICAgICAgICAgeDogMCwKICAgICAgICAgICAgICAgIHk6IDAsCiAgICAgICAgICAgICAgICBib3VuY2U6IHRydWUsCiAgICAgICAgICAgICAgICBib3VuY2VMb2NrOiBmYWxzZSwKICAgICAgICAgICAgICAgIG1vbWVudHVtOiB0cnVlLAogICAgICAgICAgICAgICAgbG9ja0RpcmVjdGlvbjogdHJ1ZSwKICAgICAgICAgICAgICAgIHVzZVRyYW5zZm9ybTogdHJ1ZSwKICAgICAgICAgICAgICAgIHVzZVRyYW5zaXRpb246IGZhbHNlLAogICAgICAgICAgICAgICAgdG9wT2Zmc2V0OiAwLAogICAgICAgICAgICAgICAgY2hlY2tET01DaGFuZ2VzOiBmYWxzZSwJCS8vIEV4cGVyaW1lbnRhbAogICAgICAgICAgICAgICAgaGFuZGxlQ2xpY2s6IHRydWUsCgogICAgICAgICAgICAgICAgLy8gU2Nyb2xsYmFyCiAgICAgICAgICAgICAgICBoU2Nyb2xsYmFyOiB0cnVlLAogICAgICAgICAgICAgICAgdlNjcm9sbGJhcjogdHJ1ZSwKICAgICAgICAgICAgICAgIGZpeGVkU2Nyb2xsYmFyOiBpc0FuZHJvaWQsCiAgICAgICAgICAgICAgICBoaWRlU2Nyb2xsYmFyOiBpc0lEZXZpY2UsCiAgICAgICAgICAgICAgICBmYWRlU2Nyb2xsYmFyOiBpc0lEZXZpY2UgJiYgaGFzM2QsCiAgICAgICAgICAgICAgICBzY3JvbGxiYXJDbGFzczogJycsCgogICAgICAgICAgICAgICAgLy8gWm9vbQogICAgICAgICAgICAgICAgem9vbTogZmFsc2UsCiAgICAgICAgICAgICAgICB6b29tTWluOiAxLAogICAgICAgICAgICAgICAgem9vbU1heDogNCwKICAgICAgICAgICAgICAgIGRvdWJsZVRhcFpvb206IDIsCiAgICAgICAgICAgICAgICB3aGVlbEFjdGlvbjogJ3Njcm9sbCcsCgogICAgICAgICAgICAgICAgLy8gU25hcAogICAgICAgICAgICAgICAgc25hcDogZmFsc2UsCiAgICAgICAgICAgICAgICBzbmFwVGhyZXNob2xkOiAxLAoKICAgICAgICAgICAgICAgIC8vIEV2ZW50cwogICAgICAgICAgICAgICAgb25SZWZyZXNoOiBudWxsLAogICAgICAgICAgICAgICAgb25CZWZvcmVTY3JvbGxTdGFydDogZnVuY3Rpb24gKGUpIHsgZS5wcmV2ZW50RGVmYXVsdCgpOyB9LAogICAgICAgICAgICAgICAgb25TY3JvbGxTdGFydDogbnVsbCwKICAgICAgICAgICAgICAgIG9uQmVmb3JlU2Nyb2xsTW92ZTogbnVsbCwKICAgICAgICAgICAgICAgIG9uU2Nyb2xsTW92ZTogbnVsbCwKICAgICAgICAgICAgICAgIG9uQmVmb3JlU2Nyb2xsRW5kOiBudWxsLAogICAgICAgICAgICAgICAgb25TY3JvbGxFbmQ6IG51bGwsCiAgICAgICAgICAgICAgICBvblRvdWNoRW5kOiBudWxsLAogICAgICAgICAgICAgICAgb25EZXN0cm95OiBudWxsLAogICAgICAgICAgICAgICAgb25ab29tU3RhcnQ6IG51bGwsCiAgICAgICAgICAgICAgICBvblpvb206IG51bGwsCiAgICAgICAgICAgICAgICBvblpvb21FbmQ6IG51bGwKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vIFVzZXIgZGVmaW5lZCBvcHRpb25zCiAgICAgICAgICAgIGZvciAoaSBpbiBvcHRpb25zKSB0aGF0Lm9wdGlvbnNbaV0gPSBvcHRpb25zW2ldOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU2V0IHN0YXJ0aW5nIHBvc2l0aW9uCiAgICAgICAgICAgIHRoYXQueCA9IHRoYXQub3B0aW9ucy54OwogICAgICAgICAgICB0aGF0LnkgPSB0aGF0Lm9wdGlvbnMueTsKCiAgICAgICAgICAgIC8vIE5vcm1hbGl6ZSBvcHRpb25zCiAgICAgICAgICAgIHRoYXQub3B0aW9ucy51c2VUcmFuc2Zvcm0gPSBoYXNUcmFuc2Zvcm0gJiYgdGhhdC5vcHRpb25zLnVzZVRyYW5zZm9ybTsKICAgICAgICAgICAgdGhhdC5vcHRpb25zLmhTY3JvbGxiYXIgPSB0aGF0Lm9wdGlvbnMuaFNjcm9sbCAmJiB0aGF0Lm9wdGlvbnMuaFNjcm9sbGJhcjsKICAgICAgICAgICAgdGhhdC5vcHRpb25zLnZTY3JvbGxiYXIgPSB0aGF0Lm9wdGlvbnMudlNjcm9sbCAmJiB0aGF0Lm9wdGlvbnMudlNjcm9sbGJhcjsKICAgICAgICAgICAgdGhhdC5vcHRpb25zLnpvb20gPSB0aGF0Lm9wdGlvbnMudXNlVHJhbnNmb3JtICYmIHRoYXQub3B0aW9ucy56b29tOwogICAgICAgICAgICB0aGF0Lm9wdGlvbnMudXNlVHJhbnNpdGlvbiA9IGhhc1RyYW5zaXRpb25FbmQgJiYgdGhhdC5vcHRpb25zLnVzZVRyYW5zaXRpb247CgogICAgICAgICAgICAvLyBIZWxwZXJzIEZJWCBBTkRST0lEIEJVRyEKICAgICAgICAgICAgLy8gdHJhbnNsYXRlM2QgYW5kIHNjYWxlIGRvZXNuJ3Qgd29yayB0b2dldGhlciEKICAgICAgICAgICAgLy8gSWdub3JpbmcgM2QgT05MWSBXSEVOIFlPVSBTRVQgdGhhdC5vcHRpb25zLnpvb20KICAgICAgICAgICAgaWYgKCB0aGF0Lm9wdGlvbnMuem9vbSAmJiBpc0FuZHJvaWQgKXsKICAgICAgICAgICAgICAgIHRyYW5zbGF0ZVogPSAnJzsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU2V0IHNvbWUgZGVmYXVsdCBzdHlsZXMKICAgICAgICAgICAgdGhhdC5zY3JvbGxlci5zdHlsZVt0cmFuc2l0aW9uUHJvcGVydHldID0gdGhhdC5vcHRpb25zLnVzZVRyYW5zZm9ybSA/IGNzc1ZlbmRvciArICd0cmFuc2Zvcm0nIDogJ3RvcCBsZWZ0JzsKICAgICAgICAgICAgdGhhdC5zY3JvbGxlci5zdHlsZVt0cmFuc2l0aW9uRHVyYXRpb25dID0gJzAnOwogICAgICAgICAgICB0aGF0LnNjcm9sbGVyLnN0eWxlW3RyYW5zZm9ybU9yaWdpbl0gPSAnMCAwJzsKICAgICAgICAgICAgaWYgKHRoYXQub3B0aW9ucy51c2VUcmFuc2l0aW9uKSB0aGF0LnNjcm9sbGVyLnN0eWxlW3RyYW5zaXRpb25UaW1pbmdGdW5jdGlvbl0gPSAnY3ViaWMtYmV6aWVyKDAuMzMsMC42NiwwLjY2LDEpJzsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh0aGF0Lm9wdGlvbnMudXNlVHJhbnNmb3JtKSB0aGF0LnNjcm9sbGVyLnN0eWxlW3RyYW5zZm9ybV0gPSAndHJhbnNsYXRlKCcgKyB0aGF0LnggKyAncHgsJyArIHRoYXQueSArICdweCknICsgdHJhbnNsYXRlWjsKICAgICAgICAgICAgZWxzZSB0aGF0LnNjcm9sbGVyLnN0eWxlLmNzc1RleHQgKz0gJztwb3NpdGlvbjphYnNvbHV0ZTt0b3A6JyArIHRoYXQueSArICdweDtsZWZ0OicgKyB0aGF0LnggKyAncHgnOwoKICAgICAgICAgICAgaWYgKHRoYXQub3B0aW9ucy51c2VUcmFuc2l0aW9uKSB0aGF0Lm9wdGlvbnMuZml4ZWRTY3JvbGxiYXIgPSB0cnVlOwoKICAgICAgICAgICAgdGhhdC5yZWZyZXNoKCk7CgogICAgICAgICAgICB0aGF0Ll9iaW5kKFJFU0laRV9FViwgd2luZG93KTsKICAgICAgICAgICAgdGhhdC5fYmluZChTVEFSVF9FVik7CiAgICAgICAgICAgIGlmICghaGFzVG91Y2gpIHsKICAgICAgICAgICAgICAgIGlmICh0aGF0Lm9wdGlvbnMud2hlZWxBY3Rpb24gIT0gJ25vbmUnKSB7CiAgICAgICAgICAgICAgICAgICAgdGhhdC5fYmluZCgnRE9NTW91c2VTY3JvbGwnKTsKICAgICAgICAgICAgICAgICAgICB0aGF0Ll9iaW5kKCdtb3VzZXdoZWVsJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0aGF0Lm9wdGlvbnMuY2hlY2tET01DaGFuZ2VzKSB0aGF0LmNoZWNrRE9NVGltZSA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRoYXQuX2NoZWNrRE9NQ2hhbmdlcygpOwogICAgICAgICAgICB9LCA1MDApOwogICAgICAgIH07CgogICAgLy8gUHJvdG90eXBlCiAgICBpU2Nyb2xsLnByb3RvdHlwZSA9IHsKICAgICAgICBlbmFibGVkOiB0cnVlLAogICAgICAgIHg6IDAsCiAgICAgICAgeTogMCwKICAgICAgICBzdGVwczogW10sCiAgICAgICAgc2NhbGU6IDEsCiAgICAgICAgY3VyclBhZ2VYOiAwLCBjdXJyUGFnZVk6IDAsCiAgICAgICAgcGFnZXNYOiBbXSwgcGFnZXNZOiBbXSwKICAgICAgICBhbmlUaW1lOiBudWxsLAogICAgICAgIHdoZWVsWm9vbUNvdW50OiAwLAogICAgICAgIAogICAgICAgIGhhbmRsZUV2ZW50OiBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7CiAgICAgICAgICAgIHN3aXRjaChlLnR5cGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgU1RBUlRfRVY6CiAgICAgICAgICAgICAgICAgICAgaWYgKCFoYXNUb3VjaCAmJiBlLmJ1dHRvbiAhPT0gMCkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIHRoYXQuX3N0YXJ0KGUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBNT1ZFX0VWOiB0aGF0Ll9tb3ZlKGUpOyBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRU5EX0VWOgogICAgICAgICAgICAgICAgY2FzZSBDQU5DRUxfRVY6IHRoYXQuX2VuZChlKTsgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFJFU0laRV9FVjogdGhhdC5fcmVzaXplKCk7IGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnRE9NTW91c2VTY3JvbGwnOiBjYXNlICdtb3VzZXdoZWVsJzogdGhhdC5fd2hlZWwoZSk7IGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBUUk5FTkRfRVY6IHRoYXQuX3RyYW5zaXRpb25FbmQoZSk7IGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAKICAgICAgICBfY2hlY2tET01DaGFuZ2VzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLm1vdmVkIHx8IHRoaXMuem9vbWVkIHx8IHRoaXMuYW5pbWF0aW5nIHx8CiAgICAgICAgICAgICAgICAodGhpcy5zY3JvbGxlclcgPT0gdGhpcy5zY3JvbGxlci5vZmZzZXRXaWR0aCAqIHRoaXMuc2NhbGUgJiYgdGhpcy5zY3JvbGxlckggPT0gdGhpcy5zY3JvbGxlci5vZmZzZXRIZWlnaHQgKiB0aGlzLnNjYWxlKSkgcmV0dXJuOwoKICAgICAgICAgICAgdGhpcy5yZWZyZXNoKCk7CiAgICAgICAgfSwKICAgICAgICAKICAgICAgICBfc2Nyb2xsYmFyOiBmdW5jdGlvbiAoZGlyKSB7CiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywKICAgICAgICAgICAgICAgIGJhcjsKCiAgICAgICAgICAgIGlmICghdGhhdFtkaXIgKyAnU2Nyb2xsYmFyJ10pIHsKICAgICAgICAgICAgICAgIGlmICh0aGF0W2RpciArICdTY3JvbGxiYXJXcmFwcGVyJ10pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaGFzVHJhbnNmb3JtKSB0aGF0W2RpciArICdTY3JvbGxiYXJJbmRpY2F0b3InXS5zdHlsZVt0cmFuc2Zvcm1dID0gJyc7CiAgICAgICAgICAgICAgICAgICAgdGhhdFtkaXIgKyAnU2Nyb2xsYmFyV3JhcHBlciddLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhhdFtkaXIgKyAnU2Nyb2xsYmFyV3JhcHBlciddKTsKICAgICAgICAgICAgICAgICAgICB0aGF0W2RpciArICdTY3JvbGxiYXJXcmFwcGVyJ10gPSBudWxsOwogICAgICAgICAgICAgICAgICAgIHRoYXRbZGlyICsgJ1Njcm9sbGJhckluZGljYXRvciddID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghdGhhdFtkaXIgKyAnU2Nyb2xsYmFyV3JhcHBlciddKSB7CiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgdGhlIHNjcm9sbGJhciB3cmFwcGVyCiAgICAgICAgICAgICAgICBiYXIgPSBkb2MuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgogICAgICAgICAgICAgICAgaWYgKHRoYXQub3B0aW9ucy5zY3JvbGxiYXJDbGFzcykgYmFyLmNsYXNzTmFtZSA9IHRoYXQub3B0aW9ucy5zY3JvbGxiYXJDbGFzcyArIGRpci50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgICAgICAgZWxzZSBiYXIuc3R5bGUuY3NzVGV4dCA9ICdwb3NpdGlvbjphYnNvbHV0ZTt6LWluZGV4OjEwMDsnICsgKGRpciA9PSAnaCcgPyAnaGVpZ2h0OjdweDtib3R0b206MXB4O2xlZnQ6MnB4O3JpZ2h0OicgKyAodGhhdC52U2Nyb2xsYmFyID8gJzcnIDogJzInKSArICdweCcgOiAnd2lkdGg6N3B4O2JvdHRvbTonICsgKHRoYXQuaFNjcm9sbGJhciA/ICc3JyA6ICcyJykgKyAncHg7dG9wOjJweDtyaWdodDoxcHgnKTsKCiAgICAgICAgICAgICAgICBiYXIuc3R5bGUuY3NzVGV4dCArPSAnO3BvaW50ZXItZXZlbnRzOm5vbmU7JyArIGNzc1ZlbmRvciArICd0cmFuc2l0aW9uLXByb3BlcnR5Om9wYWNpdHk7JyArIGNzc1ZlbmRvciArICd0cmFuc2l0aW9uLWR1cmF0aW9uOicgKyAodGhhdC5vcHRpb25zLmZhZGVTY3JvbGxiYXIgPyAnMzUwbXMnIDogJzAnKSArICc7b3ZlcmZsb3c6aGlkZGVuO29wYWNpdHk6JyArICh0aGF0Lm9wdGlvbnMuaGlkZVNjcm9sbGJhciA/ICcwJyA6ICcxJyk7CgogICAgICAgICAgICAgICAgdGhhdC53cmFwcGVyLmFwcGVuZENoaWxkKGJhcik7CiAgICAgICAgICAgICAgICB0aGF0W2RpciArICdTY3JvbGxiYXJXcmFwcGVyJ10gPSBiYXI7CgogICAgICAgICAgICAgICAgLy8gQ3JlYXRlIHRoZSBzY3JvbGxiYXIgaW5kaWNhdG9yCiAgICAgICAgICAgICAgICBiYXIgPSBkb2MuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICBpZiAoIXRoYXQub3B0aW9ucy5zY3JvbGxiYXJDbGFzcykgewogICAgICAgICAgICAgICAgICAgIGJhci5zdHlsZS5jc3NUZXh0ID0gJ3Bvc2l0aW9uOmFic29sdXRlO3otaW5kZXg6MTAwO2JhY2tncm91bmQ6cmdiYSgwLDAsMCwwLjUpO2JvcmRlcjoxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwwLjkpOycgKyBjc3NWZW5kb3IgKyAnYmFja2dyb3VuZC1jbGlwOnBhZGRpbmctYm94OycgKyBjc3NWZW5kb3IgKyAnYm94LXNpemluZzpib3JkZXItYm94OycgKyAoZGlyID09ICdoJyA/ICdoZWlnaHQ6MTAwJScgOiAnd2lkdGg6MTAwJScpICsgJzsnICsgY3NzVmVuZG9yICsgJ2JvcmRlci1yYWRpdXM6M3B4O2JvcmRlci1yYWRpdXM6M3B4JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJhci5zdHlsZS5jc3NUZXh0ICs9ICc7cG9pbnRlci1ldmVudHM6bm9uZTsnICsgY3NzVmVuZG9yICsgJ3RyYW5zaXRpb24tcHJvcGVydHk6JyArIGNzc1ZlbmRvciArICd0cmFuc2Zvcm07JyArIGNzc1ZlbmRvciArICd0cmFuc2l0aW9uLXRpbWluZy1mdW5jdGlvbjpjdWJpYy1iZXppZXIoMC4zMywwLjY2LDAuNjYsMSk7JyArIGNzc1ZlbmRvciArICd0cmFuc2l0aW9uLWR1cmF0aW9uOjA7JyArIGNzc1ZlbmRvciArICd0cmFuc2Zvcm06IHRyYW5zbGF0ZSgwLDApJyArIHRyYW5zbGF0ZVo7CiAgICAgICAgICAgICAgICBpZiAodGhhdC5vcHRpb25zLnVzZVRyYW5zaXRpb24pIGJhci5zdHlsZS5jc3NUZXh0ICs9ICc7JyArIGNzc1ZlbmRvciArICd0cmFuc2l0aW9uLXRpbWluZy1mdW5jdGlvbjpjdWJpYy1iZXppZXIoMC4zMywwLjY2LDAuNjYsMSknOwoKICAgICAgICAgICAgICAgIHRoYXRbZGlyICsgJ1Njcm9sbGJhcldyYXBwZXInXS5hcHBlbmRDaGlsZChiYXIpOwogICAgICAgICAgICAgICAgdGhhdFtkaXIgKyAnU2Nyb2xsYmFySW5kaWNhdG9yJ10gPSBiYXI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChkaXIgPT0gJ2gnKSB7CiAgICAgICAgICAgICAgICB0aGF0LmhTY3JvbGxiYXJTaXplID0gdGhhdC5oU2Nyb2xsYmFyV3JhcHBlci5jbGllbnRXaWR0aDsKICAgICAgICAgICAgICAgIHRoYXQuaFNjcm9sbGJhckluZGljYXRvclNpemUgPSBtLm1heChtLnJvdW5kKHRoYXQuaFNjcm9sbGJhclNpemUgKiB0aGF0LmhTY3JvbGxiYXJTaXplIC8gdGhhdC5zY3JvbGxlclcpLCA4KTsKICAgICAgICAgICAgICAgIHRoYXQuaFNjcm9sbGJhckluZGljYXRvci5zdHlsZS53aWR0aCA9IHRoYXQuaFNjcm9sbGJhckluZGljYXRvclNpemUgKyAncHgnOwogICAgICAgICAgICAgICAgdGhhdC5oU2Nyb2xsYmFyTWF4U2Nyb2xsID0gdGhhdC5oU2Nyb2xsYmFyU2l6ZSAtIHRoYXQuaFNjcm9sbGJhckluZGljYXRvclNpemU7CiAgICAgICAgICAgICAgICB0aGF0LmhTY3JvbGxiYXJQcm9wID0gdGhhdC5oU2Nyb2xsYmFyTWF4U2Nyb2xsIC8gdGhhdC5tYXhTY3JvbGxYOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhhdC52U2Nyb2xsYmFyU2l6ZSA9IHRoYXQudlNjcm9sbGJhcldyYXBwZXIuY2xpZW50SGVpZ2h0OwogICAgICAgICAgICAgICAgdGhhdC52U2Nyb2xsYmFySW5kaWNhdG9yU2l6ZSA9IG0ubWF4KG0ucm91bmQodGhhdC52U2Nyb2xsYmFyU2l6ZSAqIHRoYXQudlNjcm9sbGJhclNpemUgLyB0aGF0LnNjcm9sbGVySCksIDgpOwogICAgICAgICAgICAgICAgdGhhdC52U2Nyb2xsYmFySW5kaWNhdG9yLnN0eWxlLmhlaWdodCA9IHRoYXQudlNjcm9sbGJhckluZGljYXRvclNpemUgKyAncHgnOwogICAgICAgICAgICAgICAgdGhhdC52U2Nyb2xsYmFyTWF4U2Nyb2xsID0gdGhhdC52U2Nyb2xsYmFyU2l6ZSAtIHRoYXQudlNjcm9sbGJhckluZGljYXRvclNpemU7CiAgICAgICAgICAgICAgICB0aGF0LnZTY3JvbGxiYXJQcm9wID0gdGhhdC52U2Nyb2xsYmFyTWF4U2Nyb2xsIC8gdGhhdC5tYXhTY3JvbGxZOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBSZXNldCBwb3NpdGlvbgogICAgICAgICAgICB0aGF0Ll9zY3JvbGxiYXJQb3MoZGlyLCB0cnVlKTsKICAgICAgICB9LAogICAgICAgIAogICAgICAgIF9yZXNpemU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzOwogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgdGhhdC5yZWZyZXNoKCk7IH0sIGlzQW5kcm9pZCA/IDIwMCA6IDApOwogICAgICAgIH0sCiAgICAgICAgCiAgICAgICAgX3BvczogZnVuY3Rpb24gKHgsIHkpIHsKICAgICAgICAgICAgaWYgKHRoaXMuem9vbWVkKSByZXR1cm47CgogICAgICAgICAgICB4ID0gdGhpcy5oU2Nyb2xsID8geCA6IDA7CiAgICAgICAgICAgIHkgPSB0aGlzLnZTY3JvbGwgPyB5IDogMDsKCiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMudXNlVHJhbnNmb3JtKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNjcm9sbGVyLnN0eWxlW3RyYW5zZm9ybV0gPSAndHJhbnNsYXRlKCcgKyB4ICsgJ3B4LCcgKyB5ICsgJ3B4KSBzY2FsZSgnICsgdGhpcy5zY2FsZSArICcpJyArIHRyYW5zbGF0ZVo7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB4ID0gbS5yb3VuZCh4KTsKICAgICAgICAgICAgICAgIHkgPSBtLnJvdW5kKHkpOwogICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxlci5zdHlsZS5sZWZ0ID0geCArICdweCc7CiAgICAgICAgICAgICAgICB0aGlzLnNjcm9sbGVyLnN0eWxlLnRvcCA9IHkgKyAncHgnOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLnggPSB4OwogICAgICAgICAgICB0aGlzLnkgPSB5OwoKICAgICAgICAgICAgdGhpcy5fc2Nyb2xsYmFyUG9zKCdoJyk7CiAgICAgICAgICAgIHRoaXMuX3Njcm9sbGJhclBvcygndicpOwogICAgICAgIH0sCgogICAgICAgIF9zY3JvbGxiYXJQb3M6IGZ1bmN0aW9uIChkaXIsIGhpZGRlbikgewogICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsCiAgICAgICAgICAgICAgICBwb3MgPSBkaXIgPT0gJ2gnID8gdGhhdC54IDogdGhhdC55LAogICAgICAgICAgICAgICAgc2l6ZTsKCiAgICAgICAgICAgIGlmICghdGhhdFtkaXIgKyAnU2Nyb2xsYmFyJ10pIHJldHVybjsKCiAgICAgICAgICAgIHBvcyA9IHRoYXRbZGlyICsgJ1Njcm9sbGJhclByb3AnXSAqIHBvczsKCiAgICAgICAgICAgIGlmIChwb3MgPCAwKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoYXQub3B0aW9ucy5maXhlZFNjcm9sbGJhcikgewogICAgICAgICAgICAgICAgICAgIHNpemUgPSB0aGF0W2RpciArICdTY3JvbGxiYXJJbmRpY2F0b3JTaXplJ10gKyBtLnJvdW5kKHBvcyAqIDMpOwogICAgICAgICAgICAgICAgICAgIGlmIChzaXplIDwgOCkgc2l6ZSA9IDg7CiAgICAgICAgICAgICAgICAgICAgdGhhdFtkaXIgKyAnU2Nyb2xsYmFySW5kaWNhdG9yJ10uc3R5bGVbZGlyID09ICdoJyA/ICd3aWR0aCcgOiAnaGVpZ2h0J10gPSBzaXplICsgJ3B4JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHBvcyA9IDA7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocG9zID4gdGhhdFtkaXIgKyAnU2Nyb2xsYmFyTWF4U2Nyb2xsJ10pIHsKICAgICAgICAgICAgICAgIGlmICghdGhhdC5vcHRpb25zLmZpeGVkU2Nyb2xsYmFyKSB7CiAgICAgICAgICAgICAgICAgICAgc2l6ZSA9IHRoYXRbZGlyICsgJ1Njcm9sbGJhckluZGljYXRvclNpemUnXSAtIG0ucm91bmQoKHBvcyAtIHRoYXRbZGlyICsgJ1Njcm9sbGJhck1heFNjcm9sbCddKSAqIDMpOwogICAgICAgICAgICAgICAgICAgIGlmIChzaXplIDwgOCkgc2l6ZSA9IDg7CiAgICAgICAgICAgICAgICAgICAgdGhhdFtkaXIgKyAnU2Nyb2xsYmFySW5kaWNhdG9yJ10uc3R5bGVbZGlyID09ICdoJyA/ICd3aWR0aCcgOiAnaGVpZ2h0J10gPSBzaXplICsgJ3B4JzsKICAgICAgICAgICAgICAgICAgICBwb3MgPSB0aGF0W2RpciArICdTY3JvbGxiYXJNYXhTY3JvbGwnXSArICh0aGF0W2RpciArICdTY3JvbGxiYXJJbmRpY2F0b3JTaXplJ10gLSBzaXplKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcG9zID0gdGhhdFtkaXIgKyAnU2Nyb2xsYmFyTWF4U2Nyb2xsJ107CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoYXRbZGlyICsgJ1Njcm9sbGJhcldyYXBwZXInXS5zdHlsZVt0cmFuc2l0aW9uRGVsYXldID0gJzAnOwogICAgICAgICAgICB0aGF0W2RpciArICdTY3JvbGxiYXJXcmFwcGVyJ10uc3R5bGUub3BhY2l0eSA9IGhpZGRlbiAmJiB0aGF0Lm9wdGlvbnMuaGlkZVNjcm9sbGJhciA/ICcwJyA6ICcxJzsKICAgICAgICAgICAgdGhhdFtkaXIgKyAnU2Nyb2xsYmFySW5kaWNhdG9yJ10uc3R5bGVbdHJhbnNmb3JtXSA9ICd0cmFuc2xhdGUoJyArIChkaXIgPT0gJ2gnID8gcG9zICsgJ3B4LDApJyA6ICcwLCcgKyBwb3MgKyAncHgpJykgKyB0cmFuc2xhdGVaOwogICAgICAgIH0sCiAgICAgICAgCiAgICAgICAgX3N0YXJ0OiBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsCiAgICAgICAgICAgICAgICBwb2ludCA9IGhhc1RvdWNoID8gZS50b3VjaGVzWzBdIDogZSwKICAgICAgICAgICAgICAgIG1hdHJpeCwgeCwgeSwKICAgICAgICAgICAgICAgIGMxLCBjMjsKCiAgICAgICAgICAgIGlmICghdGhhdC5lbmFibGVkKSByZXR1cm47CgogICAgICAgICAgICBpZiAodGhhdC5vcHRpb25zLm9uQmVmb3JlU2Nyb2xsU3RhcnQpIHRoYXQub3B0aW9ucy5vbkJlZm9yZVNjcm9sbFN0YXJ0LmNhbGwodGhhdCwgZSk7CgogICAgICAgICAgICBpZiAodGhhdC5vcHRpb25zLnVzZVRyYW5zaXRpb24gfHwgdGhhdC5vcHRpb25zLnpvb20pIHRoYXQuX3RyYW5zaXRpb25UaW1lKDApOwoKICAgICAgICAgICAgdGhhdC5tb3ZlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGF0LmFuaW1hdGluZyA9IGZhbHNlOwogICAgICAgICAgICB0aGF0Lnpvb21lZCA9IGZhbHNlOwogICAgICAgICAgICB0aGF0LmRpc3RYID0gMDsKICAgICAgICAgICAgdGhhdC5kaXN0WSA9IDA7CiAgICAgICAgICAgIHRoYXQuYWJzRGlzdFggPSAwOwogICAgICAgICAgICB0aGF0LmFic0Rpc3RZID0gMDsKICAgICAgICAgICAgdGhhdC5kaXJYID0gMDsKICAgICAgICAgICAgdGhhdC5kaXJZID0gMDsKCiAgICAgICAgICAgIC8vIEdlc3R1cmUgc3RhcnQKICAgICAgICAgICAgaWYgKHRoYXQub3B0aW9ucy56b29tICYmIGhhc1RvdWNoICYmIGUudG91Y2hlcy5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICBjMSA9IG0uYWJzKGUudG91Y2hlc1swXS5wYWdlWC1lLnRvdWNoZXNbMV0ucGFnZVgpOwogICAgICAgICAgICAgICAgYzIgPSBtLmFicyhlLnRvdWNoZXNbMF0ucGFnZVktZS50b3VjaGVzWzFdLnBhZ2VZKTsKICAgICAgICAgICAgICAgIHRoYXQudG91Y2hlc0Rpc3RTdGFydCA9IG0uc3FydChjMSAqIGMxICsgYzIgKiBjMik7CgogICAgICAgICAgICAgICAgdGhhdC5vcmlnaW5YID0gbS5hYnMoZS50b3VjaGVzWzBdLnBhZ2VYICsgZS50b3VjaGVzWzFdLnBhZ2VYIC0gdGhhdC53cmFwcGVyT2Zmc2V0TGVmdCAqIDIpIC8gMiAtIHRoYXQueDsKICAgICAgICAgICAgICAgIHRoYXQub3JpZ2luWSA9IG0uYWJzKGUudG91Y2hlc1swXS5wYWdlWSArIGUudG91Y2hlc1sxXS5wYWdlWSAtIHRoYXQud3JhcHBlck9mZnNldFRvcCAqIDIpIC8gMiAtIHRoYXQueTsKCiAgICAgICAgICAgICAgICBpZiAodGhhdC5vcHRpb25zLm9uWm9vbVN0YXJ0KSB0aGF0Lm9wdGlvbnMub25ab29tU3RhcnQuY2FsbCh0aGF0LCBlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoYXQub3B0aW9ucy5tb21lbnR1bSkgewogICAgICAgICAgICAgICAgaWYgKHRoYXQub3B0aW9ucy51c2VUcmFuc2Zvcm0pIHsKICAgICAgICAgICAgICAgICAgICAvLyBWZXJ5IGxhbWUgZ2VuZXJhbCBwdXJwb3NlIGFsdGVybmF0aXZlIHRvIENTU01hdHJpeAogICAgICAgICAgICAgICAgICAgIG1hdHJpeCA9IGdldENvbXB1dGVkU3R5bGUodGhhdC5zY3JvbGxlciwgbnVsbClbdHJhbnNmb3JtXS5yZXBsYWNlKC9bXjAtOVwtLixdL2csICcnKS5zcGxpdCgnLCcpOwogICAgICAgICAgICAgICAgICAgIHggPSArKG1hdHJpeFsxMl0gfHwgbWF0cml4WzRdKTsKICAgICAgICAgICAgICAgICAgICB5ID0gKyhtYXRyaXhbMTNdIHx8IG1hdHJpeFs1XSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHggPSArZ2V0Q29tcHV0ZWRTdHlsZSh0aGF0LnNjcm9sbGVyLCBudWxsKS5sZWZ0LnJlcGxhY2UoL1teMC05LV0vZywgJycpOwogICAgICAgICAgICAgICAgICAgIHkgPSArZ2V0Q29tcHV0ZWRTdHlsZSh0aGF0LnNjcm9sbGVyLCBudWxsKS50b3AucmVwbGFjZSgvW14wLTktXS9nLCAnJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmICh4ICE9IHRoYXQueCB8fCB5ICE9IHRoYXQueSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGF0Lm9wdGlvbnMudXNlVHJhbnNpdGlvbikgdGhhdC5fdW5iaW5kKFRSTkVORF9FVik7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBjYW5jZWxGcmFtZSh0aGF0LmFuaVRpbWUpOwogICAgICAgICAgICAgICAgICAgIHRoYXQuc3RlcHMgPSBbXTsKICAgICAgICAgICAgICAgICAgICB0aGF0Ll9wb3MoeCwgeSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoYXQub3B0aW9ucy5vblNjcm9sbEVuZCkgdGhhdC5vcHRpb25zLm9uU2Nyb2xsRW5kLmNhbGwodGhhdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoYXQuYWJzU3RhcnRYID0gdGhhdC54OwkvLyBOZWVkZWQgYnkgc25hcCB0aHJlc2hvbGQKICAgICAgICAgICAgdGhhdC5hYnNTdGFydFkgPSB0aGF0Lnk7CgogICAgICAgICAgICB0aGF0LnN0YXJ0WCA9IHRoYXQueDsKICAgICAgICAgICAgdGhhdC5zdGFydFkgPSB0aGF0Lnk7CiAgICAgICAgICAgIHRoYXQucG9pbnRYID0gcG9pbnQucGFnZVg7CiAgICAgICAgICAgIHRoYXQucG9pbnRZID0gcG9pbnQucGFnZVk7CgogICAgICAgICAgICB0aGF0LnN0YXJ0VGltZSA9IGUudGltZVN0YW1wIHx8IERhdGUubm93KCk7CgogICAgICAgICAgICBpZiAodGhhdC5vcHRpb25zLm9uU2Nyb2xsU3RhcnQpIHRoYXQub3B0aW9ucy5vblNjcm9sbFN0YXJ0LmNhbGwodGhhdCwgZSk7CgogICAgICAgICAgICB0aGF0Ll9iaW5kKE1PVkVfRVYsIHdpbmRvdyk7CiAgICAgICAgICAgIHRoYXQuX2JpbmQoRU5EX0VWLCB3aW5kb3cpOwogICAgICAgICAgICB0aGF0Ll9iaW5kKENBTkNFTF9FViwgd2luZG93KTsKICAgICAgICB9LAogICAgICAgIAogICAgICAgIF9tb3ZlOiBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsCiAgICAgICAgICAgICAgICBwb2ludCA9IGhhc1RvdWNoID8gZS50b3VjaGVzWzBdIDogZSwKICAgICAgICAgICAgICAgIGRlbHRhWCA9IHBvaW50LnBhZ2VYIC0gdGhhdC5wb2ludFgsCiAgICAgICAgICAgICAgICBkZWx0YVkgPSBwb2ludC5wYWdlWSAtIHRoYXQucG9pbnRZLAogICAgICAgICAgICAgICAgbmV3WCA9IHRoYXQueCArIGRlbHRhWCwKICAgICAgICAgICAgICAgIG5ld1kgPSB0aGF0LnkgKyBkZWx0YVksCiAgICAgICAgICAgICAgICBjMSwgYzIsIHNjYWxlLAogICAgICAgICAgICAgICAgdGltZXN0YW1wID0gZS50aW1lU3RhbXAgfHwgRGF0ZS5ub3coKTsKCiAgICAgICAgICAgIGlmICh0aGF0Lm9wdGlvbnMub25CZWZvcmVTY3JvbGxNb3ZlKSB0aGF0Lm9wdGlvbnMub25CZWZvcmVTY3JvbGxNb3ZlLmNhbGwodGhhdCwgZSk7CgogICAgICAgICAgICAvLyBab29tCiAgICAgICAgICAgIGlmICh0aGF0Lm9wdGlvbnMuem9vbSAmJiBoYXNUb3VjaCAmJiBlLnRvdWNoZXMubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgICAgYzEgPSBtLmFicyhlLnRvdWNoZXNbMF0ucGFnZVggLSBlLnRvdWNoZXNbMV0ucGFnZVgpOwogICAgICAgICAgICAgICAgYzIgPSBtLmFicyhlLnRvdWNoZXNbMF0ucGFnZVkgLSBlLnRvdWNoZXNbMV0ucGFnZVkpOwogICAgICAgICAgICAgICAgdGhhdC50b3VjaGVzRGlzdCA9IG0uc3FydChjMSpjMStjMipjMik7CgogICAgICAgICAgICAgICAgdGhhdC56b29tZWQgPSB0cnVlOwoKICAgICAgICAgICAgICAgIHNjYWxlID0gMSAvIHRoYXQudG91Y2hlc0Rpc3RTdGFydCAqIHRoYXQudG91Y2hlc0Rpc3QgKiB0aGlzLnNjYWxlOwoKICAgICAgICAgICAgICAgIGlmIChzY2FsZSA8IHRoYXQub3B0aW9ucy56b29tTWluKSBzY2FsZSA9IDAuNSAqIHRoYXQub3B0aW9ucy56b29tTWluICogTWF0aC5wb3coMi4wLCBzY2FsZSAvIHRoYXQub3B0aW9ucy56b29tTWluKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNjYWxlID4gdGhhdC5vcHRpb25zLnpvb21NYXgpIHNjYWxlID0gMi4wICogdGhhdC5vcHRpb25zLnpvb21NYXggKiBNYXRoLnBvdygwLjUsIHRoYXQub3B0aW9ucy56b29tTWF4IC8gc2NhbGUpOwoKICAgICAgICAgICAgICAgIHRoYXQubGFzdFNjYWxlID0gc2NhbGUgLyB0aGlzLnNjYWxlOwoKICAgICAgICAgICAgICAgIG5ld1ggPSB0aGlzLm9yaWdpblggLSB0aGlzLm9yaWdpblggKiB0aGF0Lmxhc3RTY2FsZSArIHRoaXMueCwKICAgICAgICAgICAgICAgIG5ld1kgPSB0aGlzLm9yaWdpblkgLSB0aGlzLm9yaWdpblkgKiB0aGF0Lmxhc3RTY2FsZSArIHRoaXMueTsKCiAgICAgICAgICAgICAgICB0aGlzLnNjcm9sbGVyLnN0eWxlW3RyYW5zZm9ybV0gPSAndHJhbnNsYXRlKCcgKyBuZXdYICsgJ3B4LCcgKyBuZXdZICsgJ3B4KSBzY2FsZSgnICsgc2NhbGUgKyAnKScgKyB0cmFuc2xhdGVaOwoKICAgICAgICAgICAgICAgIGlmICh0aGF0Lm9wdGlvbnMub25ab29tKSB0aGF0Lm9wdGlvbnMub25ab29tLmNhbGwodGhhdCwgZSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoYXQucG9pbnRYID0gcG9pbnQucGFnZVg7CiAgICAgICAgICAgIHRoYXQucG9pbnRZID0gcG9pbnQucGFnZVk7CgogICAgICAgICAgICAvLyBTbG93IGRvd24gaWYgb3V0c2lkZSBvZiB0aGUgYm91bmRhcmllcwogICAgICAgICAgICBpZiAobmV3WCA+IDAgfHwgbmV3WCA8IHRoYXQubWF4U2Nyb2xsWCkgewogICAgICAgICAgICAgICAgbmV3WCA9IHRoYXQub3B0aW9ucy5ib3VuY2UgPyB0aGF0LnggKyAoZGVsdGFYIC8gMikgOiBuZXdYID49IDAgfHwgdGhhdC5tYXhTY3JvbGxYID49IDAgPyAwIDogdGhhdC5tYXhTY3JvbGxYOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChuZXdZID4gdGhhdC5taW5TY3JvbGxZIHx8IG5ld1kgPCB0aGF0Lm1heFNjcm9sbFkpIHsKICAgICAgICAgICAgICAgIG5ld1kgPSB0aGF0Lm9wdGlvbnMuYm91bmNlID8gdGhhdC55ICsgKGRlbHRhWSAvIDIpIDogbmV3WSA+PSB0aGF0Lm1pblNjcm9sbFkgfHwgdGhhdC5tYXhTY3JvbGxZID49IDAgPyB0aGF0Lm1pblNjcm9sbFkgOiB0aGF0Lm1heFNjcm9sbFk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoYXQuZGlzdFggKz0gZGVsdGFYOwogICAgICAgICAgICB0aGF0LmRpc3RZICs9IGRlbHRhWTsKICAgICAgICAgICAgdGhhdC5hYnNEaXN0WCA9IG0uYWJzKHRoYXQuZGlzdFgpOwogICAgICAgICAgICB0aGF0LmFic0Rpc3RZID0gbS5hYnModGhhdC5kaXN0WSk7CgogICAgICAgICAgICBpZiAodGhhdC5hYnNEaXN0WCA8IDYgJiYgdGhhdC5hYnNEaXN0WSA8IDYpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gTG9jayBkaXJlY3Rpb24KICAgICAgICAgICAgaWYgKHRoYXQub3B0aW9ucy5sb2NrRGlyZWN0aW9uKSB7CiAgICAgICAgICAgICAgICBpZiAodGhhdC5hYnNEaXN0WCA+IHRoYXQuYWJzRGlzdFkgKyA1KSB7CiAgICAgICAgICAgICAgICAgICAgbmV3WSA9IHRoYXQueTsKICAgICAgICAgICAgICAgICAgICBkZWx0YVkgPSAwOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGF0LmFic0Rpc3RZID4gdGhhdC5hYnNEaXN0WCArIDUpIHsKICAgICAgICAgICAgICAgICAgICBuZXdYID0gdGhhdC54OwogICAgICAgICAgICAgICAgICAgIGRlbHRhWCA9IDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoYXQubW92ZWQgPSB0cnVlOwogICAgICAgICAgICB0aGF0Ll9wb3MobmV3WCwgbmV3WSk7CiAgICAgICAgICAgIHRoYXQuZGlyWCA9IGRlbHRhWCA+IDAgPyAtMSA6IGRlbHRhWCA8IDAgPyAxIDogMDsKICAgICAgICAgICAgdGhhdC5kaXJZID0gZGVsdGFZID4gMCA/IC0xIDogZGVsdGFZIDwgMCA/IDEgOiAwOwoKICAgICAgICAgICAgaWYgKHRpbWVzdGFtcCAtIHRoYXQuc3RhcnRUaW1lID4gMzAwKSB7CiAgICAgICAgICAgICAgICB0aGF0LnN0YXJ0VGltZSA9IHRpbWVzdGFtcDsKICAgICAgICAgICAgICAgIHRoYXQuc3RhcnRYID0gdGhhdC54OwogICAgICAgICAgICAgICAgdGhhdC5zdGFydFkgPSB0aGF0Lnk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh0aGF0Lm9wdGlvbnMub25TY3JvbGxNb3ZlKSB0aGF0Lm9wdGlvbnMub25TY3JvbGxNb3ZlLmNhbGwodGhhdCwgZSk7CiAgICAgICAgfSwKICAgICAgICAKICAgICAgICBfZW5kOiBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAoaGFzVG91Y2ggJiYgZS50b3VjaGVzLmxlbmd0aCAhPT0gMCkgcmV0dXJuOwoKICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLAogICAgICAgICAgICAgICAgcG9pbnQgPSBoYXNUb3VjaCA/IGUuY2hhbmdlZFRvdWNoZXNbMF0gOiBlLAogICAgICAgICAgICAgICAgdGFyZ2V0LCBldiwKICAgICAgICAgICAgICAgIG1vbWVudHVtWCA9IHsgZGlzdDowLCB0aW1lOjAgfSwKICAgICAgICAgICAgICAgIG1vbWVudHVtWSA9IHsgZGlzdDowLCB0aW1lOjAgfSwKICAgICAgICAgICAgICAgIGR1cmF0aW9uID0gKGUudGltZVN0YW1wIHx8IERhdGUubm93KCkpIC0gdGhhdC5zdGFydFRpbWUsCiAgICAgICAgICAgICAgICBuZXdQb3NYID0gdGhhdC54LAogICAgICAgICAgICAgICAgbmV3UG9zWSA9IHRoYXQueSwKICAgICAgICAgICAgICAgIGRpc3RYLCBkaXN0WSwKICAgICAgICAgICAgICAgIG5ld0R1cmF0aW9uLAogICAgICAgICAgICAgICAgc25hcCwKICAgICAgICAgICAgICAgIHNjYWxlOwoKICAgICAgICAgICAgdGhhdC5fdW5iaW5kKE1PVkVfRVYsIHdpbmRvdyk7CiAgICAgICAgICAgIHRoYXQuX3VuYmluZChFTkRfRVYsIHdpbmRvdyk7CiAgICAgICAgICAgIHRoYXQuX3VuYmluZChDQU5DRUxfRVYsIHdpbmRvdyk7CgogICAgICAgICAgICBpZiAodGhhdC5vcHRpb25zLm9uQmVmb3JlU2Nyb2xsRW5kKSB0aGF0Lm9wdGlvbnMub25CZWZvcmVTY3JvbGxFbmQuY2FsbCh0aGF0LCBlKTsKCiAgICAgICAgICAgIGlmICh0aGF0Lnpvb21lZCkgewogICAgICAgICAgICAgICAgc2NhbGUgPSB0aGF0LnNjYWxlICogdGhhdC5sYXN0U2NhbGU7CiAgICAgICAgICAgICAgICBzY2FsZSA9IE1hdGgubWF4KHRoYXQub3B0aW9ucy56b29tTWluLCBzY2FsZSk7CiAgICAgICAgICAgICAgICBzY2FsZSA9IE1hdGgubWluKHRoYXQub3B0aW9ucy56b29tTWF4LCBzY2FsZSk7CiAgICAgICAgICAgICAgICB0aGF0Lmxhc3RTY2FsZSA9IHNjYWxlIC8gdGhhdC5zY2FsZTsKICAgICAgICAgICAgICAgIHRoYXQuc2NhbGUgPSBzY2FsZTsKCiAgICAgICAgICAgICAgICB0aGF0LnggPSB0aGF0Lm9yaWdpblggLSB0aGF0Lm9yaWdpblggKiB0aGF0Lmxhc3RTY2FsZSArIHRoYXQueDsKICAgICAgICAgICAgICAgIHRoYXQueSA9IHRoYXQub3JpZ2luWSAtIHRoYXQub3JpZ2luWSAqIHRoYXQubGFzdFNjYWxlICsgdGhhdC55OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0aGF0LnNjcm9sbGVyLnN0eWxlW3RyYW5zaXRpb25EdXJhdGlvbl0gPSAnMjAwbXMnOwogICAgICAgICAgICAgICAgdGhhdC5zY3JvbGxlci5zdHlsZVt0cmFuc2Zvcm1dID0gJ3RyYW5zbGF0ZSgnICsgdGhhdC54ICsgJ3B4LCcgKyB0aGF0LnkgKyAncHgpIHNjYWxlKCcgKyB0aGF0LnNjYWxlICsgJyknICsgdHJhbnNsYXRlWjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGhhdC56b29tZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoYXQucmVmcmVzaCgpOwoKICAgICAgICAgICAgICAgIGlmICh0aGF0Lm9wdGlvbnMub25ab29tRW5kKSB0aGF0Lm9wdGlvbnMub25ab29tRW5kLmNhbGwodGhhdCwgZSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghdGhhdC5tb3ZlZCkgewogICAgICAgICAgICAgICAgaWYgKGhhc1RvdWNoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoYXQuZG91YmxlVGFwVGltZXIgJiYgdGhhdC5vcHRpb25zLnpvb20pIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gRG91YmxlIHRhcHBlZAogICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhhdC5kb3VibGVUYXBUaW1lcik7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuZG91YmxlVGFwVGltZXIgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC5vcHRpb25zLm9uWm9vbVN0YXJ0KSB0aGF0Lm9wdGlvbnMub25ab29tU3RhcnQuY2FsbCh0aGF0LCBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC56b29tKHRoYXQucG9pbnRYLCB0aGF0LnBvaW50WSwgdGhhdC5zY2FsZSA9PSAxID8gdGhhdC5vcHRpb25zLmRvdWJsZVRhcFpvb20gOiAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoYXQub3B0aW9ucy5vblpvb21FbmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5vcHRpb25zLm9uWm9vbUVuZC5jYWxsKHRoYXQsIGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgMjAwKTsgLy8gMjAwIGlzIGRlZmF1bHQgem9vbSBkdXJhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMuaGFuZGxlQ2xpY2spIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5kb3VibGVUYXBUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5kb3VibGVUYXBUaW1lciA9IG51bGw7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRmluZCB0aGUgbGFzdCB0b3VjaGVkIGVsZW1lbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldCA9IHBvaW50LnRhcmdldDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICh0YXJnZXQubm9kZVR5cGUgIT0gMSkgdGFyZ2V0ID0gdGFyZ2V0LnBhcmVudE5vZGU7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldC50YWdOYW1lICE9ICdTRUxFQ1QnICYmIHRhcmdldC50YWdOYW1lICE9ICdJTlBVVCcgJiYgdGFyZ2V0LnRhZ05hbWUgIT0gJ1RFWFRBUkVBJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ID0gZG9jLmNyZWF0ZUV2ZW50KCdNb3VzZUV2ZW50cycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2LmluaXRNb3VzZUV2ZW50KCdjbGljaycsIHRydWUsIHRydWUsIGUudmlldywgMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnQuc2NyZWVuWCwgcG9pbnQuc2NyZWVuWSwgcG9pbnQuY2xpZW50WCwgcG9pbnQuY2xpZW50WSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5jdHJsS2V5LCBlLmFsdEtleSwgZS5zaGlmdEtleSwgZS5tZXRhS2V5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldi5fZmFrZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LmRpc3BhdGNoRXZlbnQoZXYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGF0Lm9wdGlvbnMuem9vbSA/IDI1MCA6IDApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGF0Ll9yZXNldFBvcyg0MDApOwoKICAgICAgICAgICAgICAgIGlmICh0aGF0Lm9wdGlvbnMub25Ub3VjaEVuZCkgdGhhdC5vcHRpb25zLm9uVG91Y2hFbmQuY2FsbCh0aGF0LCBlKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGR1cmF0aW9uIDwgMzAwICYmIHRoYXQub3B0aW9ucy5tb21lbnR1bSkgewogICAgICAgICAgICAgICAgbW9tZW50dW1YID0gbmV3UG9zWCA/IHRoYXQuX21vbWVudHVtKG5ld1Bvc1ggLSB0aGF0LnN0YXJ0WCwgZHVyYXRpb24sIC10aGF0LngsIHRoYXQuc2Nyb2xsZXJXIC0gdGhhdC53cmFwcGVyVyArIHRoYXQueCwgdGhhdC5vcHRpb25zLmJvdW5jZSA/IHRoYXQud3JhcHBlclcgOiAwKSA6IG1vbWVudHVtWDsKICAgICAgICAgICAgICAgIG1vbWVudHVtWSA9IG5ld1Bvc1kgPyB0aGF0Ll9tb21lbnR1bShuZXdQb3NZIC0gdGhhdC5zdGFydFksIGR1cmF0aW9uLCAtdGhhdC55LCAodGhhdC5tYXhTY3JvbGxZIDwgMCA/IHRoYXQuc2Nyb2xsZXJIIC0gdGhhdC53cmFwcGVySCArIHRoYXQueSAtIHRoYXQubWluU2Nyb2xsWSA6IDApLCB0aGF0Lm9wdGlvbnMuYm91bmNlID8gdGhhdC53cmFwcGVySCA6IDApIDogbW9tZW50dW1ZOwoKICAgICAgICAgICAgICAgIG5ld1Bvc1ggPSB0aGF0LnggKyBtb21lbnR1bVguZGlzdDsKICAgICAgICAgICAgICAgIG5ld1Bvc1kgPSB0aGF0LnkgKyBtb21lbnR1bVkuZGlzdDsKCiAgICAgICAgICAgICAgICBpZiAoKHRoYXQueCA+IDAgJiYgbmV3UG9zWCA+IDApIHx8ICh0aGF0LnggPCB0aGF0Lm1heFNjcm9sbFggJiYgbmV3UG9zWCA8IHRoYXQubWF4U2Nyb2xsWCkpIG1vbWVudHVtWCA9IHsgZGlzdDowLCB0aW1lOjAgfTsKICAgICAgICAgICAgICAgIGlmICgodGhhdC55ID4gdGhhdC5taW5TY3JvbGxZICYmIG5ld1Bvc1kgPiB0aGF0Lm1pblNjcm9sbFkpIHx8ICh0aGF0LnkgPCB0aGF0Lm1heFNjcm9sbFkgJiYgbmV3UG9zWSA8IHRoYXQubWF4U2Nyb2xsWSkpIG1vbWVudHVtWSA9IHsgZGlzdDowLCB0aW1lOjAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG1vbWVudHVtWC5kaXN0IHx8IG1vbWVudHVtWS5kaXN0KSB7CiAgICAgICAgICAgICAgICBuZXdEdXJhdGlvbiA9IG0ubWF4KG0ubWF4KG1vbWVudHVtWC50aW1lLCBtb21lbnR1bVkudGltZSksIDEwKTsKCiAgICAgICAgICAgICAgICAvLyBEbyB3ZSBuZWVkIHRvIHNuYXA/CiAgICAgICAgICAgICAgICBpZiAodGhhdC5vcHRpb25zLnNuYXApIHsKICAgICAgICAgICAgICAgICAgICBkaXN0WCA9IG5ld1Bvc1ggLSB0aGF0LmFic1N0YXJ0WDsKICAgICAgICAgICAgICAgICAgICBkaXN0WSA9IG5ld1Bvc1kgLSB0aGF0LmFic1N0YXJ0WTsKICAgICAgICAgICAgICAgICAgICBpZiAobS5hYnMoZGlzdFgpIDwgdGhhdC5vcHRpb25zLnNuYXBUaHJlc2hvbGQgJiYgbS5hYnMoZGlzdFkpIDwgdGhhdC5vcHRpb25zLnNuYXBUaHJlc2hvbGQpIHsgdGhhdC5zY3JvbGxUbyh0aGF0LmFic1N0YXJ0WCwgdGhhdC5hYnNTdGFydFksIDIwMCk7IH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc25hcCA9IHRoYXQuX3NuYXAobmV3UG9zWCwgbmV3UG9zWSk7CiAgICAgICAgICAgICAgICAgICAgICAgIG5ld1Bvc1ggPSBzbmFwLng7CiAgICAgICAgICAgICAgICAgICAgICAgIG5ld1Bvc1kgPSBzbmFwLnk7CiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0R1cmF0aW9uID0gbS5tYXgoc25hcC50aW1lLCBuZXdEdXJhdGlvbik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoYXQuc2Nyb2xsVG8obS5yb3VuZChuZXdQb3NYKSwgbS5yb3VuZChuZXdQb3NZKSwgbmV3RHVyYXRpb24pOwoKICAgICAgICAgICAgICAgIGlmICh0aGF0Lm9wdGlvbnMub25Ub3VjaEVuZCkgdGhhdC5vcHRpb25zLm9uVG91Y2hFbmQuY2FsbCh0aGF0LCBlKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRG8gd2UgbmVlZCB0byBzbmFwPwogICAgICAgICAgICBpZiAodGhhdC5vcHRpb25zLnNuYXApIHsKICAgICAgICAgICAgICAgIGRpc3RYID0gbmV3UG9zWCAtIHRoYXQuYWJzU3RhcnRYOwogICAgICAgICAgICAgICAgZGlzdFkgPSBuZXdQb3NZIC0gdGhhdC5hYnNTdGFydFk7CiAgICAgICAgICAgICAgICBpZiAobS5hYnMoZGlzdFgpIDwgdGhhdC5vcHRpb25zLnNuYXBUaHJlc2hvbGQgJiYgbS5hYnMoZGlzdFkpIDwgdGhhdC5vcHRpb25zLnNuYXBUaHJlc2hvbGQpIHRoYXQuc2Nyb2xsVG8odGhhdC5hYnNTdGFydFgsIHRoYXQuYWJzU3RhcnRZLCAyMDApOwogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc25hcCA9IHRoYXQuX3NuYXAodGhhdC54LCB0aGF0LnkpOwogICAgICAgICAgICAgICAgICAgIGlmIChzbmFwLnggIT0gdGhhdC54IHx8IHNuYXAueSAhPSB0aGF0LnkpIHRoYXQuc2Nyb2xsVG8oc25hcC54LCBzbmFwLnksIHNuYXAudGltZSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRoYXQub3B0aW9ucy5vblRvdWNoRW5kKSB0aGF0Lm9wdGlvbnMub25Ub3VjaEVuZC5jYWxsKHRoYXQsIGUpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGF0Ll9yZXNldFBvcygyMDApOwogICAgICAgICAgICBpZiAodGhhdC5vcHRpb25zLm9uVG91Y2hFbmQpIHRoYXQub3B0aW9ucy5vblRvdWNoRW5kLmNhbGwodGhhdCwgZSk7CiAgICAgICAgfSwKICAgICAgICAKICAgICAgICBfcmVzZXRQb3M6IGZ1bmN0aW9uICh0aW1lKSB7CiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywKICAgICAgICAgICAgICAgIHJlc2V0WCA9IHRoYXQueCA+PSAwID8gMCA6IHRoYXQueCA8IHRoYXQubWF4U2Nyb2xsWCA/IHRoYXQubWF4U2Nyb2xsWCA6IHRoYXQueCwKICAgICAgICAgICAgICAgIHJlc2V0WSA9IHRoYXQueSA+PSB0aGF0Lm1pblNjcm9sbFkgfHwgdGhhdC5tYXhTY3JvbGxZID4gMCA/IHRoYXQubWluU2Nyb2xsWSA6IHRoYXQueSA8IHRoYXQubWF4U2Nyb2xsWSA/IHRoYXQubWF4U2Nyb2xsWSA6IHRoYXQueTsKCiAgICAgICAgICAgIGlmIChyZXNldFggPT0gdGhhdC54ICYmIHJlc2V0WSA9PSB0aGF0LnkpIHsKICAgICAgICAgICAgICAgIGlmICh0aGF0Lm1vdmVkKSB7CiAgICAgICAgICAgICAgICAgICAgdGhhdC5tb3ZlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGF0Lm9wdGlvbnMub25TY3JvbGxFbmQpIHRoYXQub3B0aW9ucy5vblNjcm9sbEVuZC5jYWxsKHRoYXQpOwkJLy8gRXhlY3V0ZSBjdXN0b20gY29kZSBvbiBzY3JvbGwgZW5kCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRoYXQuaFNjcm9sbGJhciAmJiB0aGF0Lm9wdGlvbnMuaGlkZVNjcm9sbGJhcikgewogICAgICAgICAgICAgICAgICAgIGlmICh2ZW5kb3IgPT0gJ3dlYmtpdCcpIHRoYXQuaFNjcm9sbGJhcldyYXBwZXIuc3R5bGVbdHJhbnNpdGlvbkRlbGF5XSA9ICczMDBtcyc7CiAgICAgICAgICAgICAgICAgICAgdGhhdC5oU2Nyb2xsYmFyV3JhcHBlci5zdHlsZS5vcGFjaXR5ID0gJzAnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoYXQudlNjcm9sbGJhciAmJiB0aGF0Lm9wdGlvbnMuaGlkZVNjcm9sbGJhcikgewogICAgICAgICAgICAgICAgICAgIGlmICh2ZW5kb3IgPT0gJ3dlYmtpdCcpIHRoYXQudlNjcm9sbGJhcldyYXBwZXIuc3R5bGVbdHJhbnNpdGlvbkRlbGF5XSA9ICczMDBtcyc7CiAgICAgICAgICAgICAgICAgICAgdGhhdC52U2Nyb2xsYmFyV3JhcHBlci5zdHlsZS5vcGFjaXR5ID0gJzAnOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhhdC5zY3JvbGxUbyhyZXNldFgsIHJlc2V0WSwgdGltZSB8fCAwKTsKICAgICAgICB9LAoKICAgICAgICBfd2hlZWw6IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywKICAgICAgICAgICAgICAgIHdoZWVsRGVsdGFYLCB3aGVlbERlbHRhWSwKICAgICAgICAgICAgICAgIGRlbHRhWCwgZGVsdGFZLAogICAgICAgICAgICAgICAgZGVsdGFTY2FsZTsKCiAgICAgICAgICAgIGlmICgnd2hlZWxEZWx0YVgnIGluIGUpIHsKICAgICAgICAgICAgICAgIHdoZWVsRGVsdGFYID0gZS53aGVlbERlbHRhWCAvIDEyOwogICAgICAgICAgICAgICAgd2hlZWxEZWx0YVkgPSBlLndoZWVsRGVsdGFZIC8gMTI7CiAgICAgICAgICAgIH0gZWxzZSBpZignd2hlZWxEZWx0YScgaW4gZSkgewogICAgICAgICAgICAgICAgd2hlZWxEZWx0YVggPSB3aGVlbERlbHRhWSA9IGUud2hlZWxEZWx0YSAvIDEyOwogICAgICAgICAgICB9IGVsc2UgaWYgKCdkZXRhaWwnIGluIGUpIHsKICAgICAgICAgICAgICAgIHdoZWVsRGVsdGFYID0gd2hlZWxEZWx0YVkgPSAtZS5kZXRhaWwgKiAzOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAodGhhdC5vcHRpb25zLndoZWVsQWN0aW9uID09ICd6b29tJykgewogICAgICAgICAgICAgICAgZGVsdGFTY2FsZSA9IHRoYXQuc2NhbGUgKiBNYXRoLnBvdygyLCAxLzMgKiAod2hlZWxEZWx0YVkgPyB3aGVlbERlbHRhWSAvIE1hdGguYWJzKHdoZWVsRGVsdGFZKSA6IDApKTsKICAgICAgICAgICAgICAgIGlmIChkZWx0YVNjYWxlIDwgdGhhdC5vcHRpb25zLnpvb21NaW4pIGRlbHRhU2NhbGUgPSB0aGF0Lm9wdGlvbnMuem9vbU1pbjsKICAgICAgICAgICAgICAgIGlmIChkZWx0YVNjYWxlID4gdGhhdC5vcHRpb25zLnpvb21NYXgpIGRlbHRhU2NhbGUgPSB0aGF0Lm9wdGlvbnMuem9vbU1heDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKGRlbHRhU2NhbGUgIT0gdGhhdC5zY2FsZSkgewogICAgICAgICAgICAgICAgICAgIGlmICghdGhhdC53aGVlbFpvb21Db3VudCAmJiB0aGF0Lm9wdGlvbnMub25ab29tU3RhcnQpIHRoYXQub3B0aW9ucy5vblpvb21TdGFydC5jYWxsKHRoYXQsIGUpOwogICAgICAgICAgICAgICAgICAgIHRoYXQud2hlZWxab29tQ291bnQrKzsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB0aGF0Lnpvb20oZS5wYWdlWCwgZS5wYWdlWSwgZGVsdGFTY2FsZSwgNDAwKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGF0LndoZWVsWm9vbUNvdW50LS07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhhdC53aGVlbFpvb21Db3VudCAmJiB0aGF0Lm9wdGlvbnMub25ab29tRW5kKSB0aGF0Lm9wdGlvbnMub25ab29tRW5kLmNhbGwodGhhdCwgZSk7CiAgICAgICAgICAgICAgICAgICAgfSwgNDAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBkZWx0YVggPSB0aGF0LnggKyB3aGVlbERlbHRhWDsKICAgICAgICAgICAgZGVsdGFZID0gdGhhdC55ICsgd2hlZWxEZWx0YVk7CgogICAgICAgICAgICBpZiAoZGVsdGFYID4gMCkgZGVsdGFYID0gMDsKICAgICAgICAgICAgZWxzZSBpZiAoZGVsdGFYIDwgdGhhdC5tYXhTY3JvbGxYKSBkZWx0YVggPSB0aGF0Lm1heFNjcm9sbFg7CgogICAgICAgICAgICBpZiAoZGVsdGFZID4gdGhhdC5taW5TY3JvbGxZKSBkZWx0YVkgPSB0aGF0Lm1pblNjcm9sbFk7CiAgICAgICAgICAgIGVsc2UgaWYgKGRlbHRhWSA8IHRoYXQubWF4U2Nyb2xsWSkgZGVsdGFZID0gdGhhdC5tYXhTY3JvbGxZOwogICAgICAgIAogICAgICAgICAgICBpZiAodGhhdC5tYXhTY3JvbGxZIDwgMCkgewogICAgICAgICAgICAgICAgdGhhdC5zY3JvbGxUbyhkZWx0YVgsIGRlbHRhWSwgMCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIAogICAgICAgIF90cmFuc2l0aW9uRW5kOiBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7CgogICAgICAgICAgICBpZiAoZS50YXJnZXQgIT0gdGhhdC5zY3JvbGxlcikgcmV0dXJuOwoKICAgICAgICAgICAgdGhhdC5fdW5iaW5kKFRSTkVORF9FVik7CiAgICAgICAgICAgIAogICAgICAgICAgICB0aGF0Ll9zdGFydEFuaSgpOwogICAgICAgIH0sCgoKICAgICAgICAvKioKICAgICAgICAqCiAgICAgICAgKiBVdGlsaXRpZXMKICAgICAgICAqCiAgICAgICAgKi8KICAgICAgICBfc3RhcnRBbmk6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLAogICAgICAgICAgICAgICAgc3RhcnRYID0gdGhhdC54LCBzdGFydFkgPSB0aGF0LnksCiAgICAgICAgICAgICAgICBzdGFydFRpbWUgPSBEYXRlLm5vdygpLAogICAgICAgICAgICAgICAgc3RlcCwgZWFzZU91dCwKICAgICAgICAgICAgICAgIGFuaW1hdGU7CgogICAgICAgICAgICBpZiAodGhhdC5hbmltYXRpbmcpIHJldHVybjsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICghdGhhdC5zdGVwcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIHRoYXQuX3Jlc2V0UG9zKDQwMCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHN0ZXAgPSB0aGF0LnN0ZXBzLnNoaWZ0KCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoc3RlcC54ID09IHN0YXJ0WCAmJiBzdGVwLnkgPT0gc3RhcnRZKSBzdGVwLnRpbWUgPSAwOwoKICAgICAgICAgICAgdGhhdC5hbmltYXRpbmcgPSB0cnVlOwogICAgICAgICAgICB0aGF0Lm1vdmVkID0gdHJ1ZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh0aGF0Lm9wdGlvbnMudXNlVHJhbnNpdGlvbikgewogICAgICAgICAgICAgICAgdGhhdC5fdHJhbnNpdGlvblRpbWUoc3RlcC50aW1lKTsKICAgICAgICAgICAgICAgIHRoYXQuX3BvcyhzdGVwLngsIHN0ZXAueSk7CiAgICAgICAgICAgICAgICB0aGF0LmFuaW1hdGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKHN0ZXAudGltZSkgdGhhdC5fYmluZChUUk5FTkRfRVYpOwogICAgICAgICAgICAgICAgZWxzZSB0aGF0Ll9yZXNldFBvcygwKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYW5pbWF0ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBub3cgPSBEYXRlLm5vdygpLAogICAgICAgICAgICAgICAgICAgIG5ld1gsIG5ld1k7CgogICAgICAgICAgICAgICAgaWYgKG5vdyA+PSBzdGFydFRpbWUgKyBzdGVwLnRpbWUpIHsKICAgICAgICAgICAgICAgICAgICB0aGF0Ll9wb3Moc3RlcC54LCBzdGVwLnkpOwogICAgICAgICAgICAgICAgICAgIHRoYXQuYW5pbWF0aW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoYXQub3B0aW9ucy5vbkFuaW1hdGlvbkVuZCkgdGhhdC5vcHRpb25zLm9uQW5pbWF0aW9uRW5kLmNhbGwodGhhdCk7CQkJLy8gRXhlY3V0ZSBjdXN0b20gY29kZSBvbiBhbmltYXRpb24gZW5kCiAgICAgICAgICAgICAgICAgICAgdGhhdC5fc3RhcnRBbmkoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbm93ID0gKG5vdyAtIHN0YXJ0VGltZSkgLyBzdGVwLnRpbWUgLSAxOwogICAgICAgICAgICAgICAgZWFzZU91dCA9IG0uc3FydCgxIC0gbm93ICogbm93KTsKICAgICAgICAgICAgICAgIG5ld1ggPSAoc3RlcC54IC0gc3RhcnRYKSAqIGVhc2VPdXQgKyBzdGFydFg7CiAgICAgICAgICAgICAgICBuZXdZID0gKHN0ZXAueSAtIHN0YXJ0WSkgKiBlYXNlT3V0ICsgc3RhcnRZOwogICAgICAgICAgICAgICAgdGhhdC5fcG9zKG5ld1gsIG5ld1kpOwogICAgICAgICAgICAgICAgaWYgKHRoYXQuYW5pbWF0aW5nKSB0aGF0LmFuaVRpbWUgPSBuZXh0RnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBhbmltYXRlKCk7CiAgICAgICAgfSwKCiAgICAgICAgX3RyYW5zaXRpb25UaW1lOiBmdW5jdGlvbiAodGltZSkgewogICAgICAgICAgICB0aW1lICs9ICdtcyc7CiAgICAgICAgICAgIHRoaXMuc2Nyb2xsZXIuc3R5bGVbdHJhbnNpdGlvbkR1cmF0aW9uXSA9IHRpbWU7CiAgICAgICAgICAgIGlmICh0aGlzLmhTY3JvbGxiYXIpIHRoaXMuaFNjcm9sbGJhckluZGljYXRvci5zdHlsZVt0cmFuc2l0aW9uRHVyYXRpb25dID0gdGltZTsKICAgICAgICAgICAgaWYgKHRoaXMudlNjcm9sbGJhcikgdGhpcy52U2Nyb2xsYmFySW5kaWNhdG9yLnN0eWxlW3RyYW5zaXRpb25EdXJhdGlvbl0gPSB0aW1lOwogICAgICAgIH0sCgogICAgICAgIF9tb21lbnR1bTogZnVuY3Rpb24gKGRpc3QsIHRpbWUsIG1heERpc3RVcHBlciwgbWF4RGlzdExvd2VyLCBzaXplKSB7CiAgICAgICAgICAgIHZhciBkZWNlbGVyYXRpb24gPSAwLjAwMDYsCiAgICAgICAgICAgICAgICBzcGVlZCA9IG0uYWJzKGRpc3QpIC8gdGltZSwKICAgICAgICAgICAgICAgIG5ld0Rpc3QgPSAoc3BlZWQgKiBzcGVlZCkgLyAoMiAqIGRlY2VsZXJhdGlvbiksCiAgICAgICAgICAgICAgICBuZXdUaW1lID0gMCwgb3V0c2lkZURpc3QgPSAwOwoKICAgICAgICAgICAgLy8gUHJvcG9ydGluYWxseSByZWR1Y2Ugc3BlZWQgaWYgd2UgYXJlIG91dHNpZGUgb2YgdGhlIGJvdW5kYXJpZXMKICAgICAgICAgICAgaWYgKGRpc3QgPiAwICYmIG5ld0Rpc3QgPiBtYXhEaXN0VXBwZXIpIHsKICAgICAgICAgICAgICAgIG91dHNpZGVEaXN0ID0gc2l6ZSAvICg2IC8gKG5ld0Rpc3QgLyBzcGVlZCAqIGRlY2VsZXJhdGlvbikpOwogICAgICAgICAgICAgICAgbWF4RGlzdFVwcGVyID0gbWF4RGlzdFVwcGVyICsgb3V0c2lkZURpc3Q7CiAgICAgICAgICAgICAgICBzcGVlZCA9IHNwZWVkICogbWF4RGlzdFVwcGVyIC8gbmV3RGlzdDsKICAgICAgICAgICAgICAgIG5ld0Rpc3QgPSBtYXhEaXN0VXBwZXI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZGlzdCA8IDAgJiYgbmV3RGlzdCA+IG1heERpc3RMb3dlcikgewogICAgICAgICAgICAgICAgb3V0c2lkZURpc3QgPSBzaXplIC8gKDYgLyAobmV3RGlzdCAvIHNwZWVkICogZGVjZWxlcmF0aW9uKSk7CiAgICAgICAgICAgICAgICBtYXhEaXN0TG93ZXIgPSBtYXhEaXN0TG93ZXIgKyBvdXRzaWRlRGlzdDsKICAgICAgICAgICAgICAgIHNwZWVkID0gc3BlZWQgKiBtYXhEaXN0TG93ZXIgLyBuZXdEaXN0OwogICAgICAgICAgICAgICAgbmV3RGlzdCA9IG1heERpc3RMb3dlcjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbmV3RGlzdCA9IG5ld0Rpc3QgKiAoZGlzdCA8IDAgPyAtMSA6IDEpOwogICAgICAgICAgICBuZXdUaW1lID0gc3BlZWQgLyBkZWNlbGVyYXRpb247CgogICAgICAgICAgICByZXR1cm4geyBkaXN0OiBuZXdEaXN0LCB0aW1lOiBtLnJvdW5kKG5ld1RpbWUpIH07CiAgICAgICAgfSwKCiAgICAgICAgX29mZnNldDogZnVuY3Rpb24gKGVsKSB7CiAgICAgICAgICAgIHZhciBsZWZ0ID0gLWVsLm9mZnNldExlZnQsCiAgICAgICAgICAgICAgICB0b3AgPSAtZWwub2Zmc2V0VG9wOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHdoaWxlIChlbCA9IGVsLm9mZnNldFBhcmVudCkgewogICAgICAgICAgICAgICAgbGVmdCAtPSBlbC5vZmZzZXRMZWZ0OwogICAgICAgICAgICAgICAgdG9wIC09IGVsLm9mZnNldFRvcDsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGVsICE9IHRoaXMud3JhcHBlcikgewogICAgICAgICAgICAgICAgbGVmdCAqPSB0aGlzLnNjYWxlOwogICAgICAgICAgICAgICAgdG9wICo9IHRoaXMuc2NhbGU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB7IGxlZnQ6IGxlZnQsIHRvcDogdG9wIH07CiAgICAgICAgfSwKCiAgICAgICAgX3NuYXA6IGZ1bmN0aW9uICh4LCB5KSB7CiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywKICAgICAgICAgICAgICAgIGksIGwsCiAgICAgICAgICAgICAgICBwYWdlLCB0aW1lLAogICAgICAgICAgICAgICAgc2l6ZVgsIHNpemVZOwoKICAgICAgICAgICAgLy8gQ2hlY2sgcGFnZSBYCiAgICAgICAgICAgIHBhZ2UgPSB0aGF0LnBhZ2VzWC5sZW5ndGggLSAxOwogICAgICAgICAgICBmb3IgKGk9MCwgbD10aGF0LnBhZ2VzWC5sZW5ndGg7IGk8bDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoeCA+PSB0aGF0LnBhZ2VzWFtpXSkgewogICAgICAgICAgICAgICAgICAgIHBhZ2UgPSBpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChwYWdlID09IHRoYXQuY3VyclBhZ2VYICYmIHBhZ2UgPiAwICYmIHRoYXQuZGlyWCA8IDApIHBhZ2UtLTsKICAgICAgICAgICAgeCA9IHRoYXQucGFnZXNYW3BhZ2VdOwogICAgICAgICAgICBzaXplWCA9IG0uYWJzKHggLSB0aGF0LnBhZ2VzWFt0aGF0LmN1cnJQYWdlWF0pOwogICAgICAgICAgICBzaXplWCA9IHNpemVYID8gbS5hYnModGhhdC54IC0geCkgLyBzaXplWCAqIDUwMCA6IDA7CiAgICAgICAgICAgIHRoYXQuY3VyclBhZ2VYID0gcGFnZTsKCiAgICAgICAgICAgIC8vIENoZWNrIHBhZ2UgWQogICAgICAgICAgICBwYWdlID0gdGhhdC5wYWdlc1kubGVuZ3RoLTE7CiAgICAgICAgICAgIGZvciAoaT0wOyBpPHBhZ2U7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKHkgPj0gdGhhdC5wYWdlc1lbaV0pIHsKICAgICAgICAgICAgICAgICAgICBwYWdlID0gaTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocGFnZSA9PSB0aGF0LmN1cnJQYWdlWSAmJiBwYWdlID4gMCAmJiB0aGF0LmRpclkgPCAwKSBwYWdlLS07CiAgICAgICAgICAgIHkgPSB0aGF0LnBhZ2VzWVtwYWdlXTsKICAgICAgICAgICAgc2l6ZVkgPSBtLmFicyh5IC0gdGhhdC5wYWdlc1lbdGhhdC5jdXJyUGFnZVldKTsKICAgICAgICAgICAgc2l6ZVkgPSBzaXplWSA/IG0uYWJzKHRoYXQueSAtIHkpIC8gc2l6ZVkgKiA1MDAgOiAwOwogICAgICAgICAgICB0aGF0LmN1cnJQYWdlWSA9IHBhZ2U7CgogICAgICAgICAgICAvLyBTbmFwIHdpdGggY29uc3RhbnQgc3BlZWQgKHByb3BvcnRpb25hbCBkdXJhdGlvbikKICAgICAgICAgICAgdGltZSA9IG0ucm91bmQobS5tYXgoc2l6ZVgsIHNpemVZKSkgfHwgMjAwOwoKICAgICAgICAgICAgcmV0dXJuIHsgeDogeCwgeTogeSwgdGltZTogdGltZSB9OwogICAgICAgIH0sCgogICAgICAgIF9iaW5kOiBmdW5jdGlvbiAodHlwZSwgZWwsIGJ1YmJsZSkgewogICAgICAgICAgICAoZWwgfHwgdGhpcy5zY3JvbGxlcikuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCB0aGlzLCAhIWJ1YmJsZSk7CiAgICAgICAgfSwKCiAgICAgICAgX3VuYmluZDogZnVuY3Rpb24gKHR5cGUsIGVsLCBidWJibGUpIHsKICAgICAgICAgICAgKGVsIHx8IHRoaXMuc2Nyb2xsZXIpLnJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZSwgdGhpcywgISFidWJibGUpOwogICAgICAgIH0sCgoKICAgICAgICAvKioKICAgICAgICAqCiAgICAgICAgKiBQdWJsaWMgbWV0aG9kcwogICAgICAgICoKICAgICAgICAqLwogICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzOwoKICAgICAgICAgICAgdGhhdC5zY3JvbGxlci5zdHlsZVt0cmFuc2Zvcm1dID0gJyc7CgogICAgICAgICAgICAvLyBSZW1vdmUgdGhlIHNjcm9sbGJhcnMKICAgICAgICAgICAgdGhhdC5oU2Nyb2xsYmFyID0gZmFsc2U7CiAgICAgICAgICAgIHRoYXQudlNjcm9sbGJhciA9IGZhbHNlOwogICAgICAgICAgICB0aGF0Ll9zY3JvbGxiYXIoJ2gnKTsKICAgICAgICAgICAgdGhhdC5fc2Nyb2xsYmFyKCd2Jyk7CgogICAgICAgICAgICAvLyBSZW1vdmUgdGhlIGV2ZW50IGxpc3RlbmVycwogICAgICAgICAgICB0aGF0Ll91bmJpbmQoUkVTSVpFX0VWLCB3aW5kb3cpOwogICAgICAgICAgICB0aGF0Ll91bmJpbmQoU1RBUlRfRVYpOwogICAgICAgICAgICB0aGF0Ll91bmJpbmQoTU9WRV9FViwgd2luZG93KTsKICAgICAgICAgICAgdGhhdC5fdW5iaW5kKEVORF9FViwgd2luZG93KTsKICAgICAgICAgICAgdGhhdC5fdW5iaW5kKENBTkNFTF9FViwgd2luZG93KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICghdGhhdC5vcHRpb25zLmhhc1RvdWNoKSB7CiAgICAgICAgICAgICAgICB0aGF0Ll91bmJpbmQoJ0RPTU1vdXNlU2Nyb2xsJyk7CiAgICAgICAgICAgICAgICB0aGF0Ll91bmJpbmQoJ21vdXNld2hlZWwnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHRoYXQub3B0aW9ucy51c2VUcmFuc2l0aW9uKSB0aGF0Ll91bmJpbmQoVFJORU5EX0VWKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh0aGF0Lm9wdGlvbnMuY2hlY2tET01DaGFuZ2VzKSBjbGVhckludGVydmFsKHRoYXQuY2hlY2tET01UaW1lKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh0aGF0Lm9wdGlvbnMub25EZXN0cm95KSB0aGF0Lm9wdGlvbnMub25EZXN0cm95LmNhbGwodGhhdCk7CiAgICAgICAgfSwKCiAgICAgICAgcmVmcmVzaDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsCiAgICAgICAgICAgICAgICBvZmZzZXQsCiAgICAgICAgICAgICAgICBpLCBsLAogICAgICAgICAgICAgICAgZWxzLAogICAgICAgICAgICAgICAgcG9zID0gMCwKICAgICAgICAgICAgICAgIHBhZ2UgPSAwOwoKICAgICAgICAgICAgaWYgKHRoYXQuc2NhbGUgPCB0aGF0Lm9wdGlvbnMuem9vbU1pbikgdGhhdC5zY2FsZSA9IHRoYXQub3B0aW9ucy56b29tTWluOwogICAgICAgICAgICB0aGF0LndyYXBwZXJXID0gdGhhdC53cmFwcGVyLmNsaWVudFdpZHRoIHx8IDE7CiAgICAgICAgICAgIHRoYXQud3JhcHBlckggPSB0aGF0LndyYXBwZXIuY2xpZW50SGVpZ2h0IHx8IDE7CgogICAgICAgICAgICB0aGF0Lm1pblNjcm9sbFkgPSAtdGhhdC5vcHRpb25zLnRvcE9mZnNldCB8fCAwOwogICAgICAgICAgICB0aGF0LnNjcm9sbGVyVyA9IG0ucm91bmQodGhhdC5zY3JvbGxlci5vZmZzZXRXaWR0aCAqIHRoYXQuc2NhbGUpOwogICAgICAgICAgICB0aGF0LnNjcm9sbGVySCA9IG0ucm91bmQoKHRoYXQuc2Nyb2xsZXIub2Zmc2V0SGVpZ2h0ICsgdGhhdC5taW5TY3JvbGxZKSAqIHRoYXQuc2NhbGUpOwogICAgICAgICAgICB0aGF0Lm1heFNjcm9sbFggPSB0aGF0LndyYXBwZXJXIC0gdGhhdC5zY3JvbGxlclc7CiAgICAgICAgICAgIHRoYXQubWF4U2Nyb2xsWSA9IHRoYXQud3JhcHBlckggLSB0aGF0LnNjcm9sbGVySCArIHRoYXQubWluU2Nyb2xsWTsKICAgICAgICAgICAgdGhhdC5kaXJYID0gMDsKICAgICAgICAgICAgdGhhdC5kaXJZID0gMDsKCiAgICAgICAgICAgIGlmICh0aGF0Lm9wdGlvbnMub25SZWZyZXNoKSB0aGF0Lm9wdGlvbnMub25SZWZyZXNoLmNhbGwodGhhdCk7CgogICAgICAgICAgICB0aGF0LmhTY3JvbGwgPSB0aGF0Lm9wdGlvbnMuaFNjcm9sbCAmJiB0aGF0Lm1heFNjcm9sbFggPCAwOwogICAgICAgICAgICB0aGF0LnZTY3JvbGwgPSB0aGF0Lm9wdGlvbnMudlNjcm9sbCAmJiAoIXRoYXQub3B0aW9ucy5ib3VuY2VMb2NrICYmICF0aGF0LmhTY3JvbGwgfHwgdGhhdC5zY3JvbGxlckggPiB0aGF0LndyYXBwZXJIKTsKCiAgICAgICAgICAgIHRoYXQuaFNjcm9sbGJhciA9IHRoYXQuaFNjcm9sbCAmJiB0aGF0Lm9wdGlvbnMuaFNjcm9sbGJhcjsKICAgICAgICAgICAgdGhhdC52U2Nyb2xsYmFyID0gdGhhdC52U2Nyb2xsICYmIHRoYXQub3B0aW9ucy52U2Nyb2xsYmFyICYmIHRoYXQuc2Nyb2xsZXJIID4gdGhhdC53cmFwcGVySDsKCiAgICAgICAgICAgIG9mZnNldCA9IHRoYXQuX29mZnNldCh0aGF0LndyYXBwZXIpOwogICAgICAgICAgICB0aGF0LndyYXBwZXJPZmZzZXRMZWZ0ID0gLW9mZnNldC5sZWZ0OwogICAgICAgICAgICB0aGF0LndyYXBwZXJPZmZzZXRUb3AgPSAtb2Zmc2V0LnRvcDsKCiAgICAgICAgICAgIC8vIFByZXBhcmUgc25hcAogICAgICAgICAgICBpZiAodHlwZW9mIHRoYXQub3B0aW9ucy5zbmFwID09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICB0aGF0LnBhZ2VzWCA9IFtdOwogICAgICAgICAgICAgICAgdGhhdC5wYWdlc1kgPSBbXTsKICAgICAgICAgICAgICAgIGVscyA9IHRoYXQuc2Nyb2xsZXIucXVlcnlTZWxlY3RvckFsbCh0aGF0Lm9wdGlvbnMuc25hcCk7CiAgICAgICAgICAgICAgICBmb3IgKGk9MCwgbD1lbHMubGVuZ3RoOyBpPGw7IGkrKykgewogICAgICAgICAgICAgICAgICAgIHBvcyA9IHRoYXQuX29mZnNldChlbHNbaV0pOwogICAgICAgICAgICAgICAgICAgIHBvcy5sZWZ0ICs9IHRoYXQud3JhcHBlck9mZnNldExlZnQ7CiAgICAgICAgICAgICAgICAgICAgcG9zLnRvcCArPSB0aGF0LndyYXBwZXJPZmZzZXRUb3A7CiAgICAgICAgICAgICAgICAgICAgdGhhdC5wYWdlc1hbaV0gPSBwb3MubGVmdCA8IHRoYXQubWF4U2Nyb2xsWCA/IHRoYXQubWF4U2Nyb2xsWCA6IHBvcy5sZWZ0ICogdGhhdC5zY2FsZTsKICAgICAgICAgICAgICAgICAgICB0aGF0LnBhZ2VzWVtpXSA9IHBvcy50b3AgPCB0aGF0Lm1heFNjcm9sbFkgPyB0aGF0Lm1heFNjcm9sbFkgOiBwb3MudG9wICogdGhhdC5zY2FsZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICh0aGF0Lm9wdGlvbnMuc25hcCkgewogICAgICAgICAgICAgICAgdGhhdC5wYWdlc1ggPSBbXTsKICAgICAgICAgICAgICAgIHdoaWxlIChwb3MgPj0gdGhhdC5tYXhTY3JvbGxYKSB7CiAgICAgICAgICAgICAgICAgICAgdGhhdC5wYWdlc1hbcGFnZV0gPSBwb3M7CiAgICAgICAgICAgICAgICAgICAgcG9zID0gcG9zIC0gdGhhdC53cmFwcGVyVzsKICAgICAgICAgICAgICAgICAgICBwYWdlKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhhdC5tYXhTY3JvbGxYJXRoYXQud3JhcHBlclcpIHRoYXQucGFnZXNYW3RoYXQucGFnZXNYLmxlbmd0aF0gPSB0aGF0Lm1heFNjcm9sbFggLSB0aGF0LnBhZ2VzWFt0aGF0LnBhZ2VzWC5sZW5ndGgtMV0gKyB0aGF0LnBhZ2VzWFt0aGF0LnBhZ2VzWC5sZW5ndGgtMV07CgogICAgICAgICAgICAgICAgcG9zID0gMDsKICAgICAgICAgICAgICAgIHBhZ2UgPSAwOwogICAgICAgICAgICAgICAgdGhhdC5wYWdlc1kgPSBbXTsKICAgICAgICAgICAgICAgIHdoaWxlIChwb3MgPj0gdGhhdC5tYXhTY3JvbGxZKSB7CiAgICAgICAgICAgICAgICAgICAgdGhhdC5wYWdlc1lbcGFnZV0gPSBwb3M7CiAgICAgICAgICAgICAgICAgICAgcG9zID0gcG9zIC0gdGhhdC53cmFwcGVySDsKICAgICAgICAgICAgICAgICAgICBwYWdlKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhhdC5tYXhTY3JvbGxZJXRoYXQud3JhcHBlckgpIHRoYXQucGFnZXNZW3RoYXQucGFnZXNZLmxlbmd0aF0gPSB0aGF0Lm1heFNjcm9sbFkgLSB0aGF0LnBhZ2VzWVt0aGF0LnBhZ2VzWS5sZW5ndGgtMV0gKyB0aGF0LnBhZ2VzWVt0aGF0LnBhZ2VzWS5sZW5ndGgtMV07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFByZXBhcmUgdGhlIHNjcm9sbGJhcnMKICAgICAgICAgICAgdGhhdC5fc2Nyb2xsYmFyKCdoJyk7CiAgICAgICAgICAgIHRoYXQuX3Njcm9sbGJhcigndicpOwoKICAgICAgICAgICAgaWYgKCF0aGF0Lnpvb21lZCkgewogICAgICAgICAgICAgICAgdGhhdC5zY3JvbGxlci5zdHlsZVt0cmFuc2l0aW9uRHVyYXRpb25dID0gJzAnOwogICAgICAgICAgICAgICAgdGhhdC5fcmVzZXRQb3MoNDAwKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIHNjcm9sbFRvOiBmdW5jdGlvbiAoeCwgeSwgdGltZSwgcmVsYXRpdmUpIHsKICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLAogICAgICAgICAgICAgICAgc3RlcCA9IHgsCiAgICAgICAgICAgICAgICBpLCBsOwoKICAgICAgICAgICAgdGhhdC5zdG9wKCk7CgogICAgICAgICAgICBpZiAoIXN0ZXAubGVuZ3RoKSBzdGVwID0gW3sgeDogeCwgeTogeSwgdGltZTogdGltZSwgcmVsYXRpdmU6IHJlbGF0aXZlIH1dOwogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIChpPTAsIGw9c3RlcC5sZW5ndGg7IGk8bDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoc3RlcFtpXS5yZWxhdGl2ZSkgeyBzdGVwW2ldLnggPSB0aGF0LnggLSBzdGVwW2ldLng7IHN0ZXBbaV0ueSA9IHRoYXQueSAtIHN0ZXBbaV0ueTsgfQogICAgICAgICAgICAgICAgdGhhdC5zdGVwcy5wdXNoKHsgeDogc3RlcFtpXS54LCB5OiBzdGVwW2ldLnksIHRpbWU6IHN0ZXBbaV0udGltZSB8fCAwIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGF0Ll9zdGFydEFuaSgpOwogICAgICAgIH0sCgogICAgICAgIHNjcm9sbFRvRWxlbWVudDogZnVuY3Rpb24gKGVsLCB0aW1lKSB7CiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgcG9zOwogICAgICAgICAgICBlbCA9IGVsLm5vZGVUeXBlID8gZWwgOiB0aGF0LnNjcm9sbGVyLnF1ZXJ5U2VsZWN0b3IoZWwpOwogICAgICAgICAgICBpZiAoIWVsKSByZXR1cm47CgogICAgICAgICAgICBwb3MgPSB0aGF0Ll9vZmZzZXQoZWwpOwogICAgICAgICAgICBwb3MubGVmdCArPSB0aGF0LndyYXBwZXJPZmZzZXRMZWZ0OwogICAgICAgICAgICBwb3MudG9wICs9IHRoYXQud3JhcHBlck9mZnNldFRvcDsKCiAgICAgICAgICAgIHBvcy5sZWZ0ID0gcG9zLmxlZnQgPiAwID8gMCA6IHBvcy5sZWZ0IDwgdGhhdC5tYXhTY3JvbGxYID8gdGhhdC5tYXhTY3JvbGxYIDogcG9zLmxlZnQ7CiAgICAgICAgICAgIHBvcy50b3AgPSBwb3MudG9wID4gdGhhdC5taW5TY3JvbGxZID8gdGhhdC5taW5TY3JvbGxZIDogcG9zLnRvcCA8IHRoYXQubWF4U2Nyb2xsWSA/IHRoYXQubWF4U2Nyb2xsWSA6IHBvcy50b3A7CiAgICAgICAgICAgIHRpbWUgPSB0aW1lID09PSB1bmRlZmluZWQgPyBtLm1heChtLmFicyhwb3MubGVmdCkqMiwgbS5hYnMocG9zLnRvcCkqMikgOiB0aW1lOwoKICAgICAgICAgICAgdGhhdC5zY3JvbGxUbyhwb3MubGVmdCwgcG9zLnRvcCwgdGltZSk7CiAgICAgICAgfSwKCiAgICAgICAgc2Nyb2xsVG9QYWdlOiBmdW5jdGlvbiAocGFnZVgsIHBhZ2VZLCB0aW1lKSB7CiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgeCwgeTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHRpbWUgPSB0aW1lID09PSB1bmRlZmluZWQgPyA0MDAgOiB0aW1lOwoKICAgICAgICAgICAgaWYgKHRoYXQub3B0aW9ucy5vblNjcm9sbFN0YXJ0KSB0aGF0Lm9wdGlvbnMub25TY3JvbGxTdGFydC5jYWxsKHRoYXQpOwoKICAgICAgICAgICAgaWYgKHRoYXQub3B0aW9ucy5zbmFwKSB7CiAgICAgICAgICAgICAgICBwYWdlWCA9IHBhZ2VYID09ICduZXh0JyA/IHRoYXQuY3VyclBhZ2VYKzEgOiBwYWdlWCA9PSAncHJldicgPyB0aGF0LmN1cnJQYWdlWC0xIDogcGFnZVg7CiAgICAgICAgICAgICAgICBwYWdlWSA9IHBhZ2VZID09ICduZXh0JyA/IHRoYXQuY3VyclBhZ2VZKzEgOiBwYWdlWSA9PSAncHJldicgPyB0aGF0LmN1cnJQYWdlWS0xIDogcGFnZVk7CgogICAgICAgICAgICAgICAgcGFnZVggPSBwYWdlWCA8IDAgPyAwIDogcGFnZVggPiB0aGF0LnBhZ2VzWC5sZW5ndGgtMSA/IHRoYXQucGFnZXNYLmxlbmd0aC0xIDogcGFnZVg7CiAgICAgICAgICAgICAgICBwYWdlWSA9IHBhZ2VZIDwgMCA/IDAgOiBwYWdlWSA+IHRoYXQucGFnZXNZLmxlbmd0aC0xID8gdGhhdC5wYWdlc1kubGVuZ3RoLTEgOiBwYWdlWTsKCiAgICAgICAgICAgICAgICB0aGF0LmN1cnJQYWdlWCA9IHBhZ2VYOwogICAgICAgICAgICAgICAgdGhhdC5jdXJyUGFnZVkgPSBwYWdlWTsKICAgICAgICAgICAgICAgIHggPSB0aGF0LnBhZ2VzWFtwYWdlWF07CiAgICAgICAgICAgICAgICB5ID0gdGhhdC5wYWdlc1lbcGFnZVldOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgeCA9IC10aGF0LndyYXBwZXJXICogcGFnZVg7CiAgICAgICAgICAgICAgICB5ID0gLXRoYXQud3JhcHBlckggKiBwYWdlWTsKICAgICAgICAgICAgICAgIGlmICh4IDwgdGhhdC5tYXhTY3JvbGxYKSB4ID0gdGhhdC5tYXhTY3JvbGxYOwogICAgICAgICAgICAgICAgaWYgKHkgPCB0aGF0Lm1heFNjcm9sbFkpIHkgPSB0aGF0Lm1heFNjcm9sbFk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoYXQuc2Nyb2xsVG8oeCwgeSwgdGltZSk7CiAgICAgICAgfSwKCiAgICAgICAgZGlzYWJsZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB0aGlzLnN0b3AoKTsKICAgICAgICAgICAgdGhpcy5fcmVzZXRQb3MoMCk7CiAgICAgICAgICAgIHRoaXMuZW5hYmxlZCA9IGZhbHNlOwoKICAgICAgICAgICAgLy8gSWYgZGlzYWJsZWQgYWZ0ZXIgdG91Y2hzdGFydCB3ZSBtYWtlIHN1cmUgdGhhdCB0aGVyZSBhcmUgbm8gbGVmdCBvdmVyIGV2ZW50cwogICAgICAgICAgICB0aGlzLl91bmJpbmQoTU9WRV9FViwgd2luZG93KTsKICAgICAgICAgICAgdGhpcy5fdW5iaW5kKEVORF9FViwgd2luZG93KTsKICAgICAgICAgICAgdGhpcy5fdW5iaW5kKENBTkNFTF9FViwgd2luZG93KTsKICAgICAgICB9LAogICAgICAgIAogICAgICAgIGVuYWJsZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB0aGlzLmVuYWJsZWQgPSB0cnVlOwogICAgICAgIH0sCiAgICAgICAgCiAgICAgICAgc3RvcDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnVzZVRyYW5zaXRpb24pIHRoaXMuX3VuYmluZChUUk5FTkRfRVYpOwogICAgICAgICAgICBlbHNlIGNhbmNlbEZyYW1lKHRoaXMuYW5pVGltZSk7CiAgICAgICAgICAgIHRoaXMuc3RlcHMgPSBbXTsKICAgICAgICAgICAgdGhpcy5tb3ZlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmFuaW1hdGluZyA9IGZhbHNlOwogICAgICAgIH0sCiAgICAgICAgCiAgICAgICAgem9vbTogZnVuY3Rpb24gKHgsIHksIHNjYWxlLCB0aW1lKSB7CiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywKICAgICAgICAgICAgICAgIHJlbFNjYWxlID0gc2NhbGUgLyB0aGF0LnNjYWxlOwoKICAgICAgICAgICAgaWYgKCF0aGF0Lm9wdGlvbnMudXNlVHJhbnNmb3JtKSByZXR1cm47CgogICAgICAgICAgICB0aGF0Lnpvb21lZCA9IHRydWU7CiAgICAgICAgICAgIHRpbWUgPSB0aW1lID09PSB1bmRlZmluZWQgPyAyMDAgOiB0aW1lOwogICAgICAgICAgICB4ID0geCAtIHRoYXQud3JhcHBlck9mZnNldExlZnQgLSB0aGF0Lng7CiAgICAgICAgICAgIHkgPSB5IC0gdGhhdC53cmFwcGVyT2Zmc2V0VG9wIC0gdGhhdC55OwogICAgICAgICAgICB0aGF0LnggPSB4IC0geCAqIHJlbFNjYWxlICsgdGhhdC54OwogICAgICAgICAgICB0aGF0LnkgPSB5IC0geSAqIHJlbFNjYWxlICsgdGhhdC55OwoKICAgICAgICAgICAgdGhhdC5zY2FsZSA9IHNjYWxlOwogICAgICAgICAgICB0aGF0LnJlZnJlc2goKTsKCiAgICAgICAgICAgIHRoYXQueCA9IHRoYXQueCA+IDAgPyAwIDogdGhhdC54IDwgdGhhdC5tYXhTY3JvbGxYID8gdGhhdC5tYXhTY3JvbGxYIDogdGhhdC54OwogICAgICAgICAgICB0aGF0LnkgPSB0aGF0LnkgPiB0aGF0Lm1pblNjcm9sbFkgPyB0aGF0Lm1pblNjcm9sbFkgOiB0aGF0LnkgPCB0aGF0Lm1heFNjcm9sbFkgPyB0aGF0Lm1heFNjcm9sbFkgOiB0aGF0Lnk7CgogICAgICAgICAgICB0aGF0LnNjcm9sbGVyLnN0eWxlW3RyYW5zaXRpb25EdXJhdGlvbl0gPSB0aW1lICsgJ21zJzsKICAgICAgICAgICAgdGhhdC5zY3JvbGxlci5zdHlsZVt0cmFuc2Zvcm1dID0gJ3RyYW5zbGF0ZSgnICsgdGhhdC54ICsgJ3B4LCcgKyB0aGF0LnkgKyAncHgpIHNjYWxlKCcgKyBzY2FsZSArICcpJyArIHRyYW5zbGF0ZVo7CiAgICAgICAgICAgIHRoYXQuem9vbWVkID0gZmFsc2U7CiAgICAgICAgfSwKICAgICAgICAKICAgICAgICBpc1JlYWR5OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiAhdGhpcy5tb3ZlZCAmJiAhdGhpcy56b29tZWQgJiYgIXRoaXMuYW5pbWF0aW5nOwogICAgICAgIH0KICAgIH07CgogICAgZnVuY3Rpb24gcHJlZml4U3R5bGUgKHN0eWxlKSB7CiAgICAgICAgaWYgKCB2ZW5kb3IgPT09ICcnICkgcmV0dXJuIHN0eWxlOwoKICAgICAgICBzdHlsZSA9IHN0eWxlLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgc3R5bGUuc3Vic3RyKDEpOwogICAgICAgIHJldHVybiB2ZW5kb3IgKyBzdHlsZTsKICAgIH0KCiAgICBkdW1teVN0eWxlID0gbnVsbDsJLy8gZm9yIHRoZSBzYWtlIG9mIGl0CgogICAgaWYgKHR5cGVvZiBleHBvcnRzICE9PSAndW5kZWZpbmVkJykgZXhwb3J0cy5pU2Nyb2xsID0gaVNjcm9sbDsKICAgIGVsc2Ugd2luZG93LmlTY3JvbGwgPSBpU2Nyb2xsOwoKICAgIH0pKHdpbmRvdywgZG9jdW1lbnQpOwoKICAgIC8qKgogICAgICog1+jWucSsyM/Kwrz+tKbA7QogICAgICogQHBhcmFtIHtFdmVudH0KICAgICAqLwogICAgZnVuY3Rpb24gcHJldmVudERlZmF1bHQoZSl7CiAgICAgICAgdmFyIGUgPSB3aW5kb3cuZXZlbnQgfHwgZTsKICAgICAgICBlLnByZXZlbnREZWZhdWx0ID8gZS5wcmV2ZW50RGVmYXVsdCgpIDogZS5yZXR1cm5WYWx1ZSA9IGZhbHNlOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCgogICAgLyoqCiAgICAgKiCzo8G/c2VhcmNoVHlwZQogICAgICovCiAgICB3aW5kb3cuTE9DQUxfU0VBUkNIICAgPSAiMSI7CiAgICB3aW5kb3cuVFJBTlNJVF9ST1VURSAgPSAiMiI7CiAgICB3aW5kb3cuRFJJVklOR19ST1VURSAgPSAiMyI7CgogICAgLyoqCiAgICAgKiBTZWFyY2hDb250cm9swOC1xLm51Oy6r8r9CiAgICAgKiBAY2xhc3MgvOzL97/YvP4gPGI+yOu/2jwvYj6howogICAgICogQGNvbnN0cnVjdG9yCiAgICAgKi8KICAgIGZ1bmN0aW9uIFNlYXJjaENvbnRyb2wgKG9wdGlvbnMpIHsKICAgICAgICB0aGlzLm1hcCAgICAgICA9IG9wdGlvbnMubWFwOwogICAgICAgIHRoaXMucHJvamVjdGlvbiA9IHRoaXMubWFwLmdldE1hcFR5cGUoKS5nZXRQcm9qZWN0aW9uKCk7CiAgICAgICAgdGhpcy5jb250YWluZXIgPSBiYWlkdS5pc1N0cmluZyhvcHRpb25zLmNvbnRhaW5lcikgPyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChvcHRpb25zLmNvbnRhaW5lcikgOiBvcHRpb25zLmNvbnRhaW5lcjsKICAgICAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgTE9DQUxfU0VBUkNIOwogICAgICAgIHRoaXMuZW5hYmxlQXV0b0xvY2F0aW9uID0gb3B0aW9ucy5lbmFibGVBdXRvTG9jYXRpb24gPT09IGZhbHNlID8gZmFsc2UgOiB0cnVlOyAvL8rHt/G4+b7dSVC2qM67tbHHsLPHytAKICAgICAgICB0aGlzLmluaXRpYWxpemUoKTsKICAgIH0KCiAgICBTZWFyY2hDb250cm9sLnByb3RvdHlwZSA9IHsKICAgICAgICBjb25zdHJ1Y3RvcjogU2VhcmNoQ29udHJvbAoKICAgICAgICAvKioKICAgICAgICAgKiCz9cq8u6+y2df3CiAgICAgICAgICovCiAgICAgICAgLCBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmlubmVySFRNTCA9IHRoaXMuX2dldEh0bWwoKTsKICAgICAgICAgICAgdGhpcy5faW5pdERvbSgpOwogICAgICAgICAgICBpZiAodGhpcy5lbmFibGVBdXRvTG9jYXRpb24pIHsKICAgICAgICAgICAgICAgIHRoaXMuX2luaXRMb2NhbENpdHkoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9pbml0U2VydmljZSgpOwogICAgICAgICAgICB0aGlzLl9pbml0Q2l0eVRhYigpOwogICAgICAgICAgICB0aGlzLl9iaW5kKCk7CiAgICAgICAgICAgIHRoaXMuc2V0VHlwZSh0aGlzLnR5cGUpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogyfqzyb/YvP7L+dDo0qq1xGRvbdSqy9gKICAgICAgICAgKi8KICAgICAgICAsIF9nZXRIdG1sOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBodG1sID0gWwogICAgICAgICAgICAgICAgJzxkaXYgaWQ9IkJNYXBMaWJfc2VhcmNoQm94Q29udGVudCIgY2xhc3M9IkJNYXBMaWJfc2NoYm94Ij4nLAogICAgICAgICAgICAgICAgICAgICc8ZGl2IGlkPSJCTWFwTGliX25vcm1hbEJveCIgY2xhc3M9IkJNYXBMaWJfc2NfdCBzY19ib3hfYmciPicsCiAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGlkPSJCTWFwTGliX3NjMCI+JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8dGFibGUgc3R5bGU9IndpZHRoOjEwMCU7IiBib3JkZXI9IjAiIGNlbGxwYWRkaW5nPSIwIiBjZWxsc3BhY2luZz0iMCI+JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHRyPicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8dGQ+JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGlkPSJCTWFwTGliX2NpdHlUYWIiIGNsYXNzPSJCTWFwTGliX2NpdHlUYWIiPicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuPrGxvqnK0Dwvc3Bhbj4nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8ZW0gY2xhc3M9ImNpdHlfaWNvbiI+PC9lbT4nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2PicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L3RkPicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8dGQgd2lkdGg9IjEwMCUiPicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGZvcm0gaWQ9IkJNYXBMaWJfZm9ybVBvaSIgY2xhc3M9IkJNYXBMaWJfc2VCb3giPjxpbnB1dCBkYXRhLXdpZGdldD0icXVpY2tkZWxldGUiIGlkPSJCTWFwTGliX1BvaVNlYXJjaCIgY2xhc3M9InR4dFBvaSIgdHlwZT0ic2VhcmNoIi8+PGVtIGlkPSJidG5QQ2xlYXIiIGNsYXNzPSJCTWFwTGliX3h4Ij48L2VtPjwvZm9ybT4nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC90ZD4nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHRkPicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz0iQk1hcExpYl9zY190X2Igc2NfYnRuIiBpZD0iQk1hcExpYl9zY19iMCI+sNm2yNK7z8I8L2Rpdj4nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC90ZD4nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L3RyPicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC90YWJsZT4nLAogICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JywKICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgaWQ9IkJNYXBMaWJfc2MxIiBzdHlsZT0iZGlzcGxheTpub25lOyI+JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8dGFibGUgc3R5bGU9IndpZHRoOjEwMCU7IiBib3JkZXI9IjAiIGNlbGxwYWRkaW5nPSIwIiBjZWxsc3BhY2luZz0iMCI+JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHRyPicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8dGQ+JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGlkPSJCTWFwTGliX3NjX2IxIiBjbGFzcz0iQk1hcExpYl9zY190X3N3IHNjX2J0biI+JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz0iQk1hcExpYl9zY190X3N3MSI+PC9kaXY+JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC90ZD4nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHRkIHdpZHRoPSIxMDAlIj4nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9IkJNYXBMaWJfZGJzZUJveCIgc3R5bGU9Im1hcmdpbi1ib3R0b206IDVweDsiPicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxlbSBjbGFzcz0iQk1hcExpYl9pcHRfaWNvbiBCTWFwTGliX3R4dFN0YSI+PC9lbT48aW5wdXQgY2xhc3M9ImlwdF90eHQiIHR5cGU9InNlYXJjaCIgaWQ9IkJNYXBMaWJfdHh0TmF2UyIvPjxlbSBpZD0iYnRuU0NsZWFyIiBjbGFzcz0ieHgiPjwvZW0+JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9IkJNYXBMaWJfZGJzZUJveCI+PGVtIGNsYXNzPSJCTWFwTGliX2lwdF9pY29uIEJNYXBMaWJfdHh0RW5kIj48L2VtPjxpbnB1dCBjbGFzcz0iaXB0X3R4dCIgdHlwZT0ic2VhcmNoIiBpZD0iQk1hcExpYl90eHROYXZFIi8+PGVtIGlkPSJidG5FQ2xlYXIiIGNsYXNzPSJ4eCI+PC9lbT48L2Rpdj4nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC90ZD4nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHRkPicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz0iQk1hcExpYl9zY190X2Igc2NfYnRuIiBpZD0iQk1hcExpYl9zY19iMiI+JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz0iQk1hcExpYl9zY190X2IxIj48L2Rpdj4nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2PicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L3RkPicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvdHI+JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L3RhYmxlPicsCiAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nLAogICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nLAogICAgICAgICAgICAgICAgICAgICc8ZGl2IGlkPSJCTWFwTGliX3RpcEJveCI+JywKICAgICAgICAgICAgICAgICAgICAnPGRpdj4nLAogICAgICAgICAgICAgICAgJzwvZGl2PicKICAgICAgICAgICAgXS5qb2luKCIiKTsKICAgICAgICAgICAgcmV0dXJuIGh0bWw7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiC78cihz+C52LXERE9N1KrL2AogICAgICAgICAqLwogICAgICAgICwgX2luaXREb206IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdGhpcy5kb20gPSB7CiAgICAgICAgICAgICAgICBzZWFyY2hCb3hDb250ZW50IDogYmFpZHUuZygiQk1hcExpYl9zZWFyY2hCb3hDb250ZW50IikgLy/I3cb3CiAgICAgICAgICAgICAgICAsIHNjMCAgICAgICAgOiBiYWlkdS5nKCJCTWFwTGliX3NjMCIpIC8vxtXNqLzsy/fI3cb3CiAgICAgICAgICAgICAgICAsIHNjMSAgICAgICAgOiBiYWlkdS5nKCJCTWFwTGliX3NjMSIpICAgICAvL7zds7W6zbmrvbu87Mv3yN3G96OsuavTw9K7uPbI3cb3CiAgICAgICAgICAgICAgICAsIHNlYXJjaFRleHQgOiBiYWlkdS5nKCJCTWFwTGliX1BvaVNlYXJjaCIpIC8vxtXNqLzsy/fOxLG+v/IKICAgICAgICAgICAgICAgICwgblNlYXJjaEJ0biA6IGJhaWR1LmcoIkJNYXBMaWJfc2NfYjAiKSAgICAgLy/G1c2ovOzL97C0xaUKICAgICAgICAgICAgICAgICwgc3RhcnRUZXh0ICA6IGJhaWR1LmcoIkJNYXBMaWJfdHh0TmF2UyIpICAgLy+87Mv3xvC1487Esb6/8gogICAgICAgICAgICAgICAgLCBlbmRUZXh0ICAgIDogYmFpZHUuZygiQk1hcExpYl90eHROYXZFIikgICAvL7zsy/fW1bXjzsSxvr/yCiAgICAgICAgICAgICAgICAsIGhTZWFyY2hCdG4gOiBiYWlkdS5nKCJCTWFwTGliX3NjX2IyIikgICAgIC8vuau9u7vyvN2ztbzsy/ewtMWlCiAgICAgICAgICAgICAgICAsIGNoYW5nZUJ0biAgOiBiYWlkdS5nKCJCTWFwTGliX3NjX2IxIikgICAgIC8vvbu7u8bw1tW148r9vt2wtMWlCiAgICAgICAgICAgICAgICAsIGZvcm1Qb2kgICAgOiBiYWlkdS5nKCJCTWFwTGliX2Zvcm1Qb2kiKSAgIC8vxtXNqLzsy/ex7bWlCiAgICAgICAgICAgICAgICAsIGNpdHlUYWIgICAgOiBiYWlkdS5nKCJCTWFwTGliX2NpdHlUYWIiKS5jaGlsZE5vZGVzWzBdLy+zx8rQzsSxvtDFz6IKICAgICAgICAgICAgICAgICwgdGlwQm94ICAgICA6IGJhaWR1LmcoIkJNYXBMaWJfdGlwQm94IikgICAgLy/M4cq+0MXPosz1CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy+05rSis8fK0GRvbQogICAgICAgICAgICB0aGlzLmNpdHlMaXN0U3ViID0ge307CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBpcLaozru1scews8fK0AogICAgICAgICAqLwogICAgICAgICwgX2luaXRMb2NhbENpdHk6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIG15Q2l0eSA9IG5ldyBCTWFwLkxvY2FsQ2l0eSgpLAogICAgICAgICAgICAgICAgbWFwID0gdGhpcy5tYXAsCiAgICAgICAgICAgICAgICBjaXR5VGFiID0gdGhpcy5kb20uY2l0eVRhYjsKICAgICAgICAgICAgbXlDaXR5LmdldChmdW5jdGlvbihyZXN1bHQpewogICAgICAgICAgICAgICAgdmFyIGNpdHlOYW1lID0gcmVzdWx0Lm5hbWU7CiAgICAgICAgICAgICAgICBtYXAuc2V0Q2VudGVyKGNpdHlOYW1lKTsKICAgICAgICAgICAgICAgIGNpdHlUYWIuaW5uZXJIVE1MID0gY2l0eU5hbWU7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqILP1yry7r7j3vOzL97f+zvEKICAgICAgICAgKi8KICAgICAgICAsIF9pbml0U2VydmljZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgbWFwICA9IHRoaXMubWFwOwogICAgICAgICAgICB0aGlzLmxvY2FsU2VhcmNoID0gbmV3IEJNYXAuTG9jYWxTZWFyY2gobWFwLCB7CiAgICAgICAgICAgICAgICByZW5kZXJPcHRpb25zOnttYXA6IG1hcH0KICAgICAgICAgICAgICAgICwgb25TZWFyY2hDb21wbGV0ZSA6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgc3RhdHVzID0gbWUubG9jYWxTZWFyY2guZ2V0U3RhdHVzKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXR1cyAhPSBCTUFQX1NUQVRVU19TVUNDRVNTKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1lLnNob3dUaXBCb3goc3RhdHVzKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmNpdHkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lLnNldENpdHlUYWJOYW1lKHJlc3VsdC5jaXR5KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgICAgICAgIHRoaXMudHJhbnNpdFJvdXRlID0gbmV3IEJNYXAuVHJhbnNpdFJvdXRlKG1hcCwgewogICAgICAgICAgICAgICAgcmVuZGVyT3B0aW9ucyA6IHttYXA6IG1hcH0KICAgICAgICAgICAgICAgICwgb25TZWFyY2hDb21wbGV0ZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgc3RhdHVzID0gbWUudHJhbnNpdFJvdXRlLmdldFN0YXR1cygpOwogICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgIT0gQk1BUF9TVEFUVVNfU1VDQ0VTUykgewogICAgICAgICAgICAgICAgICAgICAgICBtZS5zaG93VGlwQm94KHN0YXR1cyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5kcml2aW5nUm91dGUgID0gbmV3IEJNYXAuRHJpdmluZ1JvdXRlKG1hcCwgewogICAgICAgICAgICAgICAgcmVuZGVyT3B0aW9uczp7bWFwOiBtYXAsIGF1dG9WaWV3cG9ydDogdHJ1ZX0KICAgICAgICAgICAgICAgICwgb25TZWFyY2hDb21wbGV0ZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgc3RhdHVzID0gbWUuZHJpdmluZ1JvdXRlLmdldFN0YXR1cygpOwogICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgIT0gQk1BUF9TVEFUVVNfU1VDQ0VTUykgewogICAgICAgICAgICAgICAgICAgICAgICBtZS5zaG93VGlwQm94KHN0YXR1cyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqILDztqjKwrz+CiAgICAgICAgICovCiAgICAgICAgLCBfYmluZDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgZXZlbnROYW1lID0gImNsaWNrIgogICAgICAgICAgICAgICAgLCBtZSAgPSB0aGlzOwogICAgICAgICAgICBiYWlkdS5vbih0aGlzLmRvbS5uU2VhcmNoQnRuLCBldmVudE5hbWUsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgIHByZXZlbnREZWZhdWx0KGUpOwogICAgICAgICAgICAgICAgbWUubG9jYWxTZWFyY2hBY3Rpb24oKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGJhaWR1Lm9uKHRoaXMuZG9tLmNoYW5nZUJ0biwgZXZlbnROYW1lLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICBwcmV2ZW50RGVmYXVsdChlKTsKICAgICAgICAgICAgICAgIG1lLmNoYW5nZVN0YXJ0QW5kRW5kKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLmRvbS5mb3JtUG9pLm9uc3VibWl0ID1mdW5jdGlvbigpewogICAgICAgICAgICAgICAgLy/NqLn9yta7+rz8xcxHT7eixvC1xFBPSbzsy/cKICAgICAgICAgICAgICAgIG1lLmxvY2FsU2VhcmNoQWN0aW9uKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYmFpZHUub24odGhpcy5kb20uY2l0eVRhYiwgZXZlbnROYW1lLCBmdW5jdGlvbihlKXsKICAgICAgICAgICAgICAgIG1lLnNob3dDaXR5Qm94KCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLmF1dG9Db21wbGV0ZUluaSgpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogtKW3omxvY2Fsc2VhcmNoysK8/gogICAgICAgICAqLwogICAgICAgICwgbG9jYWxTZWFyY2hBY3Rpb246IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdGhpcy5yZXNldCgpOwogICAgICAgICAgICAvL8qnyKW9ubXjytXG8MrWu/rJz7XEvPzFzAogICAgICAgICAgICB0aGlzLmRvbS5zZWFyY2hUZXh0LmJsdXIoKTsKICAgICAgICAgICAgLy/S/rLYYXV0b2NvbXBsZXRlCiAgICAgICAgICAgIHRoaXMuc2VhcmNoQUMuaGlkZSgpOwogICAgICAgICAgICB2YXIga2V5d29yZCA9IHRoaXMuZG9tLnNlYXJjaFRleHQudmFsdWU7CiAgICAgICAgICAgIHRoaXMubG9jYWxTZWFyY2guc2VhcmNoKGtleXdvcmQpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICoguau9u7u7s8uy6dGvCiAgICAgICAgICovCiAgICAgICAgLCB0cmFuc2l0Um91dGVBY3Rpb246IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdGhpcy5yZXNldCgpOwogICAgICAgICAgICB2YXIgc3RhcnRLZXl3b3JkICAgID0gdGhpcy5kb20uc3RhcnRUZXh0LnZhbHVlCiAgICAgICAgICAgICAgICAsIGVuZEtleXdvcmQgICAgPSB0aGlzLmRvbS5lbmRUZXh0LnZhbHVlCiAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgIHRoaXMudHJhbnNpdFJvdXRlLnNlYXJjaChzdGFydEtleXdvcmQsIGVuZEtleXdvcmQpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogvN2ztcK3vra87Mv3CiAgICAgICAgICovCiAgICAgICAgLCBkcml2aW5nUm91dGVBY3Rpb24gOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHRoaXMucmVzZXQoKTsKICAgICAgICAgICAgdmFyIHN0YXJ0S2V5d29yZCAgICA9IHRoaXMuZG9tLnN0YXJ0VGV4dC52YWx1ZQogICAgICAgICAgICAgICAgLCBlbmRLZXl3b3JkICAgID0gdGhpcy5kb20uZW5kVGV4dC52YWx1ZQogICAgICAgICAgICAgICAgOwogICAgICAgICAgICB0aGlzLmRyaXZpbmdSb3V0ZS5zZWFyY2goc3RhcnRLZXl3b3JkLCBlbmRLZXl3b3JkKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIM/Uyr7M4cq+0MXPogogICAgICAgICAqLwogICAgICAgICwgc2hvd1RpcEJveDogZnVuY3Rpb24oc3RhdHVzKSB7CiAgICAgICAgICAgIHZhciBtZXNzYWdlID0gIs60y9HL97W917zIt7XEveG5+yI7CiAgICAgICAgICAgIHN3aXRjaCAoc3RhdHVzKSB7CiAgICAgICAgICAgICAgICBjYXNlIEJNQVBfU1RBVFVTX1VOS05PV05fTE9DQVRJT046CiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9ICLOu9bDveG5+8601qoiOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBCTUFQX1NUQVRVU19VTktOT1dOX1JPVVRFOgogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSAitby6vb3hufvOtNaqIjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgdGlwQm94ID0gdGhpcy5kb20udGlwQm94OwogICAgICAgICAgICB0aXBCb3guaW5uZXJIVE1MID0gbWVzc2FnZTsKICAgICAgICAgICAgdGlwQm94LnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgICAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdGlwQm94LnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgICAgIH0sIDQwMDApOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICog0N64xMbw1tW147XEzsSxvtDFz6IKICAgICAgICAgKi8KICAgICAgICAsIGNoYW5nZVN0YXJ0QW5kRW5kOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciB0ZW1wID0gdGhpcy5kb20uc3RhcnRUZXh0LnZhbHVlOwogICAgICAgICAgICB0aGlzLmRvbS5zdGFydFRleHQudmFsdWUgPSB0aGlzLmRvbS5lbmRUZXh0LnZhbHVlOwogICAgICAgICAgICB0aGlzLmRvbS5lbmRUZXh0LnZhbHVlID0gdGVtcDsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqILDztqjX1LavzeqzycrCvP4KICAgICAgICAgKi8KICAgICAgICAsIGF1dG9Db21wbGV0ZUluaTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB0aGlzLnNlYXJjaEFDPSBuZXcgQk1hcC5BdXRvY29tcGxldGUoewogICAgICAgICAgICAgICAgImlucHV0IiAgICAgIDogdGhpcy5kb20uc2VhcmNoVGV4dAogICAgICAgICAgICAgICAgLCAibG9jYXRpb24iIDogdGhpcy5tYXAKICAgICAgICAgICAgICAgICwgImJhc2VEb20iICA6IHRoaXMuZG9tLnNlYXJjaEJveENvbnRlbnQKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuc3RhcnRBQyA9IG5ldyBCTWFwLkF1dG9jb21wbGV0ZSh7CiAgICAgICAgICAgICAgICAiaW5wdXQiICAgICAgOiB0aGlzLmRvbS5zdGFydFRleHQKICAgICAgICAgICAgICAgICwgImxvY2F0aW9uIiA6IHRoaXMubWFwCiAgICAgICAgICAgICAgICAsICJiYXNlRG9tIiAgOiB0aGlzLmRvbS5zZWFyY2hCb3hDb250ZW50CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLmVuZEFDID0gbmV3IEJNYXAuQXV0b2NvbXBsZXRlKHsKICAgICAgICAgICAgICAgICJpbnB1dCIgICAgICA6IHRoaXMuZG9tLmVuZFRleHQKICAgICAgICAgICAgICAgICwgImxvY2F0aW9uIiA6IHRoaXMubWFwCiAgICAgICAgICAgICAgICAsICJiYXNlRG9tIiAgOiB0aGlzLmRvbS5zZWFyY2hCb3hDb250ZW50CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogyejWw7Wxx7C1xLzsy/fA4NDNCiAgICAgICAgICovCiAgICAgICAgLCBzZXRUeXBlIDogZnVuY3Rpb24gKHNlYXJjaFR5cGUpIHsKICAgICAgICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgICAgICAgc3dpdGNoIChzZWFyY2hUeXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlIExPQ0FMX1NFQVJDSCAgOgogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0JveCgwKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgVFJBTlNJVF9ST1VURSA6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93Qm94KDEpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZG9tLmhTZWFyY2hCdG4ub25jbGljayA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByZXZlbnREZWZhdWx0KGUpOwogICAgICAgICAgICAgICAgICAgICAgICBtZS50cmFuc2l0Um91dGVBY3Rpb24oKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIERSSVZJTkdfUk9VVEUgOgogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0JveCgxKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRvbS5oU2VhcmNoQnRuLm9uY2xpY2sgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICBwcmV2ZW50RGVmYXVsdChlKTsKICAgICAgICAgICAgICAgICAgICAgICAgbWUuZHJpdmluZ1JvdXRlQWN0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogx+Wz/dfuvfy1xL3hufsKICAgICAgICAgKi8KICAgICAgICAsIHJlc2V0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB0aGlzLmxvY2FsU2VhcmNoLmNsZWFyUmVzdWx0cygpOwogICAgICAgICAgICB0aGlzLnRyYW5zaXRSb3V0ZS5jbGVhclJlc3VsdHMoKTsKICAgICAgICAgICAgdGhpcy5kcml2aW5nUm91dGUuY2xlYXJSZXN1bHRzKCk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiDP1Mq+w+aw5QogICAgICAgICAqIDAgo7rG1c2ovOzL9wogICAgICAgICAqIDEgOiC5q727vOzL97vyvN2ztbzsy/cKICAgICAgICAgKi8KICAgICAgICAsIHNob3dCb3ggOiBmdW5jdGlvbiAodHlwZSkgewogICAgICAgICAgICB0aGlzLmRvbS5zYzAuc3R5bGUuZGlzcGxheSA9IHR5cGUgPyAibm9uZSIgIDogImJsb2NrIjsKICAgICAgICAgICAgdGhpcy5kb20uc2MxLnN0eWxlLmRpc3BsYXkgPSB0eXBlID8gImJsb2NrIiA6ICJub25lIjsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIM/Uyr6zx8rQ0MXPogogICAgICAgICAqLwogICAgICAgICwgX2luaXRDaXR5VGFiIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgY2l0eVNlbGVjdERvbSA9IHRoaXMuY2l0eVNlbGVjdERvbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgICBjaXR5U2VsZWN0RG9tLnN0eWxlLmNzc1RleHQgPSAicG9zaXRpb246YWJzb2x1dGU7bGVmdDowcHg7d2lkdGg6ODAlO2JhY2tncm91bmQ6I0ZBRkFGQTtsZWZ0OjEwJTtvdmVyZmxvdzpoaWRkZW47Ym9yZGVyOjFweCBzb2xpZCAjOEM4QzhDO2Rpc3BsYXk6bm9uZTt0b3A6NTAlOyI7CiAgICAgICAgICAgIHZhciBhcmVhVUlEID0gIrGxvql8MTMxLMnPuqN8Mjg5LMzsvfJ8MzMyLNbYx+x8MTMyLLCyu9V8MjMsuKO9qHwxNiy4ysvgfDYsueO2q3w3LLnjzvd8MTcsufPW3XwyNCy6o8TPfDIxLLrTsbF8MjUsutrB+r2tfDIsutPEz3wzMCy6/rGxfDE1LLr+xM98MjYsva3L1XwxOCy9rc73fDMxLLyqwdbKoXw5LMHJxP58MTksxNrDybnFfDIyLMT+z8R8MjAsx+C6o3wxMSzJvbarfDgsyb3O93wxMCzJws73fDI3LMvEtKh8MzIs0MK9rnwxMizO97LYfDEzLNTGxM98Mjgs1eO9rXwyOSIuc3BsaXQoIiwiKTsKICAgICAgICAgICAgdmFyIEFJRCA9IFtdOwoJICAgICAgICBmb3IodmFyIGk9MDsgaTxhcmVhVUlELmxlbmd0aDsgaSsrKXsKCQkgICAgICAgIHZhciBhID0gYXJlYVVJRFtpXS5zcGxpdCgifCIpOwogICAgICAgICAgICAgICAgQUlELnB1c2goewogICAgICAgICAgICAgICAgICAgIG5hbWUgOiBhWzBdCiAgICAgICAgICAgICAgICAgICAgLCBjb2RlIDogYVsxXQogICAgICAgICAgICAgICAgfSk7CgkgICAgICAgIH0KICAgICAgICAgICAgdmFyIGh0bWwgPSAnPGRpdiBzdHlsZT0iaGVpZ2h0OjQwcHg7bGluZS1oZWlnaHQ6NDBweDtiYWNrZ3JvdW5kOiM4QzhDOEM7Y29sb3I6I2ZmZjtwYWRkaW5nLWxlZnQ6MTBweDtmb250LXNpemU6MTJweDsiPjxzcGFuIHN0eWxlPSJmbG9hdDpsZWZ0OyI+x+vRodTxvt/M5bPHytA8L3NwYW4+PHNwYW4gc3R5bGU9ImZsb2F0OnJpZ2h0O3BhZGRpbmc6MCAxMHB4OyIgb25jbGljaz0idGhpcy5wYXJlbnROb2RlLnBhcmVudE5vZGUuc3R5bGUuZGlzcGxheT1cJ25vbmVcJyI+udix1Twvc3Bhbj48L2Rpdj4nICsKICAgICAgICAgICAgICAgICAgICAnPGRpdiBzdHlsZT0ib3ZlcmZsb3c6aGlkZGVuO3dpZHRoOjEwMCU7aGVpZ2h0OjIwMHB4O3Bvc2l0aW9uOnJlbGF0aXZlOyIgaWQ9IkJNYXBMaWJfc2Nyb2xsIj4nICsKICAgICAgICAgICAgICAgICAgICAnPHVsIGlkID0gIkJNYXBMaWJfY2l0eUxpc3QiIHN0eWxlPSJsaXN0LXN0eWxlOm5vbmU7cGFkZGluZzowcHg7bWFyZ2luOjBweDsiPicKICAgICAgICAgICAgOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IEFJRC5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgICAgICAgIGh0bWwgKz0gJzxsaSBzdHlsZT0iaGVpZ2h0OjQwcHg7bGluZS1oZWlnaHQ6NDBweDtib3JkZXItYm90dG9tOjFweCBzb2xpZCAjOTk5O2ZvbnQtc2l6ZToxNHB4O3BhZGRpbmctbGVmdDoyMHB4OyIgdHlwZT0gIjEiIGNpdHlDb2RlPSInICsgQUlEW2ldWyJjb2RlIl0gKyAnIiBpZD0iQk1hcExpYl9jaXR5SXRlbScgKyBBSURbaV1bImNvZGUiXSArICciPicgKyBBSURbaV1bIm5hbWUiXSArICc8L2xpPic7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaHRtbCArPSAnPC91bD4nICsgCiAgICAgICAgICAgICAgICAgICAgJzwvZGl2Pic7CiAgICAgICAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgICAgICAgIGNpdHlTZWxlY3REb20uaW5uZXJIVE1MID0gaHRtbDsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjaXR5U2VsZWN0RG9tKTsKICAgICAgICAgICAgdmFyIGVuYWJsZVJlcXVlc3QgPSB0cnVlOwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5jaXR5TGlzdCA9IGJhaWR1LmcoIkJNYXBMaWJfY2l0eUxpc3QiKTsKICAgICAgICAgICAgdGhpcy5teVNjcm9sbCA9IG5ldyBpU2Nyb2xsKCdCTWFwTGliX3Njcm9sbCcsIHsKICAgICAgICAgICAgICAgIGRlc2t0b3BDb21wYXRpYmlsaXR5OnRydWUsCiAgICAgICAgICAgICAgICBoU2Nyb2xsOiBmYWxzZSwKICAgICAgICAgICAgICAgIGhTY3JvbGxiYXI6IGZhbHNlLAogICAgICAgICAgICAgICAgdlNjcm9sbDogdHJ1ZSwKICAgICAgICAgICAgICAgIHZTY3JvbGxiYXI6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGJhaWR1Lm9uKHRoaXMuY2l0eUxpc3QsICJjbGljayIsIGZ1bmN0aW9uKGUpewogICAgICAgICAgICAgICAgcHJldmVudERlZmF1bHQoZSk7CiAgICAgICAgICAgICAgICBpZiAoIWVuYWJsZVJlcXVlc3QpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbmFibGVSZXF1ZXN0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgIGVuYWJsZVJlcXVlc3QgPSB0cnVlOwogICAgICAgICAgICAgICAgfSwgNTAwKTsKICAgICAgICAgICAgICAgIHZhciB0ID0gZS50YXJnZXQ7CiAgICAgICAgICAgICAgICB2YXIgdHlwZSA9IHQuZ2V0QXR0cmlidXRlKCJ0eXBlIik7CiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PSAxKSB7IAogICAgICAgICAgICAgICAgICAgIC8vteO798HL0ru8trPHytAKICAgICAgICAgICAgICAgICAgICB2YXIgY2l0eUNvZGUgPSB0LmdldEF0dHJpYnV0ZSgiY2l0eUNvZGUiKTsKICAgICAgICAgICAgICAgICAgICBpZiAobWUuY2l0eUxpc3RTdWJbY2l0eUNvZGVdICYmIG1lLmNpdHlMaXN0U3ViW2NpdHlDb2RlXS5zdHlsZS5kaXNwbGF5ICE9ICJub25lIikgewogICAgICAgICAgICAgICAgICAgICAgICBtZS5jaXR5TGlzdFN1YltjaXR5Q29kZV0uc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmxvY2FsU3RvcmFnZSAmJiB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oIkJNYXBMaWJfY2l0eSIgKyBjaXR5Q29kZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjaXR5SnNvbiA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiQk1hcExpYl9jaXR5IiArIGNpdHlDb2RlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lLnNlbGVjdENpdHlDYWxsYmFjayhKU09OLnBhcnNlKGNpdHlKc29uKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZS5yZXF1ZXN0KGNpdHlDb2RlKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIG1lLm15U2Nyb2xsLnJlZnJlc2goKTsKICAgICAgICAgICAgICAgICAgICBtZS5teVNjcm9sbC5zY3JvbGxUb0VsZW1lbnQodCwgNjAwKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgLy+147v3wcu2/ry2s8fK0AogICAgICAgICAgICAgICAgICAgIG1lLnNldENpdHlUYWJOYW1lKHQuaW5uZXJIVE1MKTsKICAgICAgICAgICAgICAgICAgICB2YXIgZ2VvID0gdC5nZXRBdHRyaWJ1dGUoImdlbyIpOwogICAgICAgICAgICAgICAgICAgIHZhciBnZW9BcnIgPSBnZW8uc3BsaXQoIiwiKTsKICAgICAgICAgICAgICAgICAgICB2YXIgcHggPSBuZXcgQk1hcC5QaXhlbChnZW9BcnJbMF0sIGdlb0FyclsxXSk7CiAgICAgICAgICAgICAgICAgICAgdmFyIHBvaW50ID0gbWUucHJvamVjdGlvbi5wb2ludFRvTG5nTGF0KHB4KTsKICAgICAgICAgICAgICAgICAgICBtZS5tYXAuY2VudGVyQW5kWm9vbShwb2ludCwgMTMpOwogICAgICAgICAgICAgICAgICAgIG1lLmhpZGVDaXR5U2VsZWN0KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gMykgewogICAgICAgICAgICAgICAgICAgIC8vteO798HLyKvK0AogICAgICAgICAgICAgICAgICAgIHZhciBjaXR5TmFtZSA9IHQuZ2V0QXR0cmlidXRlKCJjaXR5bmFtZSIpOwogICAgICAgICAgICAgICAgICAgIG1lLm1hcC5jZW50ZXJBbmRab29tKGNpdHlOYW1lLCAxMik7CiAgICAgICAgICAgICAgICAgICAgbWUuc2V0Q2l0eVRhYk5hbWUoY2l0eU5hbWUpOwogICAgICAgICAgICAgICAgICAgIG1lLmhpZGVDaXR5U2VsZWN0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogyejWw2NpdHl0YWK1xLPHytDD+wogICAgICAgICAqLwogICAgICAgICwgc2V0Q2l0eVRhYk5hbWUgOiBmdW5jdGlvbiAoY2l0eU5hbWUpIHsKICAgICAgICAgICAgdGhpcy5kb20uY2l0eVRhYi5pbm5lckhUTUwgPSBjaXR5TmFtZTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIMfrx/O6r8r9CiAgICAgICAgICovCiAgICAgICAgLCByZXF1ZXN0OiBmdW5jdGlvbiAoY2l0eUlkKSB7CiAgICAgICAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgICAgICAgIC8vIMn6s8nL5rv6yv0KICAgICAgICAgICAgdmFyIHRpbWVTdGFtcCA9IChNYXRoLnJhbmRvbSgpICogMTAwMDAwKS50b0ZpeGVkKDApOwoKICAgICAgICAgICAgLy+0tL2oY2FsbGJhY2u6r8r9CiAgICAgICAgICAgIHdpbmRvdy5iYWlkdSA9IHdpbmRvdy5iYWlkdSB8fCB7fTsKICAgICAgICAgICAgd2luZG93LmJhaWR1WyJfY2JrIiArIHRpbWVTdGFtcF0gPSBmdW5jdGlvbiAoanNvbikgewogICAgICAgICAgICAgICAgLy+xvrXYtOa0ogogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5sb2NhbFN0b3JhZ2UgJiYgd2luZG93LmxvY2FsU3RvcmFnZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKCJCTWFwTGliX2NpdHkiICsgY2l0eUlkLCBKU09OLnN0cmluZ2lmeShqc29uKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBtZS5zZWxlY3RDaXR5Q2FsbGJhY2soanNvbik7CiAgICAgICAgICAgICAgICBkZWxldGUgd2luZG93LmJhaWR1WyJfY2JrIiArIHRpbWVTdGFtcF07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHVybCA9ICJodHRwOi8vbWFwLmJhaWR1LmNvbS8/cXQ9c3ViX2FyZWFfbGlzdCZhcmVhY29kZT0iICsgY2l0eUlkICsgIiZsZXZlbD0xJmZyb209bWFwYXBpJmllPXV0Zi04Jmw9MTImY2FsbGJhY2s9IiArICJiYWlkdS5fY2JrIiArIHRpbWVTdGFtcDsKICAgICAgICAgICAgdmFyIHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOwogICAgICAgICAgICBzY3JpcHQuc2V0QXR0cmlidXRlKCJzcmMiLCB1cmwpOwogICAgICAgICAgICBzY3JpcHQuc2V0QXR0cmlidXRlKCJ0eXBlIiwgInRleHQvamF2YXNjcmlwdCIpOwogICAgICAgICAgICBzY3JpcHQuc2V0QXR0cmlidXRlKCJjaGFyc2V0IiwgInV0Zi04Iik7CiAgICAgICAgICAgIC8vIL3Fsb6809TYzeqzybrzvfjQ0NLGs/0KICAgICAgICAgICAgaWYgKHNjcmlwdC5hZGRFdmVudExpc3RlbmVyKSB7CiAgICAgICAgICAgICAgICBzY3JpcHQuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdCA9IGUudGFyZ2V0OwogICAgICAgICAgICAgICAgICAgIHQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0KTsKICAgICAgICAgICAgICAgIH0sIGZhbHNlKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChzY3JpcHQuYXR0YWNoRXZlbnQpIHsKICAgICAgICAgICAgICAgIHNjcmlwdC5hdHRhY2hFdmVudCgnb25yZWFkeXN0YXRlY2hhbmdlJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICAgIHZhciB0ID0gd2luZG93LmV2ZW50LnNyY0VsZW1lbnQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgKHQucmVhZHlTdGF0ZSA9PSAnbG9hZGVkJyB8fCB0LnJlYWR5U3RhdGUgPT0gJ2NvbXBsZXRlJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpWzBdLmFwcGVuZENoaWxkKHNjcmlwdCk7CiAgICAgICAgICAgICAgICBzY3JpcHQgPSBudWxsOwogICAgICAgICAgICB9LCAxKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIMfrx/Ozx8rQt7W72LXEY2FsbGJhY2sKICAgICAgICAgKi8KICAgICAgICAsIHNlbGVjdENpdHlDYWxsYmFjazogZnVuY3Rpb24gKGpzb24pIHsKICAgICAgICAgICAgaWYgKGpzb24ucmVzdWx0LmVycm9yICE9MCApIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgc3ViID0ganNvbi5jb250ZW50LnN1YgogICAgICAgICAgICAgICAgLCBwYXJlbnRDb2RlID0ganNvbi5jb250ZW50LmFyZWFfY29kZQogICAgICAgICAgICAgICAgLCBjaXR5TmFtZSAgID0ganNvbi5jb250ZW50LmFyZWFfbmFtZQogICAgICAgICAgICAgICAgOwogICAgICAgICAgICBmb3IgKHZhciBqIGluIHRoaXMuY2l0eUxpc3RTdWIpIHsKICAgICAgICAgICAgICAgIHRoaXMuY2l0eUxpc3RTdWJbal0uc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIXRoaXMuY2l0eUxpc3RTdWJbcGFyZW50Q29kZV0pIHsKICAgICAgICAgICAgICAgIHZhciBsaSA9IHRoaXMuY2l0eUxpc3RTdWJbcGFyZW50Q29kZV09IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxpIikKICAgICAgICAgICAgICAgIHZhciBodG1sID0gIjx1bCBzdHlsZT0nbGlzdC1zdHlsZTpub25lO21hcmdpbjowO3BhZGRpbmc6MDsnPiI7CiAgICAgICAgICAgICAgICB2YXIgcmVnZXg9L7Gxvql8yc+6o3zM7L3yfNbYx+wvZzsKICAgICAgICAgICAgICAgIGlmIChjaXR5TmFtZS5tYXRjaChyZWdleCkpIHsKICAgICAgICAgICAgICAgICAgICBodG1sICs9ICI8bGkgc3R5bGU9J3BhZGRpbmctbGVmdDozMHB4O2hlaWdodDozMHB4O2xpbmUtaGVpZ2h0OjMwcHg7Zm9udC1zaXplOjE0cHg7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgI2NjYztiYWNrZ3JvdW5kOiNmM2YzZjM7JyB0eXBlPSczJyBjaXR5bmFtZT0nIiArIGNpdHlOYW1lICsgIic+yKvK0DwvbGk+IjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLGwgPSBzdWIubGVuZ3RoOyBpIDxsOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZ2VvID0gc3ViW2ldLmdlby5zcGxpdCgifCIpWzJdOwogICAgICAgICAgICAgICAgICAgIGh0bWwgKz0gIjxsaSBzdHlsZT0ncGFkZGluZy1sZWZ0OjMwcHg7aGVpZ2h0OjMwcHg7bGluZS1oZWlnaHQ6MzBweDtmb250LXNpemU6MTRweDtib3JkZXItYm90dG9tOjFweCBzb2xpZCAjY2NjO2JhY2tncm91bmQ6I2YzZjNmMzsnIHR5cGU9JzInIGdlbz0nIiArIGdlby5zdWJzdHIoMCwgZ2VvLmxlbmd0aC0xKSArICInPiIgKyBzdWJbaV0uYXJlYV9uYW1lICsgIjwvbGk+IjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGh0bWwgKz0gIjwvdWw+IjsKICAgICAgICAgICAgICAgIGxpLmlubmVySFRNTCA9IGh0bWw7CiAgICAgICAgICAgICAgICB0aGlzLmNpdHlMaXN0Lmluc2VydEJlZm9yZShsaSwgYmFpZHUuZygiQk1hcExpYl9jaXR5SXRlbSIgKyBwYXJlbnRDb2RlKS5uZXh0U2libGluZyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLmNpdHlMaXN0U3ViW3BhcmVudENvZGVdLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiC52LHVs8fK0NGh1PG1r7LjCiAgICAgICAgICovCiAgICAgICAgLCBzaG93Q2l0eUJveCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdGhpcy5jaXR5U2VsZWN0RG9tLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgICAgICB0aGlzLmNpdHlTZWxlY3REb20uc3R5bGUudG9wID0gcGFyc2VJbnQoZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AsIDEwKSArIDIwICsgInB4IjsKICAgICAgICAgICAgdGhpcy5teVNjcm9sbC5yZWZyZXNoKCk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiC52LHVs8fK0NGh1PG1r7LjIAogICAgICAgICAqLwogICAgICAgICwgaGlkZUNpdHlTZWxlY3QgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHRoaXMuY2l0eVNlbGVjdERvbS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEBleHBvcnRzIFNlYXJjaENvbnRyb2wgYXMgQk1hcExpYi5TZWFyY2hDb250cm9sCiAgICAgKi8KICAgIEJNYXBMaWIuU2VhcmNoQ29udHJvbCA9IFNlYXJjaENvbnRyb2w7Cgp9KSgpOwo=</text>
      </register>
      <register name="1" type="4">
        <text>tbar</text>
      </register>
      <register name="2" type="4">
        <text>,</text>
      </register>
      <register name="3" type="2">
        <text encoding="base64">Cg==</text>
      </register>
      <register name="4" type="2">
        <text encoding="base64">ICAgICAgICAgICAgICAgIH0K</text>
      </register>
      <register name="5" type="2">
        <text encoding="base64">ICAgICAgICAgICAgICAgIH0K</text>
      </register>
      <register name="6" type="4">
        <text>bar</text>
      </register>
      <register name="7" type="4">
        <text encoding="base64">IA==</text>
      </register>
      <register name="8" type="4">
        <text encoding="base64">IA==</text>
      </register>
      <register name="9" type="4">
        <text encoding="base64">IA==</text>
      </register>
      <register name=":" type="4">
        <text>w</text>
      </register>
    </registers>
    <search>
      <last-search>localSearch</last-search>
      <last-offset />
      <last-pattern>localSearch</last-pattern>
      <last-dir>1</last-dir>
      <show-last>false</show-last>
    </search>
    <history>
      <history-search>
        <entry>nav</entry>
        <entry>navi</entry>
        <entry>bind</entry>
        <entry>_bind</entry>
        <entry>autocomplete</entry>
        <entry>autoComp</entry>
        <entry>localsearch</entry>
        <entry>if</entry>
        <entry>icon</entry>
        <entry>onMarkBtn</entry>
        <entry encoding="base64">XDx9XD4=</entry>
        <entry>ware</entry>
        <entry>depart</entry>
        <entry>doPost</entry>
        <entry>openRequest</entry>
        <entry>store</entry>
        <entry>this</entry>
        <entry>show</entry>
        <entry>searchAC</entry>
        <entry>localSearch</entry>
      </history-search>
      <history-cmd>
        <entry>wa</entry>
        <entry>wq</entry>
        <entry>W</entry>
        <entry encoding="base64">JzwsJz5tIDI=</entry>
        <entry encoding="base64">JzwsJz5tIDkz</entry>
        <entry encoding="base64">JzwsJz5tIDky</entry>
        <entry encoding="base64">JzwsJz5tIDk2</entry>
        <entry encoding="base64">JzwsJz50IDk1</entry>
        <entry encoding="base64">JzwsJz50IDg4</entry>
        <entry encoding="base64">JzwsJz5tIDgz</entry>
        <entry encoding="base64">JzwsJz5q</entry>
        <entry>j</entry>
        <entry>1</entry>
        <entry>50</entry>
        <entry>t110</entry>
        <entry>m69</entry>
        <entry encoding="base64">JzwsJz5tNA==</entry>
        <entry encoding="base64">JzwsJz5tODI=</entry>
        <entry>w</entry>
      </history-cmd>
      <history-expr />
      <history-input />
    </history>
    <shortcut-conflicts>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed N</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed P</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed S</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed C</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed F</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed V</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed Y</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed R</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed U</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed D</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed A</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed X</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed W</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed O</text>
      </shortcut-conflict>
    </shortcut-conflicts>
  </component>
</application>